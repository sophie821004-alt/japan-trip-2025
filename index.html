<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 æ—¥æœ¬è¡Œ | Japan Trip</title>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* åŸºç¤æ¨£å¼å’Œå­—é«” */
        body { 
            font-family: 'Noto Sans JP', sans-serif; 
            background-color: #f4f4f5; 
            /* åœ–ç‰‡èƒŒæ™¯æœƒé€šé JS è¨­ç½® class åˆ° body */
            transition: background-color 0.5s, background-image 0.5s;
            -webkit-tap-highlight-color: transparent; 
        }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* [æ ¸å¿ƒ] é¢¨æ™¯ç…§ç‰‡èƒŒæ™¯æ¨£å¼ */
        .theme-background {
            background-size: cover;
            background-position: center;
            background-attachment: fixed; /* è®“èƒŒæ™¯å›ºå®šï¼Œå…§å®¹æ»¾å‹• */
            position: relative;
            color: #fff; /* é è¨­æ–‡å­—ç‚ºç™½è‰² (å› ç‚ºåœ–ç‰‡é€šå¸¸åæš—) */
        }
        /* åœ–ç‰‡é®ç½© (ç¢ºä¿æ–‡å­—æ¸…æ™°) */
        .theme-background::before {
            content: "";
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            /* æ·ºé»‘è‰²åŠé€æ˜é®ç½© */
            background: rgba(0, 0, 0, 0.4); 
            z-index: -1;
        }

        /* ç°¡ç´„é¢¨ (ç„¡åœ–ç‰‡å›é€€) æ¨£å¼ */
        .theme-simple {
             background-color: #f7f7f7; /* æ·ºç°è‰² */
             color: #333; /* æ–‡å­—é»‘è‰² */
        }

        /* å¡ç‰‡ç»ç’ƒæ¨£å¼èª¿æ•´ */
        .glass-dark { 
            background: rgba(0, 0, 0, 0.6); 
            backdrop-filter: blur(10px); 
            color: white; 
            /* è®“å¡ç‰‡æ›´è²¼åˆä¸»é¡Œï¼Œä½¿ç”¨æ·ºé‚Šæ¡† */
            border: 1px solid rgba(255, 255, 255, 0.15); 
        }
        .glass-light { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px); 
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-shadow { box-shadow: 0 4px 25px rgba(0,0,0,0.2); }

        /* [æ–°å¢] å°ˆç”¨æ–¼æ—¥æœŸçš„è¥¯ç·šå­—é«” */
        .date-style { font-family: 'Playfair Display', serif; }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        const TRAVELERS = ['Sophie', 'Li'];
        const DEFAULT_RATE = 0.22;
        
        // --- å‹•æ…‹èƒŒæ™¯ä¸»é¡Œé…ç½® (ä½¿ç”¨å¤–éƒ¨é¢¨æ™¯åœ–ç‰‡é€£çµ) ---
        const themeConfig = {
            // ä½¿ç”¨ Imgur/Pexels/Unsplash ç­‰å…¬é–‹åœ–åºŠçš„ CDN åœ–ç‰‡ï¼Œç¢ºä¿è¼‰å…¥é€Ÿåº¦
            city: { isDark: true, url: 'https://i.imgur.com/gK9qQ6d.jpg', fallbackColor: 'bg-gray-800' }, // åå¤å±‹å¤œæ™¯
            history: { isDark: false, url: 'https://i.imgur.com/kS9Qj6q.jpg', fallbackColor: 'bg-amber-100' }, // çŠ¬å±±åŸ/æ­·å²å»ºç¯‰
            travel: { isDark: true, url: 'https://i.imgur.com/o5X7f5z.jpg', fallbackColor: 'bg-teal-600' }, // æ–°å¹¹ç·š/æ—…è¡Œ
            amusement: { isDark: true, url: 'https://i.imgur.com/hYqC5nU.jpg', fallbackColor: 'bg-purple-700' }, // å¯Œå£«æ€¥æ¨‚åœ’
            fuji_christmas: { isDark: false, url: 'https://i.imgur.com/j4W7s4k.jpg', fallbackColor: 'bg-sky-200' }, // å¯Œå£«å±±é›ªæ™¯
            shibuya_modern: { isDark: true, url: 'https://i.imgur.com/5V4E8Zg.jpg', fallbackColor: 'bg-indigo-900' }, // æ¾€è°·åå­—è·¯å£/ç¾ä»£
            traditional_sky: { isDark: true, url: 'https://i.imgur.com/R3L9q7t.jpg', fallbackColor: 'bg-red-700' }, // æ·ºè‰/æ™´ç©ºå¡”
            shopping: { isDark: false, url: 'https://i.imgur.com/uY7Fp8r.jpg', fallbackColor: 'bg-gray-300' }, // è³¼ç‰©å€
            home: { isDark: false, url: 'https://i.imgur.com/vHqL3jC.jpg', fallbackColor: 'bg-yellow-100' }, // å›å®¶
            default: { isDark: false, url: null, fallbackColor: 'bg-gray-100' }
        };

        const getBackgroundStyle = (theme) => {
            const config = themeConfig[theme] || themeConfig.default;
            
            if (config.url) {
                // åœ–ç‰‡èƒŒæ™¯
                return {
                    className: 'theme-background',
                    style: { backgroundImage: `url(${config.url})` },
                    isDark: config.isDark
                };
            } else {
                // ç´”è‰²èƒŒæ™¯ (ç°¡ç´„å›é€€)
                return {
                    className: `theme-simple ${config.fallbackColor} transition-colors duration-500`,
                    style: {},
                    isDark: config.isDark
                };
            }
        };

        // --- DATA SOURCE (ä¿æŒä¸è®Š) ---
        const tripData = [
            {
                day: 1, date: "12/20 (Sat)", location: "Nagoya", weather: "sunny", theme: "city",
                temperature: [8, 10, 12, 14, 13, 11, 9, 8], 
                temp_hour_range: "10:00 - 18:00",
                events: [
                    { time: "09:00", title: "æ¡ƒåœ’ (TPE) âœˆï¸ åå¤å±‹ (NGO)", type: "transport", 
                      transport_note: "è™èˆª IT206 (è«‹è‡ªè¡Œç¢ºèªç™»æ©Ÿæ™‚é–“)", 
                      event_note: "Check-in & å‡ºå¢ƒ | D1 ç­æ©Ÿè³‡è¨Š", link: "" },
                    { time: "14:00", title: "æŠµé”åå¤å±‹ NGO & å‰å¾€é£¯åº—", type: "hotel", 
                      suggested_departure: "14:00", 
                      transport_note: "åéµç‰¹æ€¥/æº–æ€¥ -> æ­¥è¡Œ | ç´„ 40-50 åˆ†é˜", 
                      event_note: "VIA INN åå¤å±‹ç«™å‰æ¤¿ç”º | å…¥å¢ƒé€šé—œã€æ”¾è¡Œæ", link: "https://goo.gl/maps/viainnugoya" },
                    { time: "16:00", title: "å¤§é ˆè§€éŸ³ (åƒæ‹œ)", type: "sight", 
                      suggested_departure: "15:35", 
                      transport_note: "åœ°éµæ±å±±ç·š/é¶´èˆç·š (è½‰ä¹˜ä¸€æ¬¡) | ç´„ 25-30 åˆ†é˜", 
                      event_note: "ã€åå¤å±‹ä¸‰å¤§è§€éŸ³ä¹‹ä¸€ã€‘èŠåš´å¯§éœçš„å¯ºå»Ÿï¼Œå‚³èªªä¸­çš„ã€ŒçœŸç¦å¯ºæ–‡åº«ã€è—æœ‰å¤è€ç¶“æ›¸ã€‚æŠ“30åˆ†é˜åƒæ‹œæ™‚é–“ã€‚", 
                      nearby_suggestions: ["è¬æ¾å¯º (æœ‰å®šæ™‚å™´æ°´è¡¨æ¼”)", "å¤§é ˆæ‹›è²¡è²“", "æ°´æ›œæ—¥çš„æ„›éº—çµ² (ä¸»é¡Œå•†åº—)"],
                      link: "https://goo.gl/maps/osukannon" },
                    { time: "17:30", title: "å¤§é ˆå•†åº—è¡— & æ™šé¤", type: "food", 
                      suggested_departure: "17:20", 
                      transport_note: "æ­¥è¡Œ | ç´„ 10 åˆ†é˜ (å¾å¤§é ˆè§€éŸ³ä¸»æ®¿å‰é€²å…¥)", 
                      event_note: "ã€åå¤å±‹æœ€ç¹è¯çš„å•†åº—è¡—ã€‘å……æ»¿æ´»åŠ›ï¼Œèåˆäº†å‚³çµ±èˆ‡ç¾ä»£ã€‚æ™šé¤å¿…åƒï¼šçŸ¢å ´è±¬æ’ (Miso Katsu)ï¼Œäº«å—ç¨ç‰¹çš„å‘³å™Œé†¬ã€‚å¤šæ•¸åº—å®¶ç‡Ÿæ¥­è‡³20:00ã€‚", tags: ["å¿…åƒ", "é€›è¡—"], link: "https://goo.gl/maps/osukannon" },
                    { time: "19:00", title: "æ¦®å•†åœˆ (Sakae) è³¼ç‰©", type: "shop", 
                      suggested_departure: "18:40", 
                      transport_note: "æ­¥è¡Œ | ç´„ 20 åˆ†é˜ (çŸ¢å ´é †è·¯)", 
                      event_note: "SKYLE (UNIQLO/GU), Alpen Nagoya (~21:00)", 
                      nearby_suggestions: ["ä¸­éƒ¨é›»åŠ›Mirai Tower (åå¤å±‹é›»è¦–å¡”)", "ä¹…å±‹å¤§é€šå…¬åœ’"],
                      link: "https://goo.gl/maps/sakae" },
                    { time: "21:00", title: "ç¶ æ´²21 (Oasis 21) å¤œæ™¯", type: "sight", 
                      suggested_departure: "20:55", 
                      transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜ (å¾æ¦®ç«™)", 
                      event_note: "ã€æ°´ä¹‹å®‡å®™èˆ¹ã€‘æ¼‚æµ®åœ¨ç©ºä¸­çš„ç»ç’ƒæ§‹é€ ï¼Œæ™šä¸Šç‡ˆå…‰ç’€ç’¨ï¼Œæ˜¯çµ•ä½³çš„åŸå¸‚å¤œæ™¯èˆ‡æ‹ç…§åœ°é»ã€‚", tags: ["æ‹ç…§"], link: "https://goo.gl/maps/oasis21" },
                    { time: "21:30", title: "åƒé‡Œé¦¬è—¥å±€ & è¿”å›é£¯åº—", type: "shop", 
                      suggested_departure: "21:15", 
                      transport_note: "åœ°éµæ±å±±ç·š/æ«»é€šç·š | ç´„ 15-20 åˆ†é˜ (è¿”å›åå¤å±‹ç«™)", 
                      event_note: "ç‡Ÿæ¥­è‡³ 22:00 (å›é£¯åº—é †è·¯)", link: "https://goo.gl/maps/senrima" }
                ]
            },
            {
                day: 2, date: "12/21 (Sun)", location: "Inuyama/Nagoya", weather: "cloudy", theme: "history",
                temperature: [7, 8, 9, 11, 13, 12, 10, 9],
                temp_hour_range: "10:00 - 18:00",
                events: [
                    { time: "09:00", title: "çŠ¬å±±åŸä¸‹ç”º & ä¸‰å…‰ç¨»è·ç¥ç¤¾", type: "sight", 
                      suggested_departure: "08:20", 
                      transport_note: "åéµçŠ¬å±±ç·š MuSKY (ç‰¹æ€¥) | ç´„ 40-50 åˆ†é˜", 
                      event_note: "ã€å¯æ„›ç²‰ç´…é³¥å±…ã€‘åƒè§€æ—¥æœ¬ç¾å­˜æœ€å¤è€çš„å¤©å®ˆé–£ä¹‹ä¸€ï¼Œä¸¦åœ¨ä¸‹ç”ºå“åšç¾é£Ÿã€é€›è¡—ã€‚ä¸‰å…‰ç¨»è·ç¥ç¤¾çš„ç²‰ç´…å¿ƒå½¢ç¹ªé¦¬ä¹Ÿå¾ˆå‡ºåã€‚", 
                      nearby_suggestions: ["æˆ€å°ç”ºç³°å­ (ç¶²ç´…ç”œé»)", "é£›é©’ç‰›æ¡å£½å¸ (çŠ¬å±±ç‰›å¤ªéƒ)", "äº”å¹³é¤… (åœ¨åœ°å°åƒ)"],
                      link: "https://goo.gl/maps/inuyamacastle" },
                    { time: "13:00", title: "å‰å¾€åå¤å±‹åŸ", type: "transport", 
                      suggested_departure: "11:50", 
                      transport_note: "åéµ/åœ°éµ (ç¶“ä¸Šé£¯ç”°) | ç´„ 1 å°æ™‚ 10 åˆ†é˜ (å«è½‰ä¹˜)", 
                      event_note: "å¾çŠ¬å±±ç«™å‡ºç™¼", link: "https://goo.gl/maps/nagoyacastle" },
                    { time: "14:30", title: "åå¤å±‹åŸ", type: "sight", 
                      suggested_departure: "14:25", 
                      transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜ (åœ°éµç«™å‡ºå£)", 
                      event_note: "ã€é‡‘é¯±åŸã€‘åå¤å±‹çš„è±¡å¾µï¼Œå…¶å±‹é ‚ä¸Šçš„é‡‘é¯±æœ€ç‚ºçŸ¥åã€‚åŸå…§æœ‰æœ¬ä¸¸å¾¡æ®¿ï¼Œé‡ç¾äº†ç•¶å¹´è¯éº—çš„æ­¦å®¶æ–‡åŒ–ã€‚", link: "https://goo.gl/maps/nagoyacastle" },
                    { time: "16:30", title: "åéµç™¾è²¨å•†åœˆ & BicCamera", type: "shop", 
                      suggested_departure: "16:05", 
                      transport_note: "åœ°éµååŸç·š/é¶´èˆç·š (è½‰ä¹˜ä¸€æ¬¡) | ç´„ 25 åˆ†é˜", 
                      event_note: "JR Gate Toweråº—/è¥¿åº— | D1æ²’åƒåˆ°çŸ¢å ´å¯åœ¨æ­¤åƒ", link: "https://goo.gl/maps/nagoyastation" }
                ]
            },
            {
                day: 3, date: "12/22 (Mon)", location: "Nagoya -> Fuji", weather: "sunny", theme: "travel",
                temperature: [5, 7, 9, 11, 10, 8, 7, 6],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "08:30", title: "ç†±ç”°ç¥å®®", type: "sight", 
                      suggested_departure: "08:20", 
                      transport_note: "åéµ (åå¤å±‹ç«™ -> ç¥å®®å‰ç«™) | ç´„ 10 åˆ†é˜", 
                      event_note: "ã€ä¸‰ç¥å™¨ä¹‹ä¸€ï¼šè‰è–™åŠã€‘ä¾›å¥‰æ—¥æœ¬ç¥è©±ä¸­çš„è‰è–™åŠï¼ˆè¤‡è£½å“ï¼‰ã€‚æ˜¯åƒ…æ¬¡æ–¼ä¼Šå‹¢ç¥å®®çš„å¤§ç¥å®®ï¼Œå……æ»¿èŠåš´çš„æ­·å²æ°›åœã€‚", 
                      nearby_suggestions: ["ç™½é³¥åº­åœ’ (æ± æ³‰è¿´éŠå¼æ—¥å¼åº­åœ’)", "æ¸…æ°´ç¤¾ (ç¾å®¹ç¥ˆé¡˜)", "ä¿¡é•·å¡€ (æ—¥æœ¬ä¸‰å¤§åœŸå¡€ä¹‹ä¸€)"],
                      tags: ["æ­·å²"], link: "https://goo.gl/maps/atsutashrine" },
                    { time: "10:30", title: "åˆé¤ (è“¬èŠè»’é°»é­šé£¯ç¥å®®åº—)", type: "food", 
                      suggested_departure: "10:25", 
                      transport_note: "æ­¥è¡Œ | ç´„ 5-8 åˆ†é˜ (è¿‘ç¥å®®è¥¿é–€)", 
                      event_note: "ã€åå¤å±‹åç‰©ï¼šé°»é­šé£¯ä¸‰åƒ (Hitsumabushi)ã€‘äº«å—å…ˆåŸå‘³ã€å¾ŒåŠ æ–™ã€æœ€å¾ŒèŒ¶æ³¡é£¯çš„ä¸‰ç¨®åƒæ³•ã€‚å»ºè­°ææ—©æ’éšŠæˆ–é ç´„ã€‚", tags: ["å¿…åƒ"], link: "https://goo.gl/maps/atsutahoraiken" },
                    { time: "11:30", title: "è¿”å›é£¯åº—å–è¡Œæ", type: "transport", 
                      suggested_departure: "11:20", 
                      transport_note: "åéµ (ç¥å®®å‰ç«™ -> åå¤å±‹ç«™) | ç´„ 10 åˆ†é˜", 
                      event_note: "é€€æˆ¿ã€å–å›å¯„æ”¾è¡Œæ", link: "" },
                    { time: "12:30", title: "ç§»å‹•è‡³æ²³å£æ¹–", type: "transport", 
                      suggested_departure: "12:30", 
                      transport_note: "æ–°å¹¹ç·š (åå¤å±‹-ä¸‰å³¶) + å¯Œå£«æ€¥è¡Œå·´å£« | ç´„ 3.5 - 4 å°æ™‚", 
                      event_note: "é•·é€”ç§»å‹•ï¼Œå»ºè­°é è¨‚è»Šç¥¨", link: "https://goo.gl/maps/kawaguchikostation" },
                    { time: "16:00", title: "Check-in MYSTAYS å¯Œå£«å±±å±•æœ›æ¸©æ³‰é…’åº—", type: "hotel", 
                      suggested_departure: "16:00", 
                      transport_note: "æ­¥è¡Œ/è¨ˆç¨‹è»Š | å¾æ²³å£æ¹–ç«™å‰å¾€é£¯åº—", 
                      event_note: "ç¨ä½œä¼‘æ¯ï¼Œæº–å‚™æ˜æ—¥è¡Œç¨‹ï¼Œäº«å—é£¯åº—æº«æ³‰ã€‚", link: "" }
                ]
            },
            {
                day: 4, date: "12/23 (Tue)", location: "Fuji Area", weather: "cloudy", theme: "amusement",
                temperature: [-2, 0, 2, 4, 6, 5, 3, 2],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "09:00", title: "å¯Œå£«æ€¥æ¨‚åœ’ (Fuji-Q Highland)", type: "sight", 
                      suggested_departure: "08:30", 
                      transport_note: "æ²³å£æ¹–å‘¨éŠå·´å£« (ç´…ç·š/ç¶ ç·š) æˆ–æ­¥è¡Œ", 
                      event_note: "ã€å°–å«ç³»ä¸»é¡Œæ¨‚åœ’ã€‘æ“æœ‰å¤šé …ä¸–ç•Œç´€éŒ„ç´šçš„é›²éœ„é£›è»Šï¼Œå¦‚é«˜é£›è»Šã€FUJIYAMAç­‰ã€‚å…¨æ—¥æŒ‘æˆ°æ¥µé™è¨­æ–½ï¼ç‡Ÿæ¥­æ™‚é–“ç´„ 9:00-18:00ã€‚", 
                      tags: ["åˆºæ¿€", "ä¸»é¡Œæ¨‚åœ’"], 
                      link: "https://goo.gl/maps/fujiqhighland" 
                    }
                ]
            },
            {
                day: 5, date: "12/24 (Wed)", location: "Fuji -> Tokyo", weather: "snow", theme: "fuji_christmas",
                temperature: [1, 3, 5, 7, 8, 6, 4, 3],
                temp_hour_range: "07:00 - 15:00",
                events: [
                    { time: "07:30", title: "æ–°å€‰å±±æ·ºé–“å…¬åœ’", type: "sight", 
                      suggested_departure: "07:00", 
                      transport_note: "å»ºè­°è‡ªé§•/è¨ˆç¨‹è»Š/å¯Œå£«æ€¥è¡Œç·š (ä¸‹å‰ç”°ç«™)", 
                      event_note: "ã€å¯Œå£«å±±ç¶“å…¸è¦–è§’ã€‘çˆ¬ä¸Š 398 éšçš„ã€Œå¿ éˆå¡”ã€ï¼Œå¯ä»¥æ‹åˆ°å¯Œå£«å±±ã€äº”é‡å¡”çš„ç¶“å…¸ç•«é¢ã€‚æŠŠæ¡ä¸Šåˆè¼ƒä½³è¦–é‡ã€‚", tags: ["çµ•æ™¯"], 
                      link: "https://goo.gl/maps/arakurayama" 
                    },
                    { time: "11:00", title: "å¤©ä¸Šå±±å…¬åœ’ (Ropeway) & åˆé¤", type: "sight", 
                      suggested_departure: "10:30", 
                      transport_note: "æ²³å£æ¹–å‘¨éŠå·´å£« (ç´…ç·š) | å¤©ä¸Šå±±å…¬åœ’çºœè»Š", 
                      event_note: "ã€ç‹¸è²“èˆ‡å…”å­å‚³èªªã€‘æ­ä¹˜çºœè»Šä¸Šå±±ï¼Œå¯ä¿¯ç°æ²³å£æ¹–å’Œå¯Œå£«å±±å…¨æ™¯ã€‚å±±é ‚æœ‰ã€Œå’”åš“å’”åš“å±±ã€çš„å¯æ„›å‚³èªªã€‚å±±ä¸‹æˆ–å±±ä¸Šç”¨ç°¡é¤ã€‚", 
                      link: "https://goo.gl/maps/kachiropeway" 
                    },
                    { time: "17:00", title: "ç§»å‹•è‡³æ±äº¬ (Check-in é¶¯è°·/ä¸Šé‡)", type: "transport", 
                      suggested_departure: "17:00", 
                      transport_note: "é«˜é€Ÿå·´å£« or JR (æ–°å®¿/æ±äº¬) | ç´„ 2 å°æ™‚", 
                      event_note: "é•·é€”ç§»å‹•ï¼Œè«‹ç¢ºä¿å·²é€€æˆ¿ä¸¦å–å›è¡Œæã€‚é è¨‚ 17:00 å·¦å³è»Šç­å‰å¾€æ±äº¬ã€‚", link: "https://goo.gl/maps/shinjuku" 
                    },
                    { time: "19:30", title: "å…­æœ¬æœ¨ä¹‹ä¸˜é»ç‡ˆ", type: "sight", 
                      suggested_departure: "19:00", 
                      transport_note: "åœ°éµ | ç´„ 20-30 åˆ†é˜ (å¾æ–°å®¿/ä¸Šé‡)", 
                      event_note: "ã€æ±äº¬è–èª•å¤œæ™¯ã€‘æ¬£è³æ«¸æœ¨å‚å¤§é“çš„é¦™æª³é‡‘é»ç‡ˆï¼Œèƒ½é çœºæ±äº¬éµå¡”ã€‚æ˜¯æ±äº¬æœ€æµªæ¼«çš„è–èª•ç¯€æ…¶æ´»å‹•ä¹‹ä¸€ã€‚", tags: ["è–èª•é™å®š"], 
                      link: "https://goo.gl/maps/roppongihills" 
                    },
                    { time: "21:00", title: "æ™´ç©ºå¡”è–èª•å¸‚é›†", type: "sight", 
                      suggested_departure: "20:30", 
                      transport_note: "åœ°éµ (å¤§æ±Ÿæˆ¶ç·š/åŠè—é–€ç·š) | ç´„ 30-40 åˆ†é˜", 
                      event_note: "æ±äº¬æ™´ç©ºå¡”å¤¢å¹»è–èª• 2025", 
                      link: "https://goo.gl/maps/skytree" 
                    }
                ]
            },
            {
                day: 6, date: "12/25 (Thu)", location: "Tokyo Shibuya", weather: "sunny", theme: "shibuya_modern",
                temperature: [3, 5, 7, 9, 10, 8, 6, 4],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "09:00", title: "æ˜æ²»ç¥å®®", type: "sight", 
                      suggested_departure: "08:40", 
                      transport_note: "JR å±±æ‰‹ç·š | å¾é¶¯è°·/ä¸Šé‡å‡ºç™¼ç´„ 20 åˆ†é˜", 
                      event_note: "ã€æ±äº¬éƒ½å¸‚ç¶ æ´²ã€‘ä¾›å¥‰æ˜æ²»å¤©çš‡èˆ‡æ˜­æ†²çš‡å¤ªåçš„ç¥å®®ï¼Œå¾å·¨å¤§çš„é³¥å±…é€²å…¥ï¼Œå½·å½¿é€²å…¥æ£®æ—ï¼Œæ˜¯æ±äº¬éƒ½å¿ƒé›£å¾—çš„å¯§éœä¹‹åœ°ã€‚", link: "https://goo.gl/maps/meijishrine" },
                    { time: "12:00", title: "åˆé¤/Sports Shop Gallery 2", type: "shop", 
                      suggested_departure: "11:45", 
                      transport_note: "æ­¥è¡Œ | å¾åŸå®¿/ä»£ä»£æœ¨è‡³æ¾€è°·", 
                      event_note: "é€›è¡—è¡Œç¨‹", link: "https://goo.gl/maps/shibuyacrossing" },
                    { time: "16:00", title: "Shibuya Sky", type: "sight", 
                      suggested_departure: "15:55", 
                      transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜", 
                      event_note: "ã€æ¾€è°·æœ€é«˜å±•æœ›å°ã€‘360 åº¦ç„¡æ­»è§’ä¿¯ç°æ±äº¬çš„ç¾ä»£åœ°æ¨™å’Œè‘—åçš„æ¾€è°·åå­—è·¯å£ã€‚éœ€å…©é€±å‰æ¶ç¥¨! æ—¥è½æ™‚é–“ç´„ 16:30ã€‚", 
                      nearby_suggestions: ["å®®ä¸‹å…¬åœ’ (æ–°åœ°æ¨™/å±‹é ‚å…¬åœ’)", "å¿ çŠ¬å…«å…¬åƒ/åå­—è·¯å£", "æ¾€è°·PARCO (å‹•æ¼«è¿·æŒ–å¯¶)"],
                      tags: ["é ç´„", "æ—¥è½"], link: "https://goo.gl/maps/shibuyasky" },
                    { time: "18:00", title: "é’ä¹‹æ´çªŸ (é»ç‡ˆ)", type: "sight", 
                      suggested_departure: "17:50", 
                      transport_note: "æ­¥è¡Œ | æ¾€è°·å…¬åœ’é€š~ä»£ä»£æœ¨å…¬åœ’", 
                      event_note: "ã€è—è‰²ç‡ˆæµ·ã€‘æ¾€è°·å…¬åœ’é€šè‡³ä»£ä»£æœ¨å…¬åœ’ä¸€å¸¶ï¼Œæ•¸åè¬é¡†è—è‰² LED ç‡ˆè£é£¾æˆçš„å¤¢å¹»ç‡ˆæµ·ã€‚", tags: ["é»ç‡ˆ"], link: "https://goo.gl/maps/bluecave" },
                    { time: "20:00", title: "æ™šé¤: Steak Rice & Curry", type: "food", 
                      suggested_departure: "19:50", 
                      transport_note: "æ­¥è¡Œ | æ¾€è°·ç«™å‘¨é‚Š", 
                      event_note: "Center Beef Shibuya (Center Gai?)", link: "https://goo.gl/maps/centerbeef" }
                ]
            },
            {
                day: 7, date: "12/26 (Fri)", location: "Asakusa/Skytree", weather: "sunny", theme: "traditional_sky",
                temperature: [2, 4, 6, 8, 9, 7, 5, 3],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "09:00", title: "æ·ºè‰é›·é–€", type: "sight", 
                      suggested_departure: "08:40", 
                      transport_note: "åœ°éµéŠ€åº§ç·š/éƒ½ç‡Ÿæ·ºè‰ç·š | å¾ä¸Šé‡/é¶¯è°·å‡ºç™¼", 
                      event_note: "ã€æ±äº¬ä¸‹ç”ºæ–‡åŒ–ã€‘æ¨™èªŒæ€§çš„å¤§ç‡ˆç± ï¼Œèµ°éä»²è¦‹ä¸–é€šï¼Œå…©å´æ˜¯å‚³çµ±çš„å°åƒå’Œç´€å¿µå“åº—ï¼Œçµ‚é»æ˜¯æ·ºè‰å¯ºã€‚", 
                      nearby_suggestions: ["æ·ºè‰æ–‡åŒ–è§€å…‰ä¸­å¿ƒ (é ‚æ¨“å…è²»å±•æœ›)", "éš…ç”°å…¬åœ’ (æ²³ç•”/æ™´ç©ºå¡”ç¾æ™¯)", "å‚³æ³•é™¢é€š (å¤è‰²è€è¡—)"],
                      link: "https://goo.gl/maps/kaminarimon" },
                    { time: "11:30", title: "åˆé¤: æ·ºè‰ä»ŠåŠ", type: "food", 
                      suggested_departure: "11:25", 
                      transport_note: "æ­¥è¡Œ | æ·ºè‰ç«™å‘¨é‚Š", 
                      event_note: "ã€è€å­—è™Ÿå£½å–œç‡’ã€‘å‰µæ¥­æ–¼æ˜æ²»æ™‚æœŸï¼Œä»¥é«˜å“è³ªçš„é»‘æ¯›å’Œç‰›èåã€‚åˆé–“å¥—é¤åƒ¹æ ¼å¯¦æƒ ï¼ŒCPå€¼é«˜ã€‚", tags: ["é«˜CPå€¼"], link: "https://goo.gl/maps/asakusaimahan" },
                    { time: "14:00", title: "Pokemon Center æ™´ç©ºå¡”", type: "shop", 
                      suggested_departure: "13:45", 
                      transport_note: "åœ°éµ/æ±æ­¦ç·š | æ·ºè‰è‡³æŠ¼ä¸Šç«™ | ç´„ 15 åˆ†é˜", 
                      event_note: "ä½æ–¼æ™´ç©ºå¡”ä¸‹çš„è³¼ç‰©ä¸­å¿ƒï¼Œæ˜¯å¯¶å¯å¤¢ç²‰çµ²çš„è³¼ç‰©å¤©å ‚ã€‚", link: "https://goo.gl/maps/pokemonskytree" },
                    { time: "17:00", title: "æŠ¼ä¸Šæº«æ³‰ (å¤§é»‘æ¹¯)", type: "sight", 
                      suggested_departure: "16:50", 
                      transport_note: "æ­¥è¡Œ | æŠ¼ä¸Šç«™å‘¨é‚Š", 
                      event_note: "å‚³çµ±éŒ¢æ¹¯é«”é©—", link: "https://goo.gl/maps/daikokuyu" }
                ]
            },
            {
                day: 8, date: "12/27 (Sat)", location: "Tokyo Shopping", weather: "cloudy", theme: "shopping",
                temperature: [4, 6, 8, 10, 9, 7, 5, 4],
                temp_hour_range: "10:00 - 18:00",
                events: [
                    { time: "10:00", title: "Ricoland Tokyo Bay (é‡æ©Ÿç”¨å“)", type: "shop", 
                      suggested_departure: "09:20", 
                      transport_note: "åœ°éµæœ‰æ¨‚ç”ºç·š/ç™¾åˆé·—ç·š (æ–°æ©‹è½‰ä¹˜) | ç›®çš„åœ°ï¼šæ±é›²ç«™ | ç´„ 40 åˆ†é˜", 
                      event_note: "ã€é¨å£«å¿…è¨ªè–åœ°ã€‘æ±äº¬ç£åœ°å€çš„å¤§å‹é‡æ©Ÿç”¨å“åº—ï¼Œå¾å®‰å…¨å¸½åˆ°é›¶ä»¶æ‡‰æœ‰ç›¡æœ‰ã€‚", tags: ["é¨å£«å¿…é€›"], link: "https://goo.gl/maps/ricoland" },
                    { time: "13:00", title: "åˆé¤: æœ¨æ›¾è·¯ (å£½å–œç‡’)", type: "food", 
                      suggested_departure: "12:00", 
                      transport_note: "åœ°éµ/JR | å¾æ±é›²ç«™è¿”å›æ–°å®¿ï¼Œç´„ 1 å°æ™‚", 
                      event_note: "Shabu Shabu / å£½å–œç‡’", link: "https://goo.gl/maps/kisoji" },
                    { time: "15:00", title: "æ–°å®¿é€›è¡—", type: "shop", 
                      suggested_departure: "14:55", 
                      transport_note: "æ­¥è¡Œ | æ–°å®¿ç«™å‘¨é‚Š", 
                      event_note: "Lumine, Isetan, BicCamera", link: "https://goo.gl/maps/shinjuku" }
                ]
            },
            {
                day: 9, date: "12/28 (Sat)", location: "Back Home", weather: "sunny", theme: "home",
                temperature: [3, 5, 7, 9, 11, 10, 8, 6],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "10:00", title: "å‰å¾€æˆç”°æ©Ÿå ´ (NRT)", type: "transport", 
                      suggested_departure: "10:00", 
                      transport_note: "JR Narita Express (N'EX) or Skyliner | ç´„ 1 å°æ™‚ 20 åˆ†é˜ (å¾æ–°å®¿/ä¸Šé‡)", 
                      event_note: "é ç•™å……è£•æ™‚é–“è‡³ç¬¬ä¸€èˆªå»ˆ (T1)", link: "https://goo.gl/maps/naritaairport" },
                    { time: "14:30", title: "æŠµé”æˆç”°æ©Ÿå ´ (NRT)", type: "transport", 
                      suggested_departure: "14:30", 
                      transport_note: "æ©Ÿå ´å…ç¨…åº—è³¼ç‰©", 
                      event_note: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒ", link: "" },
                    { time: "16:35", title: "èµ·é£› (NRT -> TPE)", type: "transport", 
                      suggested_departure: "16:35", 
                      transport_note: "èˆªç­è³‡è¨Šç¢ºèª", 
                      event_note: "ç¥æ—…é€”æ„‰å¿«ï¼", link: "" },
                    { time: "20:00", title: "æŠµé”å°åŒ—", type: "home", 
                      suggested_departure: "20:00", 
                      transport_note: "æº«æš–çš„å®¶", 
                      event_note: "ç”œèœœçš„å®¶", link: "" }
                ]
            }
        ];

        // äº¤é€šå’Œç·Šæ€¥è³‡è¨Š (ä¿æŒä¸è®Š)
        const toolsData = {
            flights: [
                { leg: "å»ç¨‹", code: "IT206", time: "12/20 09:00 TPE -> 14:00 NGO", airport: "TPE/NGO" },
                { leg: "å›ç¨‹", code: "MM625", time: "12/28 èµ·é£› 16:35 NRT", airport: "NRT T1" }
            ],
            hotels: [
                { name: "VIA INN åå¤å±‹ç«™å‰æ¤¿ç”º", dates: "12/20-12/22", address: "åå¤å±‹" },
                { name: "MYSTAYS å¯Œå£«å±±å±•æœ›æ¸©æ³‰é…’åº—", dates: "12/22-12/24", address: "æ²³å£æ¹–" },
                { name: "Land About Tokyo", dates: "12/24-12/28", address: "é¶¯è°·/ä¸Šé‡" }
            ],
            emergency: [
                { name: "æ—…å¤–åœ‹äººæ€¥é›£æ•‘åŠ©", phone: "+81-3-3280-7717" },
                { name: "å ±è­¦", phone: "110" },
                { name: "æ•‘è­·è»Š", phone: "119" }
            ]
        };

        // --- ICONS & UTILITIES (ä¿æŒä¸è®Š) ---
        const IconMap = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        );
        const IconExchange = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>
        );
        const IconLink = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
        );
        const IconWeather = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
        );
        const IconArrowLeft = ({ className }) => (
             <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 19l-7-7m0 0l7-7m-7 7h18" /></svg>
        );
        const IconArrowRight = ({ className }) => (
             <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M14 5l7 7m0 0l-7 7m7-7H3" /></svg>
        );
        const IconList = ({ className }) => (
             <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 6h16M4 12h16M4 18h16" /></svg>
        );
        
        const generateDayMapLink = (events) => {
            const destinationTitles = events
                .filter(e => e.link && e.type !== 'transport' && e.type !== 'hotel')
                .map(e => e.title)
                .filter(t => t); 
            
            if (destinationTitles.length === 0) return '#';
            
            const query = destinationTitles.join(' ');
            
            return `https://maps.app.goo.gl/4vPwvUh3fD3yXnQi8${encodeURIComponent(query)}`;
        };

        // æ ¹æ“šä¸»é¡Œæ±ºå®šå¡ç‰‡æ¨£å¼
        const getCardClass = (theme) => {
             const config = themeConfig[theme] || themeConfig.default;
             return config.isDark ? 'glass-dark' : 'glass-light';
        };

        // **[æ–°å¢/å„ªåŒ–] ç°¡æ˜“ç‰ˆæ¯å°æ™‚å¤©æ°£é å ±**
        function HourlyWeatherForecast({ temperatures, hourRange, weather }) {
            if (!temperatures || temperatures.length < 2) return null;
            
            // è§£ææ™‚é–“ç¯„åœï¼Œè¨ˆç®—èµ·å§‹å°æ™‚
            const startTimeStr = hourRange.split(' - ')[0]; // æå– "XX:XX"
            const startHour = parseInt(startTimeStr.split(':')[0]);
            
            // æ ¹æ“šä¸»å¤©æ°£æè¿°ï¼Œé¸æ“‡ç°¡æ˜“åœ–ç¤º
            const getWeatherIcon = () => {
                const w = weather.toLowerCase();
                if (w.includes('sunny') || w.includes('clear')) return 'â˜€ï¸';
                if (w.includes('cloudy')) return 'â˜ï¸';
                if (w.includes('snow')) return 'â„ï¸';
                if (w.includes('rain')) return 'ğŸŒ§ï¸';
                return 'ğŸŒ¥ï¸';
            };
            
            // é¡¯ç¤º 8 å€‹å°æ™‚çš„é å ±æ•¸æ“š
            const hourlyData = temperatures.slice(0, 8);
            const minTemp = Math.min(...temperatures);
            const maxTemp = Math.max(...temperatures);

            return (
                <div className="mt-4 w-full">
                    {/* Header showing daily range */}
                    <p className="text-sm font-bold text-white mb-3 ml-2 flex items-center">
                         <IconWeather className="w-4 h-4 mr-1" />
                        ä»Šæ—¥é å ±: {minTemp}Â°C ~ {maxTemp}Â°C ({weather})
                    </p>
                    
                    <div className="flex overflow-x-auto hide-scrollbar space-x-2 pb-2">
                        {hourlyData.map((temp, index) => (
                            <div key={index} 
                                 className="flex-shrink-0 w-16 text-center p-2 rounded-xl bg-black/10 backdrop-blur-sm shadow-inner transition-transform hover:scale-105"
                                 // ä½¿ç”¨ç°¡ç´„é‚Šæ¡†ä¾†å®šç¾©å€å¡Šï¼Œèˆ‡èƒŒæ™¯é¡è‰²å½¢æˆå°æ¯”
                                 style={{ border: '1px solid rgba(255, 255, 255, 0.4)' }}
                            >
                                {/* Time */}
                                <p className="text-xs font-medium text-white/80 mb-1">{startHour + index}:00</p>
                                {/* Icon */}
                                <p className="text-2xl mb-1 leading-none">{getWeatherIcon()}</p>
                                {/* Temperature */}
                                <p className="text-lg date-style font-bold text-white">{temp}Â°C</p>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        // å–®ä¸€äº‹ä»¶å¡ç‰‡å…ƒä»¶ (ä¿æŒä¸è®Š)
        function EventCard({ event, isDarkTheme }) {
            const getIcon = (type) => {
                switch (type) {
                    case 'transport': return 'âœˆï¸';
                    case 'hotel': return 'ğŸ¨';
                    case 'sight': return 'ğŸ¯';
                    case 'food': return 'ğŸœ';
                    case 'shop': return 'ğŸ›ï¸';
                    case 'home': return 'ğŸ ';
                    default: return 'ğŸ“';
                }
            };

            const departureTime = event.suggested_departure;
            // ç¢ºä¿é¡è‰²é©æ‡‰æ·ºè‰²å¡ç‰‡ (glass-light) æˆ–æ·±è‰²å¡ç‰‡ (glass-dark)
            const textColor = isDarkTheme ? 'text-gray-50' : 'text-gray-800';
            const noteColor = isDarkTheme ? 'text-gray-300' : 'text-gray-700';
            const subNoteColor = isDarkTheme ? 'text-gray-400' : 'text-gray-500';
            const dividerColor = isDarkTheme ? 'border-gray-700' : 'border-gray-200';

            return (
                <div className={`flex items-start py-4 border-b ${dividerColor} last:border-b-0`}>
                    <div className="flex-shrink-0 mr-4 text-center">
                        <div className="text-2xl">{getIcon(event.type)}</div>
                        <div className={`text-xs ${subNoteColor} font-semibold`}>{event.time}</div>
                    </div>
                    <div className="flex-grow">
                        <div className="flex justify-between items-start mb-1">
                            <h3 className={`text-lg font-bold ${textColor} leading-snug`}>{event.title}</h3>
                            {departureTime && (
                                <div className="text-right ml-4 flex-shrink-0">
                                    <p className={`text-xs ${subNoteColor}`}>å»ºè­°å‡ºç™¼</p>
                                    <p className="text-xl date-style font-bold text-red-500 leading-none mt-0.5">{departureTime}</p>
                                </div>
                            )}
                        </div>
                        
                        {event.event_note && (
                            <p className={`text-sm ${noteColor} mb-1 leading-snug`}>
                                <span className={`font-semibold ${textColor}`}>å‚™è¨»: </span>{event.event_note}
                            </p>
                        )}
                        {event.transport_note && (
                            <p className={`text-xs ${subNoteColor} italic mb-1`}>
                                äº¤é€š: {event.transport_note}
                            </p>
                        )}
                        
                        {(event.link || event.tags?.length > 0) && (
                            <div className="mt-2 flex flex-wrap items-center">
                                {event.tags && event.tags.map(tag => (
                                    <span key={tag} className="text-xs font-medium bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-full mr-2 mb-1">
                                        {tag}
                                    </span>
                                ))}
                                {event.link && (
                                    <a href={event.link} target="_blank" rel="noopener noreferrer" className={`text-sm ${isDarkTheme ? 'text-blue-400 hover:text-blue-200' : 'text-blue-600 hover:text-blue-800'} transition duration-150 ease-in-out flex items-center mb-1`}>
                                        <IconLink className="w-4 h-4 mr-1" />
                                        æŸ¥çœ‹è©³æƒ… (åœ°åœ–/ç¶²ç«™)
                                    </a>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // æ¯æ—¥è¡Œç¨‹å¡ç‰‡å…ƒä»¶
        function TripCard({ trip }) {
            const mapLink = generateDayMapLink(trip.events);
            const { isDark } = getBackgroundStyle(trip.theme);
            const cardClass = getCardClass(trip.theme); // æ ¹æ“šä¸»é¡Œæ±ºå®šå¡ç‰‡é¡è‰² (æ·±/æ·º)

            // å¾ "12/20 (Sat)" ä¸­æå– "Sat" å’Œ "20"
            const dateParts = trip.date.match(/(\d{2})\s\((\w{3})\)/);
            const dayOfWeek = dateParts ? dateParts[2].toUpperCase() : 'DAY';
            const dateNumber = dateParts ? dateParts[1] : trip.day;

            return (
                <div className={`${cardClass} card-shadow rounded-2xl overflow-hidden mb-6 mx-4`}>
                    
                    {/* Header with Date and Location */}
                    <div className="p-4">
                        <div className="flex justify-between items-start">
                             {/* [å„ªåŒ–] æ˜ŸæœŸå¹¾å’Œæ—¥æœŸé¢¨æ ¼ */}
                            <div className="flex items-end space-x-2">
                                <div className="text-center">
                                    <p className="text-sm date-style font-bold opacity-70">{dayOfWeek}</p>
                                    <h2 className="text-5xl date-style font-bold leading-none">{dateNumber}</h2>
                                </div>
                                <div className="pb-1">
                                    <p className="text-base date-style font-bold leading-tight">DAY {trip.day}</p>
                                    <p className="text-sm date-style font-medium opacity-80">{trip.location}</p>
                                </div>
                            </div>
                            
                            {/* åœ°åœ–æŒ‰éˆ• */}
                             {mapLink !== '#' && (
                                <a href={mapLink} target="_blank" rel="noopener noreferrer" className={`flex-shrink-0 mt-2 text-sm font-bold py-2 px-3 rounded-full transition-colors flex items-center ${isDark ? 'bg-white/20 hover:bg-white/30 text-white' : 'bg-gray-100 hover:bg-gray-200 text-gray-700'}`}>
                                    <IconMap className="w-5 h-5 mr-1" />
                                    ä»Šæ—¥åœ°åœ–
                                </a>
                            )}
                        </div>
                        
                        {/* ç°¡æ˜“ç‰ˆæ¯å°æ™‚å¤©æ°£é å ± (å·²å„ªåŒ–) */}
                        <HourlyWeatherForecast 
                            temperatures={trip.temperature} 
                            hourRange={trip.temp_hour_range}
                            weather={trip.weather}
                        />
                    </div>

                    {/* Events List */}
                    <div className={`p-4 divide-y ${isDark ? 'divide-gray-700' : 'divide-gray-200'}`}>
                        {trip.events.map((event, index) => (
                            <EventCard key={index} event={event} isDarkTheme={isDark} />
                        ))}
                    </div>
                </div>
            );
        }

        // åˆ†å¸³ç³»çµ±å…ƒä»¶ (ä¿æŒä¸è®Š)
        function Splitter({ budgetItems, setBudgetItems }) {
            const [splitItem, setSplitItem] = useState({ name: '', cost: '', paidBy: TRAVELERS[0] });
            const [exchangeRate, setExchangeRate] = useState(DEFAULT_RATE);
            const [jpyInput, setJpyInput] = useState('');

            const convertedTWD = useMemo(() => {
                const jpy = Number(jpyInput);
                const rate = Number(exchangeRate);
                if (isNaN(jpy) || isNaN(rate) || jpy <= 0 || rate <= 0) return '0';
                return (jpy * rate).toFixed(0).toLocaleString();
            }, [jpyInput, exchangeRate]);
            
            const calculateFinalBalances = () => {
                const balances = {};
                TRAVELERS.forEach(t => balances[t] = 0); 

                const totalCost = budgetItems.reduce((acc, curr) => acc + Number(curr.cost), 0);
                
                if (TRAVELERS.length === 0 || totalCost === 0) return balances;

                const costPerPerson = totalCost / TRAVELERS.length;
                
                budgetItems.forEach(item => {
                    if (item.paidBy && TRAVELERS.includes(item.paidBy)) {
                        balances[item.paidBy] += Number(item.cost);
                    }
                });

                TRAVELERS.forEach(t => {
                    balances[t] = balances[t] - costPerPerson;
                });
                
                return balances;
            };

            const balances = calculateFinalBalances();
            const totalCost = budgetItems.reduce((acc, curr) => acc + Number(curr.cost), 0);

            const handleAddItem = (e) => {
                e.preventDefault();
                if (splitItem.name && Number(splitItem.cost) > 0) {
                    setBudgetItems([...budgetItems, { ...splitItem, cost: Number(splitItem.cost) }]);
                    setSplitItem({ name: '', cost: '', paidBy: TRAVELERS[0] });
                }
            };
            
            const getBalanceColor = (balance) => {
                if (balance > 0) return 'text-green-600 bg-green-100';
                if (balance < 0) return 'text-red-600 bg-red-100';
                return 'text-gray-600 bg-gray-100';
            };


            return (
                <div className="p-5">
                    <h2 className="text-xl font-bold mb-3 border-b pb-2 text-indigo-700">æ—…è²»åˆ†å¸³èˆ‡åŒ¯ç‡å·¥å…·</h2>
                    
                    {/* åŒ¯ç‡æ›ç®—å€å¡Š */}
                    <div className="mb-6 p-4 rounded-xl bg-indigo-50 border border-indigo-200">
                        <h3 className="text-lg font-semibold mb-2 flex items-center text-indigo-800">
                            <IconExchange className="w-5 h-5 mr-2" />
                            æ—¥å¹£ (JPY) æ›ç®—
                        </h3>
                        <div className="flex space-x-2 mb-2 items-center">
                            <label className="text-sm font-medium text-gray-700">å³æ™‚åŒ¯ç‡ (TWD/JPY):</label>
                            <input
                                type="number"
                                step="0.001"
                                value={exchangeRate}
                                onChange={(e) => setExchangeRate(e.target.value)}
                                className="w-20 text-center p-1 border rounded-md text-sm"
                            />
                        </div>
                        <div className="flex space-x-2 items-center">
                            <input
                                type="number"
                                placeholder="è¼¸å…¥æ—¥å¹£é‡‘é¡ (Â¥)"
                                value={jpyInput}
                                onChange={(e) => setJpyInput(e.target.value)}
                                className="w-full p-2 border border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
                            />
                            <p className="text-xl font-bold text-red-600">
                                â {convertedTWD} NTD
                            </p>
                        </div>
                    </div>
                    
                    {/* åˆ†å¸³çµæœå€å¡Š */}
                    <div className="mb-6">
                        <h3 className="text-lg font-semibold mb-3 text-gray-800">ç¸½çµç®— ({TRAVELERS.length} äººå¹³åˆ†)</h3>
                        <div className="flex justify-between items-center mb-2 p-2 bg-gray-100 rounded-lg">
                            <p className="font-semibold text-sm">ç¸½èŠ±è²» (JPY):</p>
                            <p className="font-bold text-lg text-indigo-600">Â¥{totalCost.toLocaleString()}</p>
                        </div>
                        {/* ç¶²æ ¼æ•¸æ ¹æ“š TRAVELERS.length æ±ºå®š */}
                        <div className={`grid grid-cols-${TRAVELERS.length} gap-2 text-center`}> 
                            {TRAVELERS.map(traveler => (
                                <div key={traveler} className={`p-2 rounded-lg text-sm font-semibold border ${getBalanceColor(balances[traveler])}`}>
                                    {traveler}: <br />
                                    {balances[traveler] > 0 ? `æ‡‰æ”¶ Â¥${balances[traveler].toLocaleString()}` : 
                                     (balances[traveler] < 0 ? `æ‡‰ä»˜ Â¥${(-balances[traveler]).toLocaleString()}` : `çµæ¸…`)}
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    {/* æ–°å¢é …ç›®è¡¨å–® */}
                    <h3 className="text-lg font-semibold mb-3 text-gray-800">æ–°å¢åˆ†å¸³é …ç›®</h3>
                    <form onSubmit={handleAddItem} className="space-y-3 p-4 bg-white border rounded-xl">
                        <input
                            type="text"
                            placeholder="é …ç›®åç¨± (ä¾‹å¦‚: æ™šé¤)"
                            value={splitItem.name}
                            onChange={(e) => setSplitItem({ ...splitItem, name: e.target.value })}
                            className="w-full p-2 border rounded-md"
                            required
                        />
                        <input
                            type="number"
                            placeholder="é‡‘é¡ (æ—¥å¹£ Â¥)"
                            value={splitItem.cost}
                            onChange={(e) => setSplitItem({ ...splitItem, cost: e.target.value })}
                            className="w-full p-2 border rounded-md"
                            required
                        />
                        <select
                            value={splitItem.paidBy}
                            onChange={(e) => setSplitItem({ ...splitItem, paidBy: e.target.value })}
                            className="w-full p-2 border rounded-md bg-white"
                        >
                            {TRAVELERS.map(t => (
                                <option key={t} value={t}>{t} æ”¯ä»˜</option>
                            ))}
                        </select>
                        <button type="submit" className="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700 transition">
                            è¨˜å¸³
                        </button>
                    </form>
                    
                    {/* é …ç›®æ¸…å–® */}
                    <div className="mt-5 max-h-48 overflow-y-auto hide-scrollbar border rounded-xl bg-white">
                        <h4 className="text-md font-semibold p-3 sticky top-0 bg-gray-50 border-b">é …ç›®æ˜ç´°</h4>
                        <ul className="divide-y">
                            {budgetItems.map((item, index) => (
                                <li key={index} className="flex justify-between items-center p-3 text-sm">
                                    <div className="flex-grow">
                                        <p className="font-medium text-gray-800">{item.name}</p>
                                        <p className="text-xs text-gray-500">ä»˜æ¬¾äºº: {item.paidBy}</p>
                                    </div>
                                    <p className="font-bold text-red-500">Â¥{item.cost.toLocaleString()}</p>
                                </li>
                            ))}
                        </ul>
                        {budgetItems.length === 0 && <p className="text-center text-gray-500 py-4 text-sm">å°šç„¡è¨˜å¸³é …ç›®</p>}
                    </div>
                </div>
            );
        }

        // é ‚å±¤æ‡‰ç”¨ç¨‹å¼å…ƒä»¶
        function App() {
            const [activeTab, setActiveTab] = useState('schedule');
            const [selectedDay, setSelectedDay] = useState(1);
            const [budgetItems, setBudgetItems] = useState(() => {
                try {
                    const saved = localStorage.getItem('tripBudgetItems');
                    return saved ? JSON.parse(saved) : [];
                } catch (error) {
                    console.error("Could not load budget items from localStorage", error);
                    return [];
                }
            }); 
            
            useEffect(() => {
                localStorage.setItem('tripBudgetItems', JSON.stringify(budgetItems));
            }, [budgetItems]);


            const totalDays = tripData.length;
            const currentTrip = tripData.find(trip => trip.day === selectedDay);
            const currentTheme = currentTrip ? currentTrip.theme : 'default';

            // **[å„ªåŒ–] æ ¹æ“šé¸å®šæ—¥æœŸæ”¹è®Š body èƒŒæ™¯**
            useEffect(() => {
                const { className, style, isDark } = getBackgroundStyle(currentTheme);
                
                // æ‡‰ç”¨ class å’Œ style åˆ° body
                document.body.className = `${className} antialiased`;
                document.body.style.backgroundImage = style.backgroundImage || '';
                document.body.style.backgroundColor = style.backgroundColor || '';

                // èª¿æ•´æ ¹å…ƒç´ æ–‡å­—é¡è‰²ä»¥é©æ‡‰èƒŒæ™¯
                const rootElement = document.getElementById('root');
                if (rootElement) {
                     rootElement.className = `max-w-xl mx-auto min-h-screen pb-20 ${isDark ? 'text-white' : 'text-gray-800'}`;
                }

            }, [currentTheme]);

            const handlePrevDay = () => {
                setSelectedDay(prev => Math.max(1, prev - 1));
            };

            const handleNextDay = () => {
                setSelectedDay(prev => Math.min(totalDays, prev + 1));
            };

            const tabClass = (tabName) => 
                `flex-1 py-3 px-1 text-center font-bold text-sm transition-colors duration-200 ${
                    activeTab === tabName 
                        ? 'text-indigo-600 border-b-4 border-indigo-600' 
                        : 'text-gray-500 hover:text-gray-700'
                }`;

            return (
                <div id="root" className="max-w-xl mx-auto min-h-screen pb-20"> 
                    {/* Header ä¿æŒç»ç’ƒæ¨£å¼ï¼Œè®“èƒŒæ™¯é€å‡º */}
                    <header className="sticky top-0 z-50 bg-white/70 backdrop-blur-md shadow-lg border-b border-gray-200">
                        <div className="flex justify-around items-center pt-3">
                            <h1 className="text-2xl font-bold px-4 text-gray-800">
                                âœˆï¸ æ—¥æœ¬é—œè¥¿å¯Œå£«è¡Œ 2025
                            </h1>
                        </div>
                        
                        {/* Tab Bar */}
                        <div className="flex border-t mt-3">
                            <button className={tabClass('schedule')} onClick={() => setActiveTab('schedule')}>
                                <IconList className="w-5 h-5 inline mr-1" />æ¯æ—¥è¡Œç¨‹
                            </button>
                            <button className={tabClass('flights')} onClick={() => setActiveTab('flights')}>
                                æ©Ÿç¥¨/ä½å®¿
                            </button>
                            <button className={tabClass('split')} onClick={() => setActiveTab('split')}>
                                åˆ†å¸³å·¥å…·
                            </button>
                        </div>
                        
                        {/* Day Selector for Schedule Tab */}
                        {activeTab === 'schedule' && (
                            <div className="flex justify-between items-center p-3 bg-white/50 border-t border-gray-200">
                                <button 
                                    onClick={handlePrevDay} 
                                    disabled={selectedDay === 1}
                                    className={`p-2 rounded-full transition-colors ${selectedDay === 1 ? 'text-gray-400' : 'bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-600'}`}
                                >
                                    <IconArrowLeft className="w-6 h-6" />
                                </button>
                                <div className="text-center font-bold text-xl text-gray-800">
                                    DAY {selectedDay} / {totalDays}
                                </div>
                                <button 
                                    onClick={handleNextDay} 
                                    disabled={selectedDay === totalDays}
                                    className={`p-2 rounded-full transition-colors ${selectedDay === totalDays ? 'text-gray-400' : 'bg-indigo-500/10 hover:bg-indigo-500/20 text-indigo-600'}`}
                                >
                                    <IconArrowRight className="w-6 h-6" />
                                </button>
                            </div>
                        )}
                    </header>
                    
                    <main className="pt-4">
                        {/* æ¯æ—¥å–®é è¡Œç¨‹ */}
                        {activeTab === 'schedule' && currentTrip && (
                            <TripCard trip={currentTrip} />
                        )}
                        
                        {activeTab === 'flights' && (
                            <div className="p-5 space-y-6">
                                {/* ä½¿ç”¨ç»ç’ƒæ·ºè‰²å¡ç‰‡ */}
                                <div className="glass-light p-5 rounded-xl card-shadow">
                                    <h3 className="text-xl font-bold mb-3 text-gray-800 border-b pb-2">æ©Ÿç¥¨è³‡è¨Š</h3>
                                    {toolsData.flights.map((flight, index) => (
                                        <div key={index} className="mb-4 border-b border-gray-200 last:border-b-0 pb-3">
                                            <p className="text-sm font-semibold">{flight.leg} ({flight.code})</p>
                                            <p className="text-lg font-bold text-indigo-600">{flight.time}</p>
                                            <p className="text-xs text-gray-500">æ©Ÿå ´: {flight.airport}</p>
                                        </div>
                                    ))}
                                </div>
                                <div className="glass-light p-5 rounded-xl card-shadow">
                                    <h3 className="text-xl font-bold mb-3 text-gray-800 border-b pb-2">ä½å®¿è³‡è¨Š</h3>
                                    {toolsData.hotels.map((hotel, index) => (
                                        <div key={index} className="mb-4 border-b border-gray-200 last:border-b-0 pb-3">
                                            <p className="text-sm font-semibold">{hotel.name}</p>
                                            <p className="text-base text-gray-700">{hotel.dates}</p>
                                            <p className="text-xs text-gray-500">åœ°é»: {hotel.address}</p>
                                        </div>
                                    ))}
                                </div>
                                <div className="glass-light p-5 rounded-xl card-shadow bg-red-50">
                                    <h3 className="text-xl font-bold mb-3 text-red-700 border-b pb-2">ç·Šæ€¥è¯çµ¡</h3>
                                    {toolsData.emergency.map((contact, index) => (
                                        <div key={index} className="mb-4 border-b border-red-200 last:border-b-0 pb-3">
                                            <p className="text-sm font-semibold text-red-600">{contact.name}</p>
                                            <p className="text-lg font-bold text-red-800">{contact.phone}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'split' && (
                            <div className="glass-light card-shadow rounded-2xl mx-4">
                                <Splitter budgetItems={budgetItems} setBudgetItems={setBudgetItems} />
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        // æ¸²æŸ“æ‡‰ç”¨ç¨‹å¼
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

