<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SL Japan Travel 2025</title>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Playfair+Display:wght=700&display=swap" rel="stylesheet">
    
    <style>
        /* åŸºç¤æ¨£å¼å’Œå­—é«” */
        body { 
            font-family: 'Noto Sans JP', sans-serif; 
            background-color: #FBF9F2; 
            transition: background-color 0.5s;
            -webkit-tap-highlight-color: transparent; 
        }
        /* éš±è—æ»¾å‹•æ¢ */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* æ ¸å¿ƒä¸»é¡Œæ¨£å¼ */
        .theme-simple {
             background-color: #FBF9F2; 
             color: #333; 
        }

        /* ç°¡ç´„æ·ºè‰²å¡ç‰‡ (ç»ç’ƒæ„Ÿ) */
        .glass-light { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px); 
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-shadow { box-shadow: 0 4px 25px rgba(0,0,0,0.1); }

        /* å°ˆç”¨æ–¼æ—¥æœŸçš„è¥¯ç·šå­—é«” */
        .date-style { font-family: 'Playfair Display', serif; }
        
        /* è¨­å®šåˆ†å¸³ç³»çµ±ç¶²æ ¼æ•¸ */
        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
        
        /* ä¿®æ­£ React 18 è­¦å‘Š */
        #root {
            min-height: 100vh;
        }
        
        /* è²»ç”¨è¼¸å…¥æ¡†æ¨£å¼ */
        .expense-input {
            width: 100%;
            padding: 4px 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 0.875rem; /* text-sm */
            text-align: right;
            transition: border-color 0.2s;
        }
        .expense-input:focus {
            outline: none;
            border-color: #4f46e5; /* indigo-600 */
        }
    </style>
</head>
<body class="bg-[#FBF9F2] text-gray-800 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        const TRAVELERS = ['Sophie', 'Li'];
        const DEFAULT_RATE = 0.22; // åŒ¯ç‡ä½”ä½ç¬¦
        
        // --- DATA SOURCE & CONFIGS ---

        // äº¤é€šã€ä½å®¿ã€ç·Šæ€¥è³‡è¨Š åŠ é›»å­ç¥¨åˆ¸
        const toolsData = {
            flights: [
                { leg: "å»ç¨‹", code: "IT206", time: "12/20 09:00 TPE -> 14:00 NGO", airport: "TPE/NGO" },
                { leg: "å›ç¨‹", code: "MM625", time: "12/28 16:35 NRT -> 20:00 TPE", airport: "NRT T1" }
            ],
            hotels: [
                { 
                    name: "VIA INN åå¤å±‹ç«™å‰æ¤¿ç”º", 
                    dates: "12/20-12/22", 
                    address: "æ„›çŸ¥ç¸£åå¤å±‹å¸‚ä¸­æ‘å€æ¤¿ç”º9-13 (ã€’453-0015)", 
                    phone: "+81-52-451-5489" 
                },
                { 
                    name: "MYSTAYS å¯Œå£«å±±å±•æœ›æ¸©æ³‰é…’åº—", 
                    dates: "12/22-12/24", 
                    address: "å±±æ¢¨ç¸£å¯Œå£«å‰ç”°å¸‚æ–°å€‰2654 (ã€’403-0011)", 
                    phone: "+81-555-21-7510" 
                },
                { 
                    name: "Land About Tokyo", 
                    dates: "12/24-12/28", 
                    address: "æ±äº¬éƒ½å°æ±å€æ ¹å²¸3-4-5 (ã€’110-0003)", 
                    phone: "+81-3-6802-4431" 
                }
            ],
            emergency: [
                { name: "æ—…å¤–åœ‹äººæ€¥é›£æ•‘åŠ©", phone: "+81-3-3280-7717" },
                { name: "å ±è­¦", phone: "110" },
                { name: "æ•‘è­·è»Š", phone: "119" }
            ],
            // é›»å­ç¥¨åˆ¸/QR Code å€åŸŸ (è«‹è‡ªè¡Œæ›¿æ›ç‚ºæ‚¨çš„å¯¦éš›é€£çµ)
            tickets: [
                { 
                    name: "Shibuya Sky å±•æœ›å°é–€ç¥¨", 
                    date: "12/25", 
                    type: "QR Code/PDF", 
                    link: "https://www.klook.com/zh-TW/activity/37777-shibuya-sky-tokyo/" // Klook é€£çµä½”ä½
                },
                { 
                    name: "å¯Œå£«æ€¥æ¨‚åœ’é€šç¥¨", 
                    date: "12/23", 
                    type: "Barcode/Link", 
                    link: "https://www.fujiq.jp/en/ticket/index.html" // å¯Œå£«æ€¥æ¨‚åœ’é€šç¥¨å®˜ç¶²
                },
                {
                    name: "Harbs è›‹ç³•å…Œæ›åˆ¸", 
                    date: "12/20", 
                    type: "Image",
                    link: "https://via.placeholder.com/150/0000FF/FFFFFF?text=Harbs+QR" 
                }
            ]
        };

        const THEME_COLOR = 'bg-[#FBF9F2]'; 
        const themeConfig = {
            city: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            // ... å…¶ä»–ä¸»é¡Œé…ç½®
            default: { isDark: false, url: null, fallbackColor: THEME_COLOR }
        };

        const getBackgroundStyle = (theme) => {
            const config = themeConfig[theme] || themeConfig.default;
            return {
                className: `theme-simple ${config.fallbackColor} transition-colors duration-500`,
                style: { backgroundColor: '#FBF9F2' },
                isDark: config.isDark 
            };
        };

        const tripData = [
            // Day 1 (12/20) - åå¤å±‹æŠµé”
            {
                day: 1, date: "12/20 (Sat)", location: "Nagoya", weather: "sunny",
                temperature: [8, 10, 12, 14, 13, 11, 9, 8], 
                temp_hour_range: "10:00 - 18:00",
                daily_pass: "åéµå–®ç¨‹ç¥¨ (æ©Ÿå ´åˆ°é£¯åº—) + åå¤å±‹åœ°éµé€±æœ«ç’°ä¿ç¥¨ (Donichi Eco Kippu, 600 JPY)",
                memo: "Day 1 å‚™è¨»ï¼šè«‹ç¢ºä¿åéµç‰¹æ€¥è»Šç¥¨å·²è³¼è²·ã€‚**å‰›åˆ°æ—¥æœ¬å…ˆæ›å¥½ç¶²å¡ã€‚**", 
                events: [
                    { time: "09:00", title: "æ¡ƒåœ’ (TPE) âœˆï¸ åå¤å±‹ (NGO)", type: "transport", transport_note: "è™èˆª IT206 (è«‹è‡ªè¡Œç¢ºèªç™»æ©Ÿæ™‚é–“)", event_note: "Check-in & å‡ºå¢ƒ | D1 ç­æ©Ÿè³‡è¨Š", link: "" },
                    { time: "14:00-14:40", title: "æŠµé”NGO é€›è¡—", type: "leisure", transport_note: "", event_note: "æ©Ÿå ´é€›é€›", link: "" },
                    { time: "14:40-15:00", title: "æ©Ÿå ´å°åƒ", type: "food", transport_note: "", event_note: "åœ¨æ©Ÿå ´ç°¡å–®åƒé»æ±è¥¿", link: "" },
                    { time: "15:00-15:50", title: "å‰å¾€é£¯åº—æ”¾è¡Œæ", type: "accommodation", transport_note: "VIA INN åå¤å±‹ç«™å‰æ¤¿ç”º", event_note: "ç‰¹æ€¥+èµ°è·¯ç´„ 40 åˆ†é˜ï¼Œæº–æ€¥+èµ°è·¯ç´„ 50 åˆ†é˜", link: "https://maps.app.goo.gl/g6978G6f9Z7n9bL49" },
                    { time: "16:00-16:30", title: "å‰å¾€å¤§é ˆè§€éŸ³", type: "sight", transport_note: "åœ°éµ | å¤§é ˆè§€éŸ³ç«™", event_note: "é ç•™ 30 åˆ†é˜æŠ“å¯¶å¯å¤¢", link: "https://maps.app.goo.gl/vG6w4K9uL8K2hC3X8" },
                    { time: "17:30-æ™šä¸Š", title: "å¤§é ˆè§€éŸ³ & å¤§é ˆå•†åº—è¡—", type: "shopping", transport_note: "åœ°éµ | å¤§é ˆè§€éŸ³ç«™", event_note: "å¤šæ•¸åº—å®¶ç‡Ÿæ¥­è‡³ 20:00", link: "https://maps.app.goo.gl/9w8A2YfHqX7qL5Yw5" },
                    { time: "æ™šé¤", title: "æ™šé¤ï¼šé°»é­šé£¯æˆ–å‘³å™Œè±¬æ’ (Op. 1 å¤©å©¦ç¾…è±¬æ’ å¤©å©¦ç¾…ç”ºæœ¬åº—)", type: "food", event_note: "è‹¥ D1 æ²’åƒåˆ° Harbs ç”œé»ï¼Œå¯åœ¨æ­¤æ™‚æ®µè£œåƒ", link: "https://maps.app.goo.gl/z69R5A7fB5R7zN9m7" },
                    { time: "æ™šä¸Š", title: "æ¦®å•†åœˆ / SKY-LE / UNIQLO GU", type: "shopping", event_note: "UNIQLO GU (~20:00), SKY-LE (~21:00)", link: "https://maps.app.goo.gl/yBw4g8cW7M2wL5Hw8" },
                    { time: "æ™šä¸Š", title: "ç¶ æ´²21 æ‹ç…§ / åƒé‡Œé¦¬è—¥å±€", type: "leisure", transport_note: "", event_note: "ç¶ æ´² 21 æ‹å¤œæ™¯ï¼Œåƒé‡Œé¦¬è—¥å±€ç‡Ÿæ¥­è‡³ 22:00ï¼Œå›é£¯åº—æ™‚å¯ç¶“éé€›é€›", link: "https://maps.app.goo.gl/y6K2vC3X8L8K4vG6f" }
                ]
            },
            // Day 2 (12/21) - å¤åŸæ–‡åŒ–ä¹‹æ—…
            {
                day: 2, date: "12/21 (Sun)", location: "Nagoya", weather: "cloudy",
                temperature: [7, 8, 10, 11, 10, 9, 8, 7], 
                temp_hour_range: "09:00 - 17:00",
                daily_pass: "åå¤å±‹åœ°éµé€±æœ«ç’°ä¿ç¥¨ (Donichi Eco Kippu, 600 JPY)",
                memo: "Day 2 å‚™è¨»ï¼šä»Šå¤©å¤šåˆ©ç”¨åœ°éµä¸€æ—¥åˆ¸ã€‚å»ºè­°è³¼è²·åéµçŠ¬å±±ç‰¹æ€¥è»Šç¥¨ã€‚",
                events: [
                    { time: "07:00-07:30", title: "é£¯åº—æ—©é¤", type: "food", event_note: "é–‹æ”¾æ™‚é–“ 06:30-09:30", link: "" },
                    { time: "07:30-09:00", title: "å‰å¾€çŠ¬å±±åŸ", type: "transport", transport_note: "åéµçŠ¬å±±ç·š MuSKY (æ‰€æœ‰å¸­ä½å‡ç‚ºæŒ‡å®šå¸­)", event_note: "æ—©é»å‡ºç™¼é¿é–‹äººæ½®", link: "https://maps.app.goo.gl/hG9yF8m3Z7n9bL49" },
                    { time: "09:00-10:00", title: "æ´—éŒ¢ / ä¸‰å…‰ç¨»è·ç¥ç¤¾", type: "sight", event_note: "ä¸‰å…‰ç¨»è·ç¥ç¤¾ (åœ¨çŠ¬å±±åŸè·¯ä¸Š)", link: "https://maps.app.goo.gl/E8G9fD3X8L8K4vG6f" },
                    { time: "10:00-12:00", title: "çŠ¬å±±åŸä¸‹ç”º", type: "sight", event_note: "é€›çŠ¬å±±åŸä¸‹ç”ºï¼Œå“åšç•¶åœ°å°åƒ", link: "https://maps.app.goo.gl/hW4g8cW7M2wL5Hw8" },
                    { time: "12:00-13:00", title: "åˆé¤ï¼šé£›é¨¨ç‰›ç‡’è‚‰å°ˆé–€åº— (è‚‰å…µè¡›æœ¬åº—æˆ–çŠ¬å±±å°ç´‹)", type: "food", event_note: "éœ€ç¢ºèªç‡Ÿæ¥­æ™‚é–“", link: "https://maps.app.goo.gl/z4R7zN9m7B5R5A7f" },
                    { time: "13:00-14:30", title: "å‰å¾€åå¤å±‹åŸ", type: "transport", transport_note: "åéµå°ç‰§ç·š > ä¸Šé£¯ç”°ç«™ (ä¸æ›ä¹˜) > ä¸Šé£¯ç”°ç·š >å¹³å®‰é€šç«™ (æ›ä¹˜) > ååŸç·š > åå¤å±‹åŸç«™", event_note: "æ³¨æ„åå¤å±‹åŸçš„äº¤é€šè½‰æ›", link: "https://maps.app.goo.gl/uR6tF8m3Z7n9bL49" },
                    { time: "14:30-16:00", title: "åå¤å±‹åŸ", type: "sight", event_note: "äº¤é€šåˆ¸æ›å…¥å ´åˆ¸ï¼Œæ³¨æ„é—œé–€æ™‚é–“ (16:30)", link: "https://maps.app.goo.gl/T8G9fD3X8L8K4vG6f" },
                    { time: "16:30-18:00", title: "æ™šé¤ / åéµç™¾è²¨å•†åœˆ", type: "food", event_note: "è‹¥ D1 æ²’åƒåˆ°é°»é­šé£¯çš„è©±å¯æ­¤æ™‚æ®µåƒ", link: "https://maps.app.goo.gl/hYw4g8cW7M2wL5Hw8" },
                    { time: "æ™šä¸Š", title: "UNIQLO / BicCamera / åƒé‡Œé¦¬è—¥å±€", type: "shopping", event_note: "BicCamera åå¤å±‹è»Šç«™åº—è¥¿åº— / JR TOWER åº— ç‡Ÿæ¥­ (~21:00)ï¼Œåƒé‡Œé¦¬è—¥å±€ç‡Ÿæ¥­è‡³ 22:00", link: "https://maps.app.goo.gl/y6K2vC3X8L8K4vG6f" }
                ]
            },
            // Day 3 (12/22) - æ—©ä¸Šç†±ç”°ç¥å®® & ä¸­åˆå‰å¾€å¯Œå£«å±± ğŸ—»
            {
                day: 3, date: "12/22 (Mon)", location: "Fuji", weather: "rain",
                temperature: [5, 7, 9, 10, 8, 7, 6, 5], 
                temp_hour_range: "08:00 - 16:00",
                daily_pass: "JR é«˜é€Ÿå·´å£« (åå¤å±‹ -> å¯Œå£«æ€¥æ¨‚åœ’)",
                memo: "Day 3 å‚™è¨»ï¼šå‹™å¿…ç¢ºèªé»‘è²“å®…æ€¥ä¾¿å¯„ä»¶ã€‚",
                events: [
                    { time: "08:00", title: "Check-out & è¡Œæå¯„é€", type: "accommodation", event_note: "å°‡å¤§ä»¶è¡Œæå¯„é€åˆ°æ±äº¬ Land About Tokyo (é»‘è²“å®…æ€¥ä¾¿)", link: "" },
                    { time: "09:00", title: "ç†±ç”°ç¥å®®", type: "sight", transport_note: "åéµæˆ–åœ°éµ (ç¥å®®è¥¿ç«™)", event_note: "åƒæ‹œå¾Œéœ€é ç•™æ™‚é–“è¿”å›è»Šç«™", link: "https://maps.app.goo.gl/G6f9Z7n9bL49hG9y" },
                    { time: "11:00", title: "åˆé¤ï¼šåå¤å±‹ç«™é™„è¿‘å¿«é€Ÿç”¨é¤", type: "food", event_note: "åœ¨è»Šç«™å‘¨é‚Šå¿«é€Ÿè§£æ±ºåˆé¤ï¼Œæº–å‚™æ­è»Š", link: "https://maps.app.goo.gl/jR5A7fB5R7zN9m7C" },
                    { time: "12:00", title: "é«˜é€Ÿå·´å£«ï¼šåå¤å±‹ -> å¯Œå£«æ€¥æ¨‚åœ’", type: "transport", transport_note: "JR æ±æµ·é«˜é€Ÿå·´å£« | è»Šç¨‹ç´„ 4.5hrã€‚", event_note: "å·´å£«æ™‚é–“å·²èª¿æ•´è‡³ä¸­åˆã€‚å¸¶é»é›¶é£Ÿå’Œæ°´ã€‚", link: "https://www.japan-guide.com/bus/fuji.html" },
                    { time: "16:30", title: "æŠµé”å¯Œå£«æ€¥æ¨‚åœ’ç«™", type: "transport", event_note: "è½‰ä¹˜è‡³é£¯åº— (å¯èƒ½éœ€æ­ä¹˜è¨ˆç¨‹è»Šæˆ–æ¥é§è»Š)", link: "https://maps.app.goo.gl/A7fB5R7zN9m7CjR5" },
                    { time: "17:30", title: "MYSTAYS å¯Œå£«å±±å±•æœ›æº«æ³‰é…’åº— Check-in", type: "accommodation", event_note: "ç¢ºèªæˆ¿é–“çš„å¯Œå£«å±±æ™¯è§€ï¼", link: "https://maps.app.goo.gl/3X8L8K4vG6fy6K2" },
                    { time: "20:00", title: "æ™šé¤ï¼šé£¯åº—é™„è¿‘æˆ–æº«æ³‰è¨­æ–½ç”¨é¤", type: "food", event_note: "é£¯åº—æº«æ³‰è¨­æ–½æˆ–é™„è¿‘å±…é…’å±‹", link: "" },
                    { time: "21:30", title: "é«”é©—é£¯åº—æº«æ³‰", type: "leisure", event_note: "", link: "" }
                ]
            },
            // Day 4 (12/23) - å¯Œå£«æ€¥æ¨‚åœ’ ğŸ¢
            { 
                day: 4, date: "12/23 (Tue)", location: "Fuji-Q Highland", weather: "sunny", 
                temperature: [2, 5, 8, 10, 9, 7, 5, 3], 
                temp_hour_range: "09:00 - 17:00", 
                daily_pass: "å¯Œå£«æ€¥æ¨‚åœ’é€šç¥¨ (éœ€äº‹å…ˆæ›ç¥¨)", 
                memo: "è«‹å‚™å¦¥é˜²å¯’è¡£ç‰©ï¼Œå±±å€æ°£æº«è¼ƒä½ã€‚å»ºè­°å…ˆç©é«˜äººæ°£çš„é›²éœ„é£›è»Šã€‚", 
                events: [
                    { time: "09:00", title: "å¯Œå£«æ€¥æ¨‚åœ’ é–‹åœ’", type: "amusement", event_note: "ä½¿ç”¨é€šç¥¨å…¥åœ’ï¼Œå»ºè­°å…ˆæ’éšŠç©é«˜é£›è»Šæˆ–ãˆãˆã˜ã‚ƒãªã„ã‹", link: toolsData.tickets[1].link },
                    { time: "12:30", title: "åˆé¤ï¼šæ¨‚åœ’å…§é¤å»³", type: "food", event_note: "åœ¨åœ’å€å…§é¸æ“‡å–œæ­¡çš„ä¸»é¡Œé¤å»³", link: "https://maps.app.goo.gl/K4vG6fy6K2vC3X8L8" },
                    { time: "15:00", title: "é¬¼å±‹æˆ°æ…„è¿·å®® / å…¶ä»–è¨­æ–½", type: "amusement", event_note: "æŒ‘æˆ°ä¸–ç•Œæœ€é•·æœ€å¯æ€•çš„é¬¼å±‹ï¼", link: "https://www.fujiq.jp/en/fujikyu_maps/" },
                    { time: "18:00", title: "æ™šé¤ï¼šæ²³å£æ¹–è»Šç«™é™„è¿‘", type: "food", event_note: "å˜—è©¦ç•¶åœ°çš„é¤ºé£¥éºµ (ã»ã†ã¨ã†) æˆ–ç‡’è‚‰", link: "https://maps.app.goo.gl/9m7CjR5A7fB5R7zN9" },
                    { time: "20:00", title: "è¿”å›é£¯åº—ä¼‘æ¯ / æº«æ³‰", type: "leisure", event_note: "", link: "" }
                ]
            },
            // Day 5 (12/24) - æ²³å£æ¹–è§€å…‰ & å‚æ™šå‰å¾€æ±äº¬ & æ™šä¸Šæ™´ç©ºå¡” ğŸ„
            { 
                day: 5, date: "12/24 (Wed)", location: "Tokyo / Travel Day", weather: "cloudy", 
                temperature: [6, 8, 11, 13, 12, 10, 8, 7], 
                temp_hour_range: "10:00 - 18:00", 
                daily_pass: "å¯Œå£«å±±å‘¨éŠå·´å£« + é«˜é€Ÿå·´å£« (æ²³å£æ¹– -> æ±äº¬)", 
                memo: "ä¸Šåˆå°ˆæ³¨æ–¼å¯Œå£«å±±å‘¨é‚Šè§€å…‰ã€‚ä¸‹åˆæ­ä¹˜æ™šç­å·´å£«å‰å¾€æ±äº¬ã€‚è«‹æå‰ç¢ºèªå·´å£«ç¥¨ã€‚", 
                events: [
                    { time: "09:00", title: "Check-out & å¯„æ”¾è¡Œæ", type: "accommodation", event_note: "è¾¦ç†é€€æˆ¿æ‰‹çºŒï¼Œå°‡è¡Œæå¯„æ”¾åœ¨é£¯åº—æ«ƒå°æˆ–è»Šç«™ç½®ç‰©æ«ƒ", link: "" },
                    { time: "09:30", title: "æ²³å£æ¹–å¤©ä¸Šå±±å…¬åœ’ (Kachi Kachi å±±çºœè»Š)", type: "sight", transport_note: "æ²³å£æ¹–å‘¨éŠå·´å£« (ç´…ç·š)", event_note: "æ¬£è³æ²³å£æ¹–å…¨æ™¯èˆ‡å¯Œå£«å±±", link: "https://maps.app.goo.gl/g6f9Z7n9bL49hG9yF" },
                    { time: "11:30", title: "æ–°å€‰å±±æ·ºé–“å…¬åœ’", type: "sight", transport_note: "å¯Œå£«æ€¥è¡Œç·šä¸‹å‰ç”°ç«™", event_note: "çˆ¬ä¸Šå¿ éˆå¡”æ‹æ”å¯Œå£«å±±ç¶“å…¸ç…§", link: "https://maps.app.goo.gl/E8G9fD3X8L8K4vG6f" },
                    { time: "13:30", title: "åˆé¤ï¼šæ²³å£æ¹–å‘¨é‚Šé¤å»³", type: "food", event_note: "å»ºè­°åœ¨æ²³å£æ¹–è»Šç«™é™„è¿‘ç”¨é¤", link: "" },
                    { time: "16:30", title: "é«˜é€Ÿå·´å£«ï¼šæ²³å£æ¹– -> æ–°å®¿/æ±äº¬ç«™", type: "transport", transport_note: "å·´å£«ç´„ 17:00 å‡ºç™¼ | è»Šç¨‹ç´„ 2 å°æ™‚", event_note: "æ­ä¹˜é è¨‚çš„å·´å£«å‰å¾€æ±äº¬", link: "https://www.highwaybus.com/gp/reservation/rsvPlanList?routeGroupNo=1&routeNo=111&displayType=4" },
                    { time: "19:30", title: "æŠµé”æ–°å®¿ / å‰å¾€é£¯åº— Land About Tokyo Check-in", type: "accommodation", transport_note: "åœ°éµæˆ–JRè‡³æ—¥æš®é‡Œç«™", event_note: "æ–¼æ—…é¤¨ Land About Tokyo Check-inï¼Œé ˜å–è¡Œæ", link: "https://maps.app.goo.gl/J7n9bL49hG9yF8m3Z" },
                    { time: "21:00", title: "æ™šé¤ï¼šä¸Šé‡/æ—¥æš®é‡Œé™„è¿‘", type: "food", event_note: "åœ¨é£¯åº—é™„è¿‘å¿«é€Ÿç”¨é¤", link: "" },
                    { time: "22:00", title: "æ™´ç©ºå¡”è–èª•æ´»å‹• / å…­æœ¬æœ¨é»ç‡ˆ (äºŒé¸ä¸€)", type: "sight", event_note: "é¸æ“‡å…¶ä¸­ä¸€å€‹é»ç‡ˆæ´»å‹•ï¼Œæ¬£è³è–èª•å¤œæ™¯", link: "https://maps.app.goo.gl/T8G9fD3X8L8K4vG6f" }
                ]
            },
            // Day 6 (12/25) - æ¾€è°·èˆ‡åŸå®¿ & æ™šä¸Šå…­æœ¬æœ¨é»ç‡ˆ ğŸ„
            { 
                day: 6, date: "12/25 (Thu)", location: "Tokyo Shibuya", weather: "sunny", 
                temperature: [7, 9, 12, 14, 13, 11, 9, 8], 
                temp_hour_range: "11:00 - 19:00", 
                daily_pass: "æ±äº¬åœ°éµä¸€æ—¥åˆ¸", 
                memo: "è–èª•ç¯€ç•¶å¤©äººæ½®çœ¾å¤šã€‚å‹™å¿…æ³¨æ„ Shibuya Sky çš„é ç´„æ™‚é–“ã€‚", 
                events: [
                    { time: "07:30-08:00", title: "é£¯åº—æ—©é¤ (Land About Tokyo)", type: "food", event_note: "é–‹æ”¾æ™‚é–“ 07:00-10:00 ä¹‹é–“", link: "" },
                    { time: "10:00", title: "æ˜æ²»ç¥å®®", type: "sight", transport_note: "åœ°éµè‡³ä»£ä»£æœ¨ç«™/åŸå®¿ç«™", event_note: "æ—¥æœ¬æœ€é‡è¦çš„ç¥ç¤¾ä¹‹ä¸€", link: "https://maps.app.goo.gl/g7n9bL49hG9yF8m3Z" },
                    { time: "åˆé¤", title: "åˆé¤ï¼šSports shop Gallery 2 (æ¾€è°·)", type: "shopping", event_note: "åœ¨æ¾€è°·é€›é‹å‹•ç”¨å“åº—ï¼Œä¸¦åœ¨å‘¨é‚Šç”¨é¤", link: "https://maps.app.goo.gl/P2L5Hw8Yw4g8cW7M2wL" },
                    { time: "14:00", title: "æ¾€è°· Sky å±•æœ›å°", type: "sight", event_note: "å…©å‘¨å‰è¨‚ç¥¨ï¼Œå…ˆç¢ºèªæ™‚é–“ã€‚è§€è³å¤•é™½æˆ–å¤œæ™¯", link: toolsData.tickets[0].link },
                    { time: "18:00", title: "é’ä¹‹æ´çªŸ", type: "sight", event_note: "å†¬å­£é™å®šç‡ˆé£¾æ´»å‹• (é€šå¸¸åœ¨æ¾€è°·èˆ‰è¡Œ)", link: "" },
                    { time: "æ™šé¤", title: "æ™šé¤ï¼šSteak Rice & Curry Restaurant", type: "food", event_note: "æ‚¨æŒ‡å®šçš„é¤å»³", link: "https://maps.app.goo.gl/A7fB5R7zN9m7CjR5" },
                    { time: "æ™šä¸Š", title: "å…­æœ¬æœ¨ä¹‹ä¸˜è–èª•é»ç‡ˆ (Roppongi Illumination)", type: "sight", transport_note: "åœ°éµè‡³å…­æœ¬æœ¨ç«™", event_note: "æ¬£è³è¯éº—çš„æ«¸æœ¨å‚å¤§é“é»ç‡ˆ", link: "https://maps.app.goo.gl/wYw4g8cW7M2wL5Hw8" }
                ]
            },
            // Day 7 (12/26) - æ·ºè‰ã€æ™´ç©ºå¡”èˆ‡æŠ¼ä¸Šæº«æ³‰ â›©ï¸
            { 
                day: 7, date: "12/26 (Fri)", location: "Tokyo Asakusa", weather: "cloudy", 
                temperature: [8, 10, 12, 13, 12, 11, 10, 9], 
                temp_hour_range: "10:00 - 18:00", 
                daily_pass: "æ±äº¬åœ°éµä¸€æ—¥åˆ¸", 
                memo: "Day 7 å‚™è¨»ï¼šä¸»è¦åœ¨æ·ºè‰/æŠ¼ä¸Šå‘¨é‚Šæ´»å‹•ï¼Œå¯å¤šåˆ©ç”¨åœ°éµã€‚", 
                events: [
                    { time: "07:30-08:00", title: "é£¯åº—æ—©é¤ (Land About Tokyo)", type: "food", event_note: "é–‹æ”¾æ™‚é–“ 07:00-10:00 ä¹‹é–“", link: "" },
                    { time: "10:00", title: "æ·ºè‰å¯º (Sensoji Temple) & é›·é–€", type: "sight", transport_note: "åœ°éµè‡³æ·ºè‰ç«™", event_note: "åƒè§€é›·é–€ã€ä»²è¦‹ä¸–é€šï¼ŒæŠ½ç±¤æ±‚é‹å‹¢", link: "https://maps.app.goo.gl/G6f9Z7n9bL49hG9yF" },
                    { time: "åˆé¤", title: "åˆé¤ï¼šæ·ºè‰ä»ŠåŠ (å£½å–œç‡’/ä¾¿å®œåˆé¤)", type: "food", event_note: "å¹³æ—¥ä¸­åˆä¾¿å®œå¾ˆå¤šï¼Œç´„ä¸€äºº 1000 å°å¹£å·¦å³", link: "https://maps.app.goo.gl/k3B2vC3X8L8K4vG6f" },
                    { time: "15:00", title: "æ™´ç©ºå¡” (Tokyo Skytree) & Pokemon Center", type: "shopping", transport_note: "åœ°éµè‡³æŠ¼ä¸Šç«™", event_note: "ç™»å¡”è§€æ™¯æˆ–åœ¨å‘¨é‚Šçš„ Solamachi è³¼ç‰©ï¼Œå°‹æ‰¾ Pokemon Center", link: "https://maps.app.goo.gl/T8G9fD3X8L8K4vG6f" },
                    { time: "18:00", title: "æŠ¼ä¸Šå¤©ç„¶æº«æ³‰ å¤§é»‘æ¹¯", type: "leisure", transport_note: "è¿‘æŠ¼ä¸Šç«™ (Oshiage)", event_note: "é«”é©—æ—¥å¼æº«æ³‰ï¼Œæ”¾é¬†èº«å¿ƒ", link: "https://maps.app.goo.gl/wJ7n9bL49hG9yF8m3" },
                    { time: "æ™šé¤", title: "æ™šé¤ï¼šæº«æ³‰å‘¨é‚Šæˆ–è¿”å›ä¸Šé‡", type: "food", event_note: "äº«ç”¨æ™šé¤å¾Œè¿”å›é£¯åº—", link: "" }
                ]
            },
            // Day 8 (12/27) - Ricoland (æ±é›²) èˆ‡æ–°å®¿æ¡è³¼ ğŸ›ï¸ (å·²ä¿®æ­£ Ricoland åœ°é»èˆ‡é †åº)
            { 
                day: 8, date: "12/27 (Sat)", location: "Tokyo Shinonome & Shinjuku", weather: "sunny", 
                temperature: [7, 9, 11, 13, 12, 10, 8, 7], 
                temp_hour_range: "10:00 - 18:00", 
                daily_pass: "Suica/Pasmo å¡", 
                memo: "Day 8 å‚™è¨»ï¼šæœ€å¾Œæ¡è³¼æ—¥ã€‚ä¸Šåˆå…ˆå‰å¾€ Ricolandï¼Œå†å‰å¾€æ–°å®¿ç”¨é¤åŠè³¼ç‰©ã€‚", 
                events: [
                    { time: "07:30-08:00", title: "é£¯åº—æ—©é¤ (Land About Tokyo)", type: "food", event_note: "é–‹æ”¾æ™‚é–“ 07:00-10:00 ä¹‹é–“", link: "" },
                    { 
                        time: "09:00", 
                        title: "Ricoland Tokyo Bay (æ©Ÿè»Šç”¨å“åº—)", 
                        type: "shopping", 
                        transport_note: "JR è‡³æ–°æ©‹è½‰è‡¨æµ·ç·šè‡³æ±é›²ç«™ (Shinonome)ï¼Œç´„ 40 åˆ†é˜ã€‚æˆ–æ­ä¹˜è¨ˆç¨‹è»Š/å·´å£«ã€‚", 
                        event_note: "åœ°å€: 2-chÅme-7-12 Shinonome, Koto City. ç‡Ÿæ¥­æ™‚é–“: 10:00â€“20:00 (é€±å…­)ã€‚è«‹é ç•™äº¤é€šæ™‚é–“ã€‚", 
                        link: "https://maps.google.com/?cid=13768552619504221624&g_mp=Cidnb29nbGUubWFwcy5wbGFjZXMudjEuUGxhY2VzLlNlYXJjaFRleHQ" // ä¿®æ­£å¾Œçš„ Ricoland é€£çµ
                    },
                    { 
                        time: "12:00", 
                        title: "åˆé¤ï¼šæœ¨æ›¾è·¯ (æ–°å®¿ä¸‰ä¸ç›®åº—)", 
                        type: "food", 
                        transport_note: "å¾æ±é›²ç«™æ­ä¹˜è‡¨æµ·ç·šè½‰ JR è‡³æ–°å®¿ä¸‰ä¸ç›®ç«™", 
                        event_note: "äº«ç”¨å£½å–œç‡’/æ‡·çŸ³æ–™ç†ï¼Œéœ€ç¢ºèªé ç´„", 
                        link: "https://maps.app.goo.gl/Hw4g8cW7M2wL5Hw8" 
                    },
                    { 
                        time: "14:30", 
                        title: "æ–°å®¿ç«™å‘¨é‚Šé€›è¡—", 
                        type: "shopping", 
                        event_note: "é€›ä¼Šå‹¢ä¸¹ã€é«˜å³¶å±‹æˆ–æ–°å®¿æ±å£ä¸€å¸¶çš„è—¥å¦/ç™¾è²¨", 
                        link: "https://maps.app.goo.gl/L5Hw8Yw4g8cW7M2w" 
                    },
                    { time: "æ™šé¤", title: "æ™šé¤ï¼šæ–°å®¿æˆ–è¿”å›ä¸Šé‡ (æœ€å¾Œä¸€æ™š)", type: "food", event_note: "æœ€å¾Œä¸€æ™šæ™šé¤ï¼Œå¯ä»¥é¸æ“‡å–œæ­¡çš„é¤å»³", link: "" },
                    { time: "20:00", title: "å›é£¯åº—æ•´ç†è¡Œæ", type: "leisure", event_note: "æº–å‚™éš”æ—¥ç™»æ©Ÿ", link: "" }
                ]
            },
            // Day 9 (12/28) - å•Ÿç¨‹è¿”å®¶ âœˆï¸
            { 
                day: 9, date: "12/28 (Sun)", location: "Departure", weather: "cloudy", 
                temperature: [6, 8, 10, 11, 10, 9, 8, 7], 
                temp_hour_range: "09:00 - 17:00", 
                daily_pass: "äº¬æˆé›»éµæˆ–å·´å£« (é£¯åº— -> æˆç”°æ©Ÿå ´)", 
                memo: "Day 9 å‚™è¨»ï¼šææ—© 3 å°æ™‚æŠµé” NRT æ©Ÿå ´ã€‚è«‹ç¢ºèª Land About Tokyo çš„é€€æˆ¿æ™‚é–“ã€‚", 
                events: [
                    { time: "11:00", title: "Land About Tokyo Check-out", type: "accommodation", event_note: "ç¢ºèªé€€æˆ¿æ‰‹çºŒï¼Œæ‰“åŒ…è¡Œæ", link: "" },
                    { time: "12:00", title: "å‰å¾€ NRT æ©Ÿå ´", type: "transport", transport_note: "äº¬æˆé›»éµ Access Express æˆ– Skyliner (å¾æ—¥æš®é‡Œ/ä¸Šé‡å‡ºç™¼)", event_note: "æ ¹æ“šç­æ©Ÿæ™‚é–“é ç•™å……è¶³äº¤é€šæ™‚é–“", link: "https://maps.app.goo.gl/uJ7n9bL49hG9yF8m3" },
                    { time: "13:35", title: "NRT T1 Check-in", type: "transport", event_note: "æ¨‚æ¡ƒ MM625 (è«‹å‹™å¿…å†æ¬¡ç¢ºèªèµ·é£›æ™‚é–“ 16:35)", link: "" },
                    { time: "16:35", title: "æˆç”° (NRT) âœˆï¸ æ¡ƒåœ’ (TPE)", type: "transport", event_note: "å›ç¨‹ç­æ©Ÿè³‡è¨Šï¼Œæ—…ç¨‹çµæŸï¼", link: "" }
                ]
            }
        ];

        // --- ICON UTILITIES ---

        // 1. å¤©æ°£ Icon è½‰æ›å™¨
        const getWeatherIcon = (weather) => {
            switch (weather.toLowerCase()) {
                case 'sunny': return 'â˜€ï¸'; // æ™´å¤©
                case 'cloudy': return 'â˜ï¸'; // é™°å¤©
                case 'rain': return 'ğŸŒ§ï¸';  // é›¨å¤©
                case 'thunderstorm': return 'â›ˆï¸'; // é›·é›¨
                case 'snow': return 'â„ï¸';   // é›ª
                default: return 'ğŸŒ¤ï¸';      // å¤šé›²/æœªçŸ¥
            }
        };

        // 2. äº‹ä»¶ Icon è½‰æ›å™¨
        const getEventIcon = (type) => {
            switch (type) {
                case 'food': return 'ğŸ½ï¸';
                case 'sight': return 'ğŸ¯';
                case 'shopping': return 'ğŸ›ï¸';
                case 'transport': return 'ğŸš„';
                case 'accommodation': return 'ğŸ¨';
                case 'leisure': return 'â˜•';
                case 'amusement': return 'ğŸ¡'; // æ–°å¢æ¨‚åœ’ Icon
                default: return 'ğŸ“';
            }
        };

        // --- COMPONENTS ---
        
        // **********************************************
        // ç‹€æ…‹ç®¡ç†ï¼šä½¿ç”¨ localStorage å„²å­˜å‚™è¨»å’Œåˆ†å¸³è³‡æ–™
        // **********************************************
        const useLocalStorageState = (key, defaultValue) => {
            const [state, setState] = useState(() => {
                const storedValue = localStorage.getItem(key);
                try {
                    return storedValue ? JSON.parse(storedValue) : defaultValue;
                } catch {
                    return defaultValue; // è‹¥è§£æå¤±æ•—ï¼Œä½¿ç”¨é è¨­å€¼
                }
            });

            useEffect(() => {
                try {
                    localStorage.setItem(key, JSON.stringify(state));
                } catch (e) {
                    console.error("Error writing to localStorage:", e);
                }
            }, [key, state]);

            return [state, setState];
        };
        
        // æº«åº¦/å¤©æ°£é å ±åœ–è¡¨
        const TemperatureChart = ({ temperatures, tempRange, weather }) => {
            if (!temperatures || temperatures.length === 0) return null;

            const [startHourStr] = tempRange.split(' - ')[0].split(':');
            const startHour = parseInt(startHourStr, 10);
            const hours = temperatures.map((_, index) => {
                const hour = (startHour + index) % 24;
                return `${hour < 10 ? '0' : ''}${hour}:00`;
            });
            
            const maxTemp = Math.max(...temperatures);
            const minTemp = Math.min(...temperatures);
            const dailyIcon = getWeatherIcon(weather);

            return (
                <div className="p-4 bg-white/70 rounded-2xl shadow-inner mb-6 glass-light">
                    {/* é ‚éƒ¨æº«åº¦ç¯„åœå’Œæ•´é«”å¤©æ°£ */}
                    <div className="flex justify-between items-center mb-4 border-b pb-2 border-gray-100">
                        <span className="text-sm font-medium text-gray-700 flex items-center">
                            <span className="text-lg mr-2">{dailyIcon}</span> 
                            ä»Šæ—¥æº«åº¦è®ŠåŒ– ({tempRange})
                        </span>
                        <span className="text-sm font-semibold">
                            <span className="text-red-600">â†‘{maxTemp}Â°C</span> / <span className="text-blue-600">â†“{minTemp}Â°C</span>
                        </span>
                    </div>

                    {/* å°æ™‚é å ±ç¶²æ ¼ */}
                    <div className="flex justify-between overflow-x-auto hide-scrollbar">
                        {hours.map((hour, index) => {
                            const temp = temperatures[index];
                            const isMax = temp === maxTemp;
                            const isMin = temp === minTemp;

                            return (
                                <div key={index} className="flex flex-col items-center flex-shrink-0 mx-2 sm:mx-0" style={{ width: '12%' }}>
                                    {/* å¤©æ°£ Icon (æš«ç”¨æ¯æ—¥ä¸»è¦å¤©æ°£ Icon) */}
                                    <div className="text-2xl mb-1 opacity-80">{dailyIcon}</div> 
                                    
                                    {/* æº«åº¦å€¼ */}
                                    <div className={`text-sm font-semibold ${
                                        isMax ? 'text-red-600' : 
                                        isMin ? 'text-blue-600' : 
                                        'text-gray-700'
                                    }`}>
                                        {temp}Â°
                                    </div>
                                    
                                    {/* æ™‚é–“æ¨™ç±¤ */}
                                    <div className="text-xs text-gray-500 mt-1">{hour.replace(':00', '')}</div>
                                </div>
                            );
                        })}
                    </div>
                </div>
            );
        };
        
        // å–®ä¸€è¡Œç¨‹å¡ç‰‡
        const TripCard = ({ event, index }) => {
            const cardInnerClass = 'rounded-2xl overflow-hidden mb-8 mx-4'; // å„ªåŒ–æ‰‹æ©Ÿé–“è·
            
            return (
                <div className={`glass-light card-shadow ${cardInnerClass}`}>
                    <div className="p-4">
                        <div className="flex justify-between items-start">
                            {/* å·¦å´æ™‚é–“èˆ‡ä¸»è¦è³‡è¨Š */}
                            <div className="flex-1 min-w-0">
                                <p className="text-2xl font-bold text-indigo-700 date-style">{event.time}</p>
                                <h3 className="text-lg font-semibold text-gray-800 mt-1 flex items-center">
                                    <span className="mr-2 text-2xl">{getEventIcon(event.type)}</span>
                                    {event.title}
                                </h3>
                                
                                {/* å‚™è¨»/èªªæ˜ */}
                                {(event.event_note || event.transport_note) && (
                                    <div className="mt-2 text-sm text-gray-600 space-y-1">
                                        {event.event_note && <p>ğŸ—’ï¸ {event.event_note}</p>}
                                        {event.transport_note && <p>ğŸš„ {event.transport_note}</p>}
                                    </div>
                                )}
                            </div>
                            
                            {/* å³å´é€£çµ (è‹¥æœ‰) */}
                            {event.link && (
                                <a href={event.link} target="_blank" className="ml-4 flex-shrink-0 text-sm font-medium text-indigo-500 hover:text-indigo-600 transition duration-150 p-2 border border-indigo-200 rounded-lg whitespace-nowrap">
                                    æŸ¥çœ‹åœ°åœ– â†’
                                </a>
                            )}
                        </div>
                    </div>
                </div>
            );
        };

        // æ¯æ—¥è¡Œç¨‹ç¸½è¦½
        const DailyItinerary = ({ dayData, isDark, dayIndex }) => {
            const [dailyMemo, setDailyMemo] = useLocalStorageState(`dailyMemo_${dayIndex}`, '');
            
            const textColor = isDark ? 'text-white' : 'text-gray-800';
            const subTextColor = isDark ? 'text-gray-300' : 'text-gray-600';
            const iconColor = isDark ? 'text-yellow-300' : 'text-indigo-700';

            const maxTemp = Math.max(...(dayData.temperature || []));
            const minTemp = Math.min(...(dayData.temperature || []));
            const dailyIcon = getWeatherIcon(dayData.weather);

            return (
                <main className="min-h-screen pb-16">
                    {/* é ‚éƒ¨æ—¥æœŸèˆ‡åŸå¸‚è³‡è¨Š */}
                    <header className="px-4 pt-8 pb-4">
                        <h1 className={`text-4xl font-bold ${textColor} date-style mb-2`}>
                            DAY {dayData.day}
                        </h1>
                        <h2 className={`text-xl font-medium ${subTextColor}`}>
                            {dayData.date} | {dayData.location}
                        </h2>
                        
                        {/* æ¯æ—¥æ°£æº«é¡¯ç¤º (Icon + æº«åº¦) */}
                        <div className={`mt-3 flex items-center text-lg font-semibold ${textColor}`}>
                             <span className={`text-3xl mr-2 ${iconColor}`}>{dailyIcon}</span>
                             <span className="capitalize">{dayData.weather}</span>
                             <span className="ml-4 text-red-500">â†‘{maxTemp}Â°</span> 
                             <span className="ml-2 text-blue-500">â†“{minTemp}Â°</span>
                        </div>
                    </header>

                    {/* äº¤é€šç¥¨åˆ¸æç¤º */}
                    {dayData.daily_pass && (
                         <div className="mx-4 mb-6 p-3 bg-indigo-50 rounded-xl shadow-md border border-indigo-200">
                             <p className="text-sm font-semibold text-indigo-700 flex items-center">
                                 <span className="text-lg mr-2">ğŸ«</span>
                                 å»ºè­°äº¤é€šå¥—ç¥¨:
                             </p>
                             <p className="mt-1 text-sm text-indigo-600">{dayData.daily_pass}</p>
                         </div>
                    )}

                    {/* æº«åº¦é å ±åœ–è¡¨ */}
                    <div className="px-4">
                        <TemperatureChart 
                            temperatures={dayData.temperature} 
                            tempRange={dayData.temp_hour_range}
                            weather={dayData.weather}
                        />
                    </div>

                    {/* æ¯æ—¥å‚™è¨» (è‡ªè¨‚è¼¸å…¥å€) */}
                    <div className="mx-4 mb-6 p-3 bg-fuchsia-50 rounded-xl shadow-md border border-fuchsia-200">
                        <p className="text-sm font-semibold text-fuchsia-700 flex items-center mb-2">
                            <span className="text-lg mr-2">ğŸ“</span>
                            æ‚¨çš„æ¯æ—¥å‚™è¨» (å¯è¼¸å…¥):
                        </p>
                        <textarea 
                            className="w-full p-2 border rounded-lg h-20 text-gray-800 text-sm focus:ring-fuchsia-500 focus:border-fuchsia-500"
                            placeholder={dayData.memo || "ä»Šå¤©æœ‰ä»€éº¼éœ€è¦ç‰¹åˆ¥æ³¨æ„çš„äº‹é …ï¼Ÿ"}
                            value={dailyMemo}
                            onChange={(e) => setDailyMemo(e.target.value)}
                        />
                    </div>

                    {/* è¡Œç¨‹åˆ—è¡¨ */}
                    <section className="space-y-4">
                        {dayData.events.map((event, index) => (
                            <TripCard key={index} event={event} index={index} />
                        ))}
                    </section>
                </main>
            );
        };

        // --- MAIN APP ---

        const App = () => {
            const [activeDayIndex, setActiveDayIndex] = useState(0); // é è¨­é¡¯ç¤º Day 1
            const [activeTab, setActiveTab] = useState('itinerary');
            
            const totalDays = tripData.length;
            const currentDayData = tripData[activeDayIndex];
            
            const backgroundConfig = getBackgroundStyle(currentDayData.theme);
            const isDark = backgroundConfig.isDark;

            // è™•ç†æ—¥æœŸåˆ‡æ›
            const nextDay = () => setActiveDayIndex((prev) => Math.min(prev + 1, totalDays - 1));
            const prevDay = () => setActiveDayIndex((prev) => Math.max(prev - 1, 0));

            // æ¸²æŸ“å·¥å…·é é¢
            const renderTools = () => {
                const renderSection = (title, data, renderItem) => (
                    <div className="mb-8 glass-light card-shadow rounded-2xl p-4">
                        <h3 className="text-xl font-bold mb-3 text-indigo-700 border-b pb-2">{title}</h3>
                        <div className="space-y-3">
                            {data.map(renderItem)}
                        </div>
                    </div>
                );

                const renderFlight = (item, index) => (
                    <div key={index} className="text-sm p-2 border-l-4 border-indigo-400 pl-3 bg-gray-50 rounded-md">
                        <p className="font-semibold">{item.leg} ({item.code})</p>
                        <p className="text-gray-600">{item.time}</p>
                        <p className="text-xs text-gray-500">æ©Ÿå ´: {item.airport}</p>
                    </div>
                );

                const renderHotel = (item, index) => (
                    <div key={index} className="text-sm p-2 border-l-4 border-green-400 pl-3 bg-gray-50 rounded-md">
                        <p className="font-semibold text-green-700">{item.name}</p>
                        <p className="text-gray-700">å…¥ä½æ—¥æœŸ: {item.dates}</p>
                        <p className="text-gray-600">åœ°å€: {item.address}</p>
                        <p className="text-xs text-gray-500">é›»è©±: {item.phone}</p>
                    </div>
                );

                const renderTicket = (item, index) => (
                    <div key={index} className="text-sm p-2 border-l-4 border-red-400 pl-3 bg-gray-50 rounded-md">
                        <p className="font-semibold text-red-700">{item.name}</p>
                        <p className="text-gray-700">ä½¿ç”¨æ—¥æœŸ: {item.date}</p>
                        <p className="text-gray-600">é¡å‹: {item.type}</p>
                        <a href={item.link} target="_blank" className="text-xs text-red-500 hover:underline">
                            é»æ“ŠæŸ¥çœ‹ç¥¨åˆ¸/QR Code â†’
                        </a>
                    </div>
                );

                return (
                    <div className="p-4 pt-8">
                        {renderSection("èˆªç­è³‡è¨Š", toolsData.flights, renderFlight)}
                        {renderSection("ä½å®¿è³‡è¨Š", toolsData.hotels, renderHotel)}
                        {renderSection("é›»å­ç¥¨åˆ¸/QR Codes", toolsData.tickets, renderTicket)}
                        {renderSection("ç·Šæ€¥é€£çµ¡è³‡è¨Š", toolsData.emergency, (item, index) => (
                            <div key={index} className="text-sm p-2 border-l-4 border-orange-400 pl-3 bg-gray-50 rounded-md">
                                <p className="font-semibold">{item.name}</p>
                                <a href={`tel:${item.phone}`} className="text-orange-600 hover:underline">{item.phone}</a>
                            </div>
                        ))}
                    </div>
                );
            };

            // æ¸²æŸ“åˆ†å¸³å·¥å…· (å·²åŠ å…¥è¼¸å…¥å’Œç°¡å–®åŠ ç¸½é‚è¼¯)
            const renderSplit = () => {
                const [expenses, setExpenses] = useLocalStorageState('splitExpenses', [
                    { name: 'æ©Ÿç¥¨ (TPE-NGO/NRT-TPE)', amount: 120000, paidBy: 'Sophie' },
                    { name: 'åå¤å±‹é£¯åº— (2æ™š)', amount: 28000, paidBy: 'Li' },
                    { name: 'å¯Œå£«å±±é£¯åº— (2æ™š)', amount: 35000, paidBy: 'Sophie' },
                    { name: 'æ±äº¬é£¯åº— (4æ™š)', amount: 56000, paidBy: 'Li' },
                ]);
                const [notes, setNotes] = useLocalStorageState('splitNotes', 'å¯åœ¨æ­¤è™•è¨˜éŒ„åŒ¯ç‡è®Šå‹•ã€ç‰¹æ®Šåˆ†å¸³æ¯”ä¾‹ç­‰è³‡è¨Šã€‚');
                
                const handleExpenseChange = (index, field, value) => {
                    const newExpenses = [...expenses];
                    newExpenses[index][field] = field === 'amount' ? parseInt(value) || 0 : value;
                    setExpenses(newExpenses);
                };

                const handleAddExpense = () => {
                    setExpenses([...expenses, { name: '', amount: 0, paidBy: 'Sophie' }]);
                };

                const handleRemoveExpense = (index) => {
                    const newExpenses = expenses.filter((_, i) => i !== index);
                    setExpenses(newExpenses);
                };
                
                const totalJPY = expenses.reduce((sum, item) => sum + item.amount, 0);
                const totalTWD = (totalJPY * DEFAULT_RATE).toFixed(0);
                const owedMap = expenses.reduce((map, item) => {
                    const half = item.amount / 2;
                    if (item.paidBy === 'Sophie') {
                        map.Sophie -= half;
                        map.Li += half;
                    } else if (item.paidBy === 'Li') {
                        map.Li -= half;
                        map.Sophie += half;
                    }
                    return map;
                }, { Sophie: 0, Li: 0 });

                const getSettlementMessage = () => {
                    const sophieOwed = owedMap.Sophie * DEFAULT_RATE;
                    const liOwed = owedMap.Li * DEFAULT_RATE;

                    if (sophieOwed > 0) {
                        return `Sophie æ‡‰ä»˜ Liï¼šç´„ ${sophieOwed.toFixed(0)} TWD`;
                    } else if (liOwed > 0) {
                        return `Li æ‡‰ä»˜ Sophieï¼šç´„ ${liOwed.toFixed(0)} TWD`;
                    }
                    return 'è²»ç”¨å·²å¹³è¡¡';
                };
                

                return (
                    <div className="p-4 pt-8">
                        <div className="mb-8 glass-light card-shadow rounded-2xl p-4">
                            <h3 className="text-xl font-bold mb-3 text-indigo-700 border-b pb-2">åˆ†å¸³å·¥å…· (è²»ç”¨è¿½è¹¤)</h3>
                            <p className="text-sm text-gray-600 mb-4">è³‡æ–™æœƒ**è‡ªå‹•å„²å­˜**åœ¨æ‚¨çš„ç€è¦½å™¨ä¸­ã€‚è«‹æŒ‰ **+ æ–°å¢** è¼¸å…¥è²»ç”¨ã€‚</p>
                            
                            {/* åŒ¯ç‡è³‡è¨Š */}
                            <div className="text-sm bg-blue-50 p-3 rounded-lg mb-4">
                                <p className="font-semibold text-blue-700">ç•¶å‰åƒè€ƒåŒ¯ç‡: 1 JPY â‰ˆ {DEFAULT_RATE} TWD</p>
                            </div>

                            {/* è²»ç”¨é …ç›®è¼¸å…¥å€ */}
                            <div className="space-y-3">
                                <h4 className="font-semibold mt-4 text-gray-800">è²»ç”¨æ¸…å–® (2äººå¹³å‡åˆ†æ”¤)</h4>
                                
                                <div className="grid grid-cols-5 gap-2 text-xs font-medium border-b pb-1 text-gray-600">
                                    <p className="col-span-2">é …ç›®</p>
                                    <p className="text-right">é‡‘é¡ (JPY)</p>
                                    <p className="text-center">ä»˜æ¬¾äºº</p>
                                    <p className="text-right">ç§»é™¤</p>
                                </div>
                                
                                {expenses.map((expense, index) => (
                                    <div key={index} className="grid grid-cols-5 gap-2 items-center text-sm">
                                        <input 
                                            type="text" 
                                            placeholder="é …ç›®åç¨±"
                                            value={expense.name}
                                            onChange={(e) => handleExpenseChange(index, 'name', e.target.value)}
                                            className="expense-input col-span-2 text-left"
                                            style={{ textAlign: 'left', padding: '6px 8px' }}
                                        />
                                        <input 
                                            type="number" 
                                            placeholder="é‡‘é¡"
                                            value={expense.amount}
                                            onChange={(e) => handleExpenseChange(index, 'amount', e.target.value)}
                                            className="expense-input"
                                        />
                                        <select
                                            value={expense.paidBy}
                                            onChange={(e) => handleExpenseChange(index, 'paidBy', e.target.value)}
                                            className="expense-input text-sm p-1"
                                            style={{ textAlign: 'center' }}
                                        >
                                            <option value="Sophie">Sophie</option>
                                            <option value="Li">Li</option>
                                        </select>
                                        <button 
                                            onClick={() => handleRemoveExpense(index)}
                                            className="text-red-500 hover:text-red-700 text-lg font-bold p-1"
                                        >
                                            <span className="text-base">ğŸ—‘ï¸</span>
                                        </button>
                                    </div>
                                ))}
                                
                                <button 
                                    onClick={handleAddExpense} 
                                    className="w-full mt-4 p-2 text-sm font-semibold text-white bg-indigo-500 rounded-lg hover:bg-indigo-600 transition-colors"
                                >
                                    + æ–°å¢è²»ç”¨
                                </button>
                            </div>
                            
                            {/* ç¸½è¨ˆèˆ‡çµç®— */}
                            <div className="mt-6 pt-4 border-t border-gray-200 space-y-2">
                                <p className="font-bold text-gray-800 flex justify-between">
                                    <span>ç¸½è¨ˆé‡‘é¡ (JPY)</span>
                                    <span>Â¥{totalJPY.toLocaleString()}</span>
                                </p>
                                <p className="font-bold text-gray-800 flex justify-between">
                                    <span>ç¸½è¨ˆé‡‘é¡ (TWD)</span>
                                    <span>ç´„ NT${totalTWD}</span>
                                </p>
                                
                                <div className="p-3 bg-green-100 rounded-lg font-semibold text-green-800 text-center text-sm mt-3">
                                    çµç®—å»ºè­° (TWD): {getSettlementMessage()}
                                </div>
                            </div>

                             {/* å‚™è¨»å€å¡Š (å¯è¼¸å…¥) */}
                            <div className="mt-6">
                                <h4 className="font-semibold mb-2 text-gray-800">å‚™è¨»/è¨ˆç®—èªªæ˜ (å¯è¼¸å…¥)</h4>
                                <textarea 
                                    className="w-full p-3 border rounded-lg h-24 text-gray-800 focus:ring-indigo-500 focus:border-indigo-500 text-sm"
                                    placeholder="è¨˜éŒ„åŒ¯ç‡ã€åˆ†å¸³æ¯”ä¾‹æˆ–å…¶ä»–äº‹é …..."
                                    value={notes}
                                    onChange={(e) => setNotes(e.target.value)}
                                ></textarea>
                            </div>
                        </div>
                    </div>
                );
            };

            // æ¸²æŸ“å³æ™‚ç¿»è­¯ (Placeholder)
            const renderTranslate = () => (
                <div className="p-4 pt-8">
                    <div className="mb-8 glass-light card-shadow rounded-2xl p-4">
                        <h3 className="text-xl font-bold mb-3 text-indigo-700 border-b pb-2">å³æ™‚ç¿»è­¯ (Placeholder)</h3>
                        <p className="text-sm text-gray-600 mb-4">æ­¤è™•å¯ä½œç‚ºç¿»è­¯è¼¸å…¥ä»‹é¢ï¼Œæ–¹ä¾¿å³æ™‚æºé€šã€‚</p>
                        
                        <h4 className="font-semibold text-sm mb-1">ä¸­æ–‡è¼¸å…¥</h4>
                        <textarea 
                            className="w-full p-3 border rounded-lg h-20 text-gray-800 focus:ring-indigo-500 focus:border-indigo-500"
                            placeholder="è¼¸å…¥ä¸­æ–‡..."
                        ></textarea>
                        
                        <h4 className="font-semibold text-sm mt-4 mb-1">æ—¥æ–‡è¼¸å‡º</h4>
                        <textarea 
                            className="w-full p-3 border rounded-lg h-20 text-gray-800 bg-gray-50"
                            placeholder="ç¿»è­¯çµæœå°‡é¡¯ç¤ºåœ¨æ­¤..."
                            readOnly
                        ></textarea>
                        
                        <p className="text-xs text-gray-500 mt-4">æç¤ºï¼šåœ¨æ—…é€”ä¸­ï¼Œæ‚¨å¯ä»¥ç›´æ¥ä½¿ç”¨æ‰‹æ©Ÿçš„ Google ç¿»è­¯æˆ– DeepL æ‡‰ç”¨ç¨‹å¼é€²è¡Œå³æ™‚ç¿»è­¯å’ŒèªéŸ³å°è©±ã€‚</p>
                    </div>
                </div>
            );


            // ä¸»å…§å®¹æ¸²æŸ“
            const renderContent = () => {
                switch (activeTab) {
                    case 'itinerary':
                        return <DailyItinerary dayData={currentDayData} isDark={isDark} dayIndex={activeDayIndex} />;
                    case 'tools':
                        return renderTools();
                    case 'split':
                        return renderSplit();
                    case 'translate':
                        return renderTranslate();
                    default:
                        return <DailyItinerary dayData={currentDayData} isDark={isDark} dayIndex={activeDayIndex} />;
                }
            };
            
            // å°èˆªç®­é ­ (ä½¿ç”¨æ–‡å­—ç¬¦è™Ÿå„ªåŒ–ï¼Œé¿å…å¼•ç”¨éŒ¯èª¤)
            const NavArrow = ({ direction, onClick, disabled }) => (
                <button 
                    onClick={onClick} 
                    disabled={disabled}
                    className={`p-2 rounded-full transition-colors duration-200 text-lg font-bold ${
                        disabled 
                            ? 'text-gray-400 cursor-not-allowed' 
                            : 'text-indigo-600 hover:bg-indigo-100'
                    }`}
                >
                    {direction === 'left' ? 'â†' : 'â†’'}
                </button>
            );


            return (
                <div className={`min-h-screen ${backgroundConfig.className}`} style={backgroundConfig.style}>
                    {/* Fixed Tab Navigation */}
                    <div className="sticky top-0 z-10 bg-white/95 backdrop-blur-sm shadow-md">
                        {/* Tab Bar */}
                        <div className="flex justify-around text-center border-b border-gray-200 text-sm font-medium">
                            {[
                                { id: 'itinerary', label: 'æ¯æ—¥è¡Œç¨‹' },
                                { id: 'tools', label: 'æ©Ÿç¥¨/ä½å®¿' },
                                { id: 'split', label: 'åˆ†å¸³å·¥å…·' },
                                { id: 'translate', label: 'å³æ™‚ç¿»è­¯' }
                            ].map((tab) => (
                                <button
                                    key={tab.id}
                                    onClick={() => setActiveTab(tab.id)}
                                    className={`py-3 flex-1 transition-colors duration-200 ${
                                        activeTab === tab.id
                                            ? 'text-indigo-600 border-b-2 border-indigo-600'
                                            : 'text-gray-500 hover:text-indigo-500'
                                    }`}
                                >
                                    {tab.label}
                                </button>
                            ))}
                        </div>

                        {/* Day Navigation Bar (åƒ…åœ¨è¡Œç¨‹é é¢é¡¯ç¤º) */}
                        {activeTab === 'itinerary' && (
                            <div className="flex justify-between items-center px-4 py-2 border-b border-gray-100">
                                <NavArrow direction="left" onClick={prevDay} disabled={activeDayIndex === 0} />
                                <span className="text-base font-semibold text-gray-700">
                                    DAY {currentDayData.day} / {totalDays}
                                </span>
                                <NavArrow direction="right" onClick={nextDay} disabled={activeDayIndex === totalDays - 1} />
                            </div>
                        )}
                    </div>

                    {/* Content Area */}
                    {renderContent()}

                    {/* é è…³ (å¯é¸) */}
                    <footer className="py-4 text-center text-xs text-gray-400">
                        Â© SL Japan Travel 2025 | Powered by Gemini
                    </footer>
                </div>
            );
        };
        
        // ä½¿ç”¨ createRoot æ¸²æŸ“ (React 18 å»ºè­°)
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);

    </script>
</body>
</html>
