<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>2025 æ—¥æœ¬è¡Œ | Japan Trip</title>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    
    <style>
        body { font-family: 'Noto Sans JP', sans-serif; background-color: #f4f4f5; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        .glass { background: rgba(255, 255, 255, 0.95); backdrop-filter: blur(10px); }
        .card-shadow { box-shadow: 0 4px 20px rgba(0,0,0,0.05); }
    </style>
</head>
<body class="bg-gray-100 text-gray-800 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect } = React;
        
        // è¨­å®šåƒèˆ‡åˆ†å¸³çš„äººå“¡åå–®
        const TRAVELERS = ['Sophie', 'Alt', 'Others'];
        // è¨­å®šé è¨­åŒ¯ç‡ (ä¾‹å¦‚ï¼š0.22)
        const DEFAULT_RATE = 0.22;

        // --- DATA SOURCE (åŒ…å«æ¯å°æ™‚æº«åº¦é å ±) ---
        const tripData = [
            {
                day: 1, date: "12/20 (Sat)", location: "Nagoya", weather: "sunny", 
                temperature: [8, 10, 12, 14, 13, 11, 9, 8], // 8å°æ™‚æº«åº¦
                temp_hour_range: "10:00 - 18:00",
                events: [
                    { time: "09:00", title: "æ¡ƒåœ’ (TPE) âœˆï¸ åå¤å±‹ (NGO)", type: "transport", 
                      transport_note: "è™èˆª IT206 (è«‹è‡ªè¡Œç¢ºèªç™»æ©Ÿæ™‚é–“)", 
                      event_note: "Check-in & å‡ºå¢ƒ | D1 ç­æ©Ÿè³‡è¨Š", link: "" },
                    { time: "14:00", title: "æŠµé”åå¤å±‹ NGO & å‰å¾€é£¯åº—", type: "hotel", 
                      suggested_departure: "14:00", 
                      transport_note: "åéµç‰¹æ€¥/æº–æ€¥ -> æ­¥è¡Œ | ç´„ 40-50 åˆ†é˜", 
                      event_note: "VIA INN åå¤å±‹ç«™å‰æ¤¿ç”º | å…¥å¢ƒé€šé—œã€æ”¾è¡Œæ", link: "https://goo.gl/maps/viainnugoya" },
                    { time: "16:00", title: "å¤§é ˆè§€éŸ³ (åƒæ‹œ)", type: "sight", 
                      suggested_departure: "15:35", 
                      transport_note: "åœ°éµæ±å±±ç·š/é¶´èˆç·š (è½‰ä¹˜ä¸€æ¬¡) | ç´„ 25-30 åˆ†é˜", 
                      event_note: "æŠ“30åˆ†é˜åƒæ‹œæ™‚é–“ | é–‹æ”¾æ™‚é–“06:00-19:00", 
                      nearby_suggestions: ["è¬æ¾å¯º (æœ‰å®šæ™‚å™´æ°´è¡¨æ¼”)", "å¤§é ˆæ‹›è²¡è²“", "æ°´æ›œæ—¥çš„æ„›éº—çµ² (ä¸»é¡Œå•†åº—)"],
                      link: "https://goo.gl/maps/osukannon" },
                    { time: "17:30", title: "å¤§é ˆå•†åº—è¡— & æ™šé¤", type: "food", 
                      suggested_departure: "17:20", 
                      transport_note: "æ­¥è¡Œ | ç´„ 10 åˆ†é˜ (å¾å¤§é ˆè§€éŸ³ä¸»æ®¿å‰é€²å…¥)", 
                      event_note: "å¿…åƒï¼šçŸ¢å ´è±¬æ’ (Miso Katsu) | å¤šæ•¸åº—å®¶ç‡Ÿæ¥­è‡³20:00", tags: ["å¿…åƒ", "é€›è¡—"], link: "https://goo.gl/maps/osukannon" },
                    { time: "19:00", title: "æ¦®å•†åœˆ (Sakae) è³¼ç‰©", type: "shop", 
                      suggested_departure: "18:40", 
                      transport_note: "æ­¥è¡Œ | ç´„ 20 åˆ†é˜ (çŸ¢å ´é †è·¯)", 
                      event_note: "SKYLE (UNIQLO/GU), Alpen Nagoya (~21:00)", 
                      nearby_suggestions: ["ä¸­éƒ¨é›»åŠ›Mirai Tower (åå¤å±‹é›»è¦–å¡”)", "ä¹…å±‹å¤§é€šå…¬åœ’"],
                      link: "https://goo.gl/maps/sakae" },
                    { time: "21:00", title: "ç¶ æ´²21 (Oasis 21) å¤œæ™¯", type: "sight", 
                      suggested_departure: "20:55", 
                      transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜ (å¾æ¦®ç«™)", 
                      event_note: "æ‹æ”å¤œæ™¯", tags: ["æ‹ç…§"], link: "https://goo.gl/maps/oasis21" },
                    { time: "21:30", title: "åƒé‡Œé¦¬è—¥å±€ & è¿”å›é£¯åº—", type: "shop", 
                      suggested_departure: "21:15", 
                      transport_note: "åœ°éµæ±å±±ç·š/æ«»é€šç·š | ç´„ 15-20 åˆ†é˜ (è¿”å›åå¤å±‹ç«™)", 
                      event_note: "ç‡Ÿæ¥­è‡³ 22:00 (å›é£¯åº—é †è·¯)", link: "https://goo.gl/maps/senrima" }
                ]
            },
            {
                day: 2, date: "12/21 (Sun)", location: "Inuyama/Nagoya", weather: "cloudy", 
                temperature: [7, 8, 9, 11, 13, 12, 10, 9],
                temp_hour_range: "10:00 - 18:00",
                events: [
                    { time: "09:00", title: "çŠ¬å±±åŸä¸‹ç”º & ä¸‰å…‰ç¨»è·ç¥ç¤¾", type: "sight", 
                      suggested_departure: "08:20", 
                      transport_note: "åéµçŠ¬å±±ç·š MuSKY (ç‰¹æ€¥) | ç´„ 40-50 åˆ†é˜", 
                      event_note: "é£¯åº—æ—©é¤ 06:30-09:30 | çŠ¬å±±åŸä¸‹ç”ºå•†åº—å¤šæ•¸ç´„ 10:00 ç‡Ÿæ¥­", 
                      nearby_suggestions: ["æˆ€å°ç”ºç³°å­ (ç¶²ç´…ç”œé»)", "é£›é©’ç‰›æ¡å£½å¸ (çŠ¬å±±ç‰›å¤ªéƒ)", "äº”å¹³é¤… (åœ¨åœ°å°åƒ)"],
                      link: "https://goo.gl/maps/inuyamacastle" },
                    { time: "13:00", title: "å‰å¾€åå¤å±‹åŸ", type: "transport", 
                      suggested_departure: "11:50", 
                      transport_note: "åéµ/åœ°éµ (ç¶“ä¸Šé£¯ç”°) | ç´„ 1 å°æ™‚ 10 åˆ†é˜ (å«è½‰ä¹˜)", 
                      event_note: "å¾çŠ¬å±±ç«™å‡ºç™¼", link: "https://goo.gl/maps/nagoyacastle" },
                    { time: "14:30", title: "åå¤å±‹åŸ", type: "sight", 
                      suggested_departure: "14:25", 
                      transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜ (åœ°éµç«™å‡ºå£)", 
                      event_note: "å¤åŸæ–‡åŒ–ä¹‹æ—… | äº¤é€šåˆ¸æ›å…¥å ´åˆ¸?", link: "https://goo.gl/maps/nagoyacastle" },
                    { time: "16:30", title: "åéµç™¾è²¨å•†åœˆ & BicCamera", type: "shop", 
                      suggested_departure: "16:05", 
                      transport_note: "åœ°éµååŸç·š/é¶´èˆç·š (è½‰ä¹˜ä¸€æ¬¡) | ç´„ 25 åˆ†é˜", 
                      event_note: "JR Gate Toweråº—/è¥¿åº— | D1æ²’åƒåˆ°çŸ¢å ´å¯åœ¨æ­¤åƒ", link: "https://goo.gl/maps/nagoyastation" }
                ]
            },
            {
                day: 3, date: "12/22 (Mon)", location: "Nagoya -> Fuji", weather: "sunny", 
                temperature: [5, 7, 9, 11, 10, 8, 7, 6],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "08:30", title: "ç†±ç”°ç¥å®®", type: "sight", 
                      suggested_departure: "08:20", 
                      // ä¿®æ­£éŒ¯èª¤ï¼šå°‡äº¤é€šå‚™è¨»ä¿æŒåœ¨å–®è¡Œå­—ä¸²ä¸­
                      transport_note: "åéµ (åå¤å±‹ç«™ -> ç¥å®®å‰ç«™) | ç´„ 10 åˆ†é˜", 
                      event_note: "ä¸‰ç¥å™¨ä¹‹ä¸€ | é–‹æ”¾æ™‚é–“09:00-16:30", 
                      nearby_suggestions: ["ç™½é³¥åº­åœ’ (æ± æ³‰è¿´éŠå¼æ—¥å¼åº­åœ’)", "æ¸…æ°´ç¤¾ (ç¾å®¹ç¥ˆé¡˜)", "ä¿¡é•·å¡€ (æ—¥æœ¬ä¸‰å¤§åœŸå¡€ä¹‹ä¸€)"],
                      tags: ["æ­·å²"], link: "https://goo.gl/maps/atsutashrine" },
                    { time: "10:30", title: "åˆé¤ (è“¬èŠè»’é°»é­šé£¯ç¥å®®åº—)", type: "food", 
                      suggested_departure: "10:25", 
                      transport_note: "æ­¥è¡Œ | ç´„ 5-8 åˆ†é˜ (è¿‘ç¥å®®è¥¿é–€)", 
                      event_note: "å»ºè­°ææ—©æ’éšŠæˆ–é ç´„", tags: ["å¿…åƒ"], link: "https://goo.gl/maps/atsutahoraiken" },
                    { time: "11:30", title: "è¿”å›é£¯åº—å–è¡Œæ", type: "transport", 
                      suggested_departure: "11:20", 
                      transport_note: "åéµ (ç¥å®®å‰ç«™ -> åå¤å±‹ç«™) | ç´„ 10 åˆ†é˜", 
                      event_note: "é€€æˆ¿ã€å–å›å¯„æ”¾è¡Œæ", link: "" },
                    { time: "12:30", title: "ç§»å‹•è‡³æ²³å£æ¹–", type: "transport", 
                      suggested_departure: "12:30", 
                      transport_note: "æ–°å¹¹ç·š (åå¤å±‹-ä¸‰å³¶) + å¯Œå£«æ€¥è¡Œå·´å£« | ç´„ 3.5 - 4 å°æ™‚", 
                      event_note: "é•·é€”ç§»å‹•ï¼Œå»ºè­°é è¨‚è»Šç¥¨", link: "https://goo.gl/maps/kawaguchikostation" },
                    { time: "16:00", title: "Check-in æ²³å£æ¹–", type: "hotel", 
                      suggested_departure: "16:00", 
                      transport_note: "æ­¥è¡Œ/è¨ˆç¨‹è»Š | å¾æ²³å£æ¹–ç«™å‰å¾€é£¯åº—", 
                      event_note: "æ”¾é¬†ã€æº–å‚™æ˜æ—¥è¡Œç¨‹", link: "" }
                ]
            },
            {
                day: 4, date: "12/23 (Tue)", location: "Fuji Area", weather: "cloudy", 
                temperature: [-2, 0, 2, 4, 6, 5, 3, 2],
                temp_hour_range: "08:00 - 16:00",
                events: [
                    { time: "06:00", title: "æ–°å€‰å±±æ·ºé–“å…¬åœ’", type: "sight", 
                      suggested_departure: "05:40", 
                      transport_note: "å»ºè­°è‡ªé§•æˆ–è¨ˆç¨‹è»Š | æ¸…æ™¨", 
                      event_note: "æ‹æ”å¯Œå£«å±±+äº”é‡å¡” (æ—©æ™¨é€†å…‰è¼ƒå°‘)", tags: ["çµ•æ™¯"], link: "https://goo.gl/maps/arakurayama" },
                    { time: "10:00", title: "å¤©ä¸Šå±±å…¬åœ’ (Ropeway)", type: "sight", 
                      suggested_departure: "09:30", 
                      transport_note: "æ²³å£æ¹–å‘¨éŠå·´å£« (ç´…ç·š)", 
                      event_note: "æ­ä¹˜çºœè»Š", link: "https://goo.gl/maps/kachiropeway" },
                    { time: "14:00", title: "å¯Œå£«æ€¥/å¾¡æ®¿å ´ Outlet", type: "shop", 
                      suggested_departure: "13:00", 
                      transport_note: "å¾¡æ®¿å ´ï¼šé«˜é€Ÿå·´å£«/è‡ªé§• | å¯Œå£«æ€¥ï¼šå¯Œå£«æ€¥è¡Œç·š", 
                      event_note: "è¦–é«”åŠ›äºŒé¸ä¸€", link: "https://goo.gl/maps/gotembaoutlet" }
                ]
            },
            {
                day: 5, date: "12/24 (Wed)", location: "Fuji -> Tokyo", weather: "snow", 
                temperature: [1, 3, 5, 7, 8, 6, 4, 3],
                temp_hour_range: "12:00 - 20:00",
                events: [
                    { time: "10:00", title: "ç§»å‹•è‡³æ±äº¬ (Check-in é¶¯è°·/ä¸Šé‡)", type: "transport", 
                      suggested_departure: "10:00", 
                      transport_note: "é«˜é€Ÿå·´å£« or JR (æ–°å®¿) | ç´„ 2 å°æ™‚", 
                      event_note: "é«˜é€Ÿå·´å£«ç›¸å°å¯¦æƒ ï¼Œä½†æ˜“å¡è»Š", link: "https://goo.gl/maps/shinjuku" },
                    { time: "18:00", title: "å…­æœ¬æœ¨ä¹‹ä¸˜é»ç‡ˆ", type: "sight", 
                      suggested_departure: "17:30", 
                      transport_note: "åœ°éµ | ç´„ 20-30 åˆ†é˜ (å¾æ–°å®¿/ä¸Šé‡)", 
                      event_note: "è–èª•ç¯€ç‰¹åˆ¥æ´»å‹•", tags: ["è–èª•é™å®š"], link: "https://goo.gl/maps/roppongihills" },
                    { time: "20:00", title: "æ™´ç©ºå¡”è–èª•å¸‚é›†", type: "sight", 
                      suggested_departure: "19:20", 
                      transport_note: "åœ°éµ (å¤§æ±Ÿæˆ¶ç·š/åŠè—é–€ç·š) | ç´„ 30-40 åˆ†é˜", 
                      event_note: "æ±äº¬æ™´ç©ºå¡”å¤¢å¹»è–èª• 2025", link: "https://goo.gl/maps/skytree" }
                ]
            },
            {
                day: 6, date: "12/25 (Thu)", location: "Tokyo Shibuya", weather: "sunny", 
                temperature: [3, 5, 7, 9, 10, 8, 6, 4],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "09:00", title: "æ˜æ²»ç¥å®®", type: "sight", 
                      suggested_departure: "08:40", 
                      transport_note: "JR å±±æ‰‹ç·š | å¾é¶¯è°·/ä¸Šé‡å‡ºç™¼ç´„ 20 åˆ†é˜", 
                      event_note: "éƒ½æœƒç¶ æ´²", link: "https://goo.gl/maps/meijishrine" },
                    { time: "12:00", title: "åˆé¤/Sports Shop Gallery 2", type: "shop", 
                      suggested_departure: "11:45", 
                      transport_note: "æ­¥è¡Œ | å¾åŸå®¿/ä»£ä»£æœ¨è‡³æ¾€è°·", 
                      event_note: "é€›è¡—è¡Œç¨‹", link: "https://goo.gl/maps/shibuyacrossing" },
                    { time: "16:00", title: "Shibuya Sky", type: "sight", 
                      suggested_departure: "15:55", 
                      transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜", 
                      event_note: "éœ€å…©é€±å‰æ¶ç¥¨! æ—¥è½æ™‚é–“ç´„ 16:30", 
                      nearby_suggestions: ["å®®ä¸‹å…¬åœ’ (æ–°åœ°æ¨™/å±‹é ‚å…¬åœ’)", "å¿ çŠ¬å…«å…¬åƒ/åå­—è·¯å£", "æ¾€è°·PARCO (å‹•æ¼«è¿·æŒ–å¯¶)"],
                      tags: ["é ç´„", "æ—¥è½"], link: "https://goo.gl/maps/shibuyasky" },
                    { time: "18:00", title: "é’ä¹‹æ´çªŸ (é»ç‡ˆ)", type: "sight", 
                      suggested_departure: "17:50", 
                      transport_note: "æ­¥è¡Œ | æ¾€è°·å…¬åœ’é€š~ä»£ä»£æœ¨å…¬åœ’", 
                      event_note: "å¤¢å¹»é»ç‡ˆ", tags: ["é»ç‡ˆ"], link: "https://goo.gl/maps/bluecave" },
                    { time: "20:00", title: "æ™šé¤: Steak Rice & Curry", type: "food", 
                      suggested_departure: "19:50", 
                      transport_note: "æ­¥è¡Œ | æ¾€è°·ç«™å‘¨é‚Š", 
                      event_note: "Center Beef Shibuya (Center Gai?)", link: "https://goo.gl/maps/centerbeef" }
                ]
            },
            {
                day: 7, date: "12/26 (Fri)", location: "Asakusa/Skytree", weather: "sunny", 
                temperature: [2, 4, 6, 8, 9, 7, 5, 3],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "09:00", title: "æ·ºè‰é›·é–€", type: "sight", 
                      suggested_departure: "08:40", 
                      transport_note: "åœ°éµéŠ€åº§ç·š/éƒ½ç‡Ÿæ·ºè‰ç·š | å¾ä¸Šé‡/é¶¯è°·å‡ºç™¼", 
                      event_note: "ä»²è¦‹ä¸–é€šåƒå°åƒ", 
                      nearby_suggestions: ["æ·ºè‰æ–‡åŒ–è§€å…‰ä¸­å¿ƒ (é ‚æ¨“å…è²»å±•æœ›)", "éš…ç”°å…¬åœ’ (æ²³ç•”/æ™´ç©ºå¡”ç¾æ™¯)", "å‚³æ³•é™¢é€š (å¤è‰²è€è¡—)"],
                      link: "https://goo.gl/maps/kaminarimon" },
                    { time: "11:30", title: "åˆé¤: æ·ºè‰ä»ŠåŠ", type: "food", 
                      suggested_departure: "11:25", 
                      transport_note: "æ­¥è¡Œ | æ·ºè‰ç«™å‘¨é‚Š", 
                      event_note: "å£½å–œç‡’åˆé–“å¥—é¤ (ç´„Â¥3000èµ·ï¼Œé«˜CPå€¼)", tags: ["é«˜CPå€¼"], link: "https://goo.gl/maps/asakusaimahan" },
                    { time: "14:00", title: "Pokemon Center æ™´ç©ºå¡”", type: "shop", 
                      suggested_departure: "13:45", 
                      transport_note: "åœ°éµ/æ±æ­¦ç·š | æ·ºè‰è‡³æŠ¼ä¸Šç«™ | ç´„ 15 åˆ†é˜", 
                      event_note: "æŠ¼ä¸Šç«™", link: "https://goo.gl/maps/pokemonskytree" },
                    { time: "17:00", title: "æŠ¼ä¸Šæº«æ³‰ (å¤§é»‘æ¹¯)", type: "sight", 
                      suggested_departure: "16:50", 
                      transport_note: "æ­¥è¡Œ | æŠ¼ä¸Šç«™å‘¨é‚Š", 
                      event_note: "å‚³çµ±éŒ¢æ¹¯é«”é©—", link: "https://goo.gl/maps/daikokuyu" }
                ]
            },
            {
                day: 8, date: "12/27 (Fri)", location: "Tokyo Shopping", weather: "cloudy", 
                temperature: [4, 6, 8, 10, 9, 7, 5, 4],
                temp_hour_range: "10:00 - 18:00",
                events: [
                    { time: "10:00", title: "Ricoland Tokyo Bay (é‡æ©Ÿç”¨å“)", type: "shop", 
                      suggested_departure: "09:20", 
                      transport_note: "åœ°éµæœ‰æ¨‚ç”ºç·š/ç™¾åˆé·—ç·š (æ–°æ©‹è½‰ä¹˜) | ç›®çš„åœ°ï¼šæ±é›²ç«™ | ç´„ 40 åˆ†é˜", 
                      event_note: "é‡æ©Ÿç”¨å“è–åœ°", tags: ["é¨å£«å¿…é€›"], link: "https://goo.gl/maps/ricoland" },
                    { time: "13:00", title: "åˆé¤: æœ¨æ›¾è·¯ (å£½å–œç‡’)", type: "food", 
                      suggested_departure: "12:00", 
                      transport_note: "åœ°éµ/JR | å¾æ±é›²ç«™è¿”å›æ–°å®¿ï¼Œç´„ 1 å°æ™‚", 
                      event_note: "Shabu Shabu / å£½å–œç‡’", link: "https://goo.gl/maps/kisoji" },
                    { time: "15:00", title: "æ–°å®¿é€›è¡—", type: "shop", 
                      suggested_departure: "14:55", 
                      transport_note: "æ­¥è¡Œ | æ–°å®¿ç«™å‘¨é‚Š", 
                      event_note: "Lumine, Isetan, BicCamera", link: "https://goo.gl/maps/shinjuku" }
                ]
            },
            {
                day: 9, date: "12/28 (Sat)", location: "Back Home", weather: "sunny", 
                temperature: [3, 5, 7, 9, 11, 10, 8, 6],
                temp_hour_range: "09:00 - 17:00",
                events: [
                    { time: "10:00", title: "å‰å¾€æˆç”°æ©Ÿå ´ (NRT)", type: "transport", 
                      suggested_departure: "10:00", 
                      transport_note: "JR Narita Express (N'EX) or Skyliner | ç´„ 1 å°æ™‚ 20 åˆ†é˜ (å¾æ–°å®¿/ä¸Šé‡)", 
                      event_note: "é ç•™å……è£•æ™‚é–“è‡³ç¬¬ä¸€èˆªå»ˆ (T1)", link: "https://goo.gl/maps/naritaairport" },
                    { time: "14:30", title: "æŠµé”æˆç”°æ©Ÿå ´ (NRT)", type: "transport", 
                      suggested_departure: "14:30", 
                      transport_note: "æ©Ÿå ´å…ç¨…åº—è³¼ç‰©", 
                      event_note: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒ", link: "" },
                    { time: "16:35", title: "èµ·é£› (NRT -> TPE)", type: "transport", 
                      suggested_departure: "16:35", 
                      transport_note: "èˆªç­è³‡è¨Šç¢ºèª", 
                      event_note: "ç¥æ—…é€”æ„‰å¿«ï¼", link: "" },
                    { time: "20:00", title: "æŠµé”å°åŒ—", type: "home", 
                      suggested_departure: "20:00", 
                      transport_note: "æº«æš–çš„å®¶", 
                      event_note: "ç”œèœœçš„å®¶", link: "" }
                ]
            }
        ];

        const toolsData = {
            flights: [
                { leg: "å»ç¨‹", code: "IT206", time: "12/20 09:00 TPE -> 14:00 NGO", airport: "TPE/NGO" },
                { leg: "å›ç¨‹", code: "MM625", time: "12/28 èµ·é£› 16:35 NRT", airport: "NRT T1" }
            ],
            hotels: [
                { name: "VIA INN åå¤å±‹ç«™å‰æ¤¿ç”º", dates: "12/20-12/22", address: "åå¤å±‹" },
                { name: "æ²³å£æ¹–é£¯åº— (TBD)", dates: "12/22-12/24", address: "æ²³å£æ¹–" },
                { name: "Land About Tokyo", dates: "12/24-12/28", address: "é¶¯è°·/ä¸Šé‡" }
            ],
            emergency: [
                { name: "æ—…å¤–åœ‹äººæ€¥é›£æ•‘åŠ©", phone: "+81-3-3280-7717" },
                { name: "å ±è­¦", phone: "110" },
                { name: "æ•‘è­·è»Š", phone: "119" }
            ]
        };

        // --- ICONS & UTILITIES ---
        const IconMap = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>
        );
        const IconExchange = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>
        );
        const IconLink = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M10 6H6a2 2 0 00-2 2v10a2 2 0 002 2h10a2 2 0 002-2v-4M14 4h6m0 0v6m0-6L10 14" /></svg>
        );
        const IconTime = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z" /></svg>
        );
        const IconWeather = ({ className }) => (
            <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 3v1m0 16v1m9-9h-1M4 12H3m15.364 6.364l-.707-.707M6.343 6.343l-.707-.707m12.728 0l-.707.707M6.343 17.657l-.707.707M16 12a4 4 0 11-8 0 4 4 0 018 0z" /></svg>
        );
        
        // ä¿®æ­£å¾Œçš„ Google Map é€£çµç”Ÿæˆå‡½å¼
        const generateDayMapLink = (events) => {
            const destinationTitles = events
                .filter(e => e.link && e.type !== 'transport' && e.type !== 'hotel') // éæ¿¾æ‰ç´”äº¤é€šå’Œé£¯åº—ç™»è¨˜ï¼Œåªç•™ä¸‹æ™¯é»/é£Ÿç‰©/è³¼ç‰©
                .map(e => e.title)
                .filter(t => t); 
            
            if (destinationTitles.length === 0) return '#';
            
            // ä½¿ç”¨æ‰€æœ‰ç›®çš„åœ°æ¨™é¡Œä½œç‚º Google Maps æŸ¥è©¢ (ä½¿ç”¨ç©ºç™½åˆ†éš”ï¼ŒGoogle Maps æœƒè‡ªå‹•è§£æ)
            const query = destinationTitles.join(' ');
            
            // ä½¿ç”¨æ¨™æº– Google Maps æœå°‹é€£çµæ ¼å¼
            return `https://maps.app.goo.gl/wgZQJiUe7VP1EYHH8{encodeURIComponent(query)}`;
        };

        // æ ¹æ“šå¤©æ°£å’Œåœ–è¡¨è³‡æ–™ï¼Œæ±ºå®šæ¨™é ­é¡è‰²
        const getHeaderStyle = (weather) => {
            switch (weather.toLowerCase()) {
                case 'sunny':
                    return 'bg-blue-400 text-white';
                case 'cloudy':
                    return 'bg-gray-400 text-white';
                case 'snow':
                    return 'bg-sky-500 text-white';
                default:
                    return 'bg-indigo-400 text-white';
            }
        };

        // æº«åº¦è¶¨å‹¢åœ– (ç°¡æ˜“ç‰ˆ)
        function TemperatureChart({ temperatures, hourRange }) {
            if (!temperatures || temperatures.length < 2) return null;
            
            const maxTemp = Math.max(...temperatures);
            const minTemp = Math.min(...temperatures);
            const range = Math.max(maxTemp - minTemp, 5); // ç¢ºä¿æœ€å°å€¼ç‚º 5ï¼Œé¿å…é™¤ä»¥é›¶æˆ–åœ–å½¢éæ‰
            const width = 200;
            const height = 40;

            const points = temperatures.map((temp, index) => {
                // X åº§æ¨™: æ ¹æ“šé †åºåœ¨ 0 åˆ° width ä¹‹é–“åˆ†ä½ˆ
                const x = (index / (temperatures.length - 1)) * width;
                // Y åº§æ¨™: åå‘è¨ˆç®— (æº«åº¦è¶Šé«˜ï¼ŒYè¶Šå°ï¼Œå› ç‚º SVG åº§æ¨™ç³»åŸé»åœ¨å·¦ä¸Š)
                const y = height - ((temp - minTemp) / range) * height; 
                return `${x},${y}`;
            }).join(' ');
            
            const [startHour, endHour] = hourRange.split(' - ').map(h => parseInt(h.split(':')[0]));
            
            return (
                <div className="mt-3 px-4 w-full">
                    <p className="text-xs font-bold text-white mb-1">
                        <IconWeather className="w-4 h-4 inline mr-1" />
                        {hourRange} ({minTemp}Â°C ~ {maxTemp}Â°C)
                    </p>
                    <svg width="100%" height="60" viewBox={`0 0 ${width} 60`} preserveAspectRatio="none">
                        {/* ç¹ªè£½ç·šæ¢ */}
                        <polyline
                            fill="none"
                            stroke="#ffffff"
                            strokeWidth="3"
                            points={points}
                            strokeLinecap="round"
                            strokeLinejoin="round"
                        />
                        {/* ç¹ªè£½æº«åº¦é»å’Œæ¨™ç±¤ */}
                        {temperatures.map((temp, index) => {
                            const x = (index / (temperatures.length - 1)) * width;
                            const y = height - ((temp - minTemp) / range) * height;
                            
                            return (
                                <React.Fragment key={index}>
                                    {/* é» */}
                                    <circle cx={x} cy={y} r="3" fill="#ffffff" />
                                    {/* æº«åº¦æ¨™ç±¤ */}
                                    <text x={x} y={y - 8} textAnchor="middle" fill="#ffffff" fontSize="12" fontWeight="bold">
                                        {temp}Â°
                                    </text>
                                    {/* å°æ™‚æ¨™ç±¤ */}
                                    <text x={x} y={height + 15} textAnchor="middle" fill="#ffffffcc" fontSize="10">
                                        {startHour + index}h
                                    </text>
                                </React.Fragment>
                            );
                        })}
                    </svg>
                </div>
            );
        }
        
        // å–®ä¸€äº‹ä»¶å¡ç‰‡å…ƒä»¶
        function EventCard({ event }) {
            const getIcon = (type) => {
                switch (type) {
                    case 'transport': return 'âœˆï¸';
                    case 'hotel': return 'ğŸ¨';
                    case 'sight': return 'ğŸ¯';
                    case 'food': return 'ğŸœ';
                    case 'shop': return 'ğŸ›ï¸';
                    case 'home': return 'ğŸ ';
                    default: return 'ğŸ“';
                }
            };

            const departureTime = event.suggested_departure;

            return (
                <div className="flex items-start py-4 border-b border-gray-100 last:border-b-0">
                    <div className="flex-shrink-0 mr-4 text-center">
                        <div className="text-2xl">{getIcon(event.type)}</div>
                        <div className="text-xs text-gray-500 font-semibold">{event.time}</div>
                    </div>
                    <div className="flex-grow">
                        <div className="flex justify-between items-start mb-1">
                            <h3 className="text-lg font-bold text-gray-800 leading-snug">{event.title}</h3>
                            {departureTime && (
                                <div className="text-right ml-4 flex-shrink-0">
                                    <p className="text-xs text-gray-500">å»ºè­°å‡ºç™¼</p>
                                    {/* æ”¾å¤§å‡ºç™¼æ™‚é–“çš„æ¨£å¼èª¿æ•´åœ¨é€™è£¡ */}
                                    <p className="text-xl font-bold text-red-500 leading-none mt-0.5">{departureTime}</p>
                                </div>
                            )}
                        </div>
                        
                        {event.event_note && (
                            <p className="text-sm text-gray-700 mb-1 leading-snug">
                                <span className="font-semibold text-gray-900">å‚™è¨»: </span>{event.event_note}
                            </p>
                        )}
                        {event.transport_note && (
                            <p className="text-xs text-gray-500 italic mb-1">
                                äº¤é€š: {event.transport_note}
                            </p>
                        )}
                        
                        {(event.link || event.tags?.length > 0) && (
                            <div className="mt-2 flex flex-wrap items-center">
                                {event.tags && event.tags.map(tag => (
                                    <span key={tag} className="text-xs font-medium bg-indigo-100 text-indigo-800 px-2 py-0.5 rounded-full mr-2 mb-1">
                                        {tag}
                                    </span>
                                ))}
                                {event.link && (
                                    <a href={event.link} target="_blank" rel="noopener noreferrer" className="text-sm text-blue-600 hover:text-blue-800 transition duration-150 ease-in-out flex items-center mb-1">
                                        <IconLink className="w-4 h-4 mr-1" />
                                        æŸ¥çœ‹è©³æƒ… (åœ°åœ–/ç¶²ç«™)
                                    </a>
                                )}
                            </div>
                        )}
                    </div>
                </div>
            );
        }
        
        // æ¯æ—¥è¡Œç¨‹å¡ç‰‡å…ƒä»¶
        function TripCard({ trip }) {
            const mapLink = generateDayMapLink(trip.events);
            const headerStyle = getHeaderStyle(trip.weather);

            return (
                <div className="glass card-shadow rounded-2xl overflow-hidden mb-6 mx-4">
                    
                    {/* Header with Weather and Temperature Chart */}
                    <div className={`p-4 ${headerStyle}`}>
                        <div className="flex justify-between items-start mb-2">
                            <div>
                                <h2 className="text-2xl font-bold">DAY {trip.day} | {trip.date}</h2>
                                <p className="text-sm font-medium opacity-90">{trip.location}</p>
                            </div>
                            <div className="text-right">
                                <p className="text-lg font-bold capitalize flex items-center">
                                    <IconWeather className="w-5 h-5 mr-1" /> {trip.weather}
                                </p>
                            </div>
                        </div>
                        
                        {/* Temperature Chart (Hourly Forecast) */}
                        <TemperatureChart 
                            temperatures={trip.temperature} 
                            hourRange={trip.temp_hour_range}
                        />

                        {mapLink !== '#' && (
                            <div className="mt-3 pt-3 border-t border-white/30">
                                <a href={mapLink} target="_blank" rel="noopener noreferrer" className="block text-center bg-white/20 hover:bg-white/30 transition-colors duration-200 py-2 rounded-xl font-bold text-sm text-white flex items-center justify-center">
                                    <IconMap className="w-5 h-5 mr-2" />
                                    é–‹å•Ÿ Google Maps è·¯ç·šå»ºè­° (ä»Šæ—¥æ™¯é»)
                                </a>
                            </div>
                        )}
                    </div>

                    {/* Events List */}
                    <div className="p-4 divide-y divide-gray-50">
                        {trip.events.map((event, index) => (
                            <EventCard key={index} event={event} />
                        ))}
                    </div>
                </div>
            );
        }

        // åˆ†å¸³ç³»çµ±å…ƒä»¶ (åŒ…å«åŒ¯ç‡æ›ç®—) - ä¿æŒä¸Šæ¬¡çµ¦å‡ºçš„å®Œæ•´ç‰ˆæœ¬
        function Splitter({ budgetItems, setBudgetItems }) {
            const [splitItem, setSplitItem] = useState({ name: '', cost: '', paidBy: TRAVELERS[0] });
            const [exchangeRate, setExchangeRate] = useState(DEFAULT_RATE);
            const [jpyInput, setJpyInput] = useState('');

            // åŒ¯ç‡æ›ç®—é‚è¼¯
            const convertedTWD = (Number(jpyInput) * exchangeRate).toFixed(0).toLocaleString();
            
            const calculateFinalBalances = () => {
                const balances = {};
                TRAVELERS.forEach(t => balances[t] = 0); 

                const totalCost = budgetItems.reduce((acc, curr) => acc + Number(curr.cost), 0);
                
                if (TRAVELERS.length === 0 || totalCost === 0) return balances;

                const costPerPerson = totalCost / TRAVELERS.length;
                
                budgetItems.forEach(item => {
                    if (item.paidBy && TRAVELERS.includes(item.paidBy)) {
                        balances[item.paidBy] += Number(item.cost);
                    }
                });

                TRAVELERS.forEach(t => {
                    balances[t] = balances[t] - costPerPerson;
                });
                
                return balances;
            };

            const balances = calculateFinalBalances();
            const totalCost = budgetItems.reduce((acc, curr) => acc + Number(curr.cost), 0);

            const handleAddItem = (e) => {
                e.preventDefault();
                if (splitItem.name && Number(splitItem.cost) > 0) {
                    setBudgetItems([...budgetItems, { ...splitItem, cost: Number(splitItem.cost) }]);
                    setSplitItem({ name: '', cost: '', paidBy: TRAVELERS[0] });
                }
            };
            
            const getBalanceColor = (balance) => {
                if (balance > 0) return 'text-green-600 bg-green-100';
                if (balance < 0) return 'text-red-600 bg-red-100';
                return 'text-gray-600 bg-gray-100';
            };


            return (
                <div className="p-5">
                    <h2 className="text-xl font-bold mb-3 border-b pb-2 text-indigo-700">æ—…è²»åˆ†å¸³èˆ‡åŒ¯ç‡å·¥å…·</h2>
                    
                    {/* åŒ¯ç‡æ›ç®—å€å¡Š */}
                    <div className="mb-6 p-4 rounded-xl bg-indigo-50 border border-indigo-200">
                        <h3 className="text-lg font-semibold mb-2 flex items-center text-indigo-800">
                            <IconExchange className="w-5 h-5 mr-2" />
                            æ—¥å¹£ (JPY) æ›ç®—
                        </h3>
                        <div className="flex space-x-2 mb-2 items-center">
                            <label className="text-sm font-medium text-gray-700">å³æ™‚åŒ¯ç‡ (TWD/JPY):</label>
                            <input
                                type="number"
                                step="0.001"
                                value={exchangeRate}
                                onChange={(e) => setExchangeRate(e.target.value)}
                                className="w-20 text-center p-1 border rounded-md text-sm"
                            />
                        </div>
                        <div className="flex space-x-2 items-center">
                            <input
                                type="number"
                                placeholder="è¼¸å…¥æ—¥å¹£é‡‘é¡ (Â¥)"
                                value={jpyInput}
                                onChange={(e) => setJpyInput(e.target.value)}
                                className="w-full p-2 border border-indigo-300 rounded-lg focus:ring-indigo-500 focus:border-indigo-500"
                            />
                            <p className="text-xl font-bold text-red-600">
                                â {convertedTWD} NTD
                            </p>
                        </div>
                    </div>
                    
                    {/* åˆ†å¸³çµæœå€å¡Š */}
                    <div className="mb-6">
                        <h3 className="text-lg font-semibold mb-3 text-gray-800">ç¸½çµç®— ({TRAVELERS.length} äººå¹³åˆ†)</h3>
                        <div className="flex justify-between items-center mb-2 p-2 bg-gray-100 rounded-lg">
                            <p className="font-semibold text-sm">ç¸½èŠ±è²» (JPY):</p>
                            <p className="font-bold text-lg text-indigo-600">Â¥{totalCost.toLocaleString()}</p>
                        </div>
                        <div className="grid grid-cols-3 gap-2 text-center">
                            {TRAVELERS.map(traveler => (
                                <div key={traveler} className={`p-2 rounded-lg text-sm font-semibold border ${getBalanceColor(balances[traveler])}`}>
                                    {traveler}: <br />
                                    {balances[traveler] > 0 ? `æ‡‰æ”¶ Â¥${balances[traveler].toLocaleString()}` : 
                                     (balances[traveler] < 0 ? `æ‡‰ä»˜ Â¥${(-balances[traveler]).toLocaleString()}` : `çµæ¸…`)}
                                </div>
                            ))}
                        </div>
                    </div>
                    
                    {/* æ–°å¢é …ç›®è¡¨å–® */}
                    <h3 className="text-lg font-semibold mb-3 text-gray-800">æ–°å¢åˆ†å¸³é …ç›®</h3>
                    <form onSubmit={handleAddItem} className="space-y-3 p-4 bg-white border rounded-xl">
                        <input
                            type="text"
                            placeholder="é …ç›®åç¨± (ä¾‹å¦‚: æ™šé¤)"
                            value={splitItem.name}
                            onChange={(e) => setSplitItem({ ...splitItem, name: e.target.value })}
                            className="w-full p-2 border rounded-md"
                            required
                        />
                        <input
                            type="number"
                            placeholder="é‡‘é¡ (æ—¥å¹£ Â¥)"
                            value={splitItem.cost}
                            onChange={(e) => setSplitItem({ ...splitItem, cost: e.target.value })}
                            className="w-full p-2 border rounded-md"
                            required
                        />
                        <select
                            value={splitItem.paidBy}
                            onChange={(e) => setSplitItem({ ...splitItem, paidBy: e.target.value })}
                            className="w-full p-2 border rounded-md bg-white"
                        >
                            {TRAVELERS.map(t => (
                                <option key={t} value={t}>{t} æ”¯ä»˜</option>
                            ))}
                        </select>
                        <button type="submit" className="w-full bg-indigo-600 text-white p-2 rounded-md hover:bg-indigo-700 transition">
                            è¨˜å¸³
                        </button>
                    </form>
                    
                    {/* é …ç›®æ¸…å–® */}
                    <div className="mt-5 max-h-48 overflow-y-auto hide-scrollbar border rounded-xl bg-white">
                        <h4 className="text-md font-semibold p-3 sticky top-0 bg-gray-50 border-b">é …ç›®æ˜ç´°</h4>
                        <ul className="divide-y">
                            {budgetItems.map((item, index) => (
                                <li key={index} className="flex justify-between items-center p-3 text-sm">
                                    <div className="flex-grow">
                                        <p className="font-medium text-gray-800">{item.name}</p>
                                        <p className="text-xs text-gray-500">ä»˜æ¬¾äºº: {item.paidBy}</p>
                                    </div>
                                    <p className="font-bold text-red-500">Â¥{item.cost.toLocaleString()}</p>
                                </li>
                            ))}
                        </ul>
                        {budgetItems.length === 0 && <p className="text-center text-gray-500 py-4 text-sm">å°šç„¡è¨˜å¸³é …ç›®</p>}
                    </div>
                </div>
            );
        }

        // é ‚å±¤æ‡‰ç”¨ç¨‹å¼å…ƒä»¶
        function App() {
            const [activeTab, setActiveTab] = useState('schedule');
            const [budgetItems, setBudgetItems] = useState([]); // å„²å­˜åˆ†å¸³é …ç›®

            const tabClass = (tabName) => 
                `flex-1 py-3 px-1 text-center font-bold text-sm transition-colors duration-200 ${
                    activeTab === tabName 
                        ? 'text-indigo-600 border-b-4 border-indigo-600' 
                        : 'text-gray-500 hover:text-gray-700'
                }`;

            return (
                <div className="max-w-xl mx-auto min-h-screen bg-gray-50 pb-20">
                    <header className="sticky top-0 z-50 glass backdrop-blur-md shadow-md">
                        <div className="flex justify-around items-center pt-3">
                            <h1 className="text-2xl font-bold text-gray-900 px-4">
                                âœˆï¸ æ—¥æœ¬é—œè¥¿å¯Œå£«è¡Œ 2025
                            </h1>
                        </div>
                        
                        {/* Tab Bar */}
                        <div className="flex border-t mt-3">
                            <button className={tabClass('schedule')} onClick={() => setActiveTab('schedule')}>
                                è¡Œç¨‹è¡¨
                            </button>
                            <button className={tabClass('flights')} onClick={() => setActiveTab('flights')}>
                                æ©Ÿç¥¨/ä½å®¿
                            </button>
                            <button className={tabClass('split')} onClick={() => setActiveTab('split')}>
                                åˆ†å¸³å·¥å…·
                            </button>
                        </div>
                    </header>
                    
                    <main className="pt-4">
                        {activeTab === 'schedule' && tripData.map(trip => (
                            <TripCard key={trip.day} trip={trip} />
                        ))}
                        
                        {activeTab === 'flights' && (
                            <div className="p-5 space-y-6">
                                <div className="bg-white p-5 rounded-xl shadow-lg">
                                    <h3 className="text-xl font-bold mb-3 text-gray-800 border-b pb-2">æ©Ÿç¥¨è³‡è¨Š</h3>
                                    {toolsData.flights.map((flight, index) => (
                                        <div key={index} className="mb-4 border-b last:border-b-0 pb-3">
                                            <p className="text-sm font-semibold">{flight.leg} ({flight.code})</p>
                                            <p className="text-lg font-bold text-indigo-600">{flight.time}</p>
                                            <p className="text-xs text-gray-500">æ©Ÿå ´: {flight.airport}</p>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-white p-5 rounded-xl shadow-lg">
                                    <h3 className="text-xl font-bold mb-3 text-gray-800 border-b pb-2">ä½å®¿è³‡è¨Š</h3>
                                    {toolsData.hotels.map((hotel, index) => (
                                        <div key={index} className="mb-4 border-b last:border-b-0 pb-3">
                                            <p className="text-sm font-semibold">{hotel.name}</p>
                                            <p className="text-base text-gray-700">{hotel.dates}</p>
                                            <p className="text-xs text-gray-500">åœ°é»: {hotel.address}</p>
                                        </div>
                                    ))}
                                </div>
                                <div className="bg-white p-5 rounded-xl shadow-lg bg-red-50">
                                    <h3 className="text-xl font-bold mb-3 text-red-700 border-b pb-2">ç·Šæ€¥è¯çµ¡</h3>
                                    {toolsData.emergency.map((contact, index) => (
                                        <div key={index} className="mb-4 border-b border-red-200 last:border-b-0 pb-3">
                                            <p className="text-sm font-semibold text-red-600">{contact.name}</p>
                                            <p className="text-lg font-bold text-red-800">{contact.phone}</p>
                                        </div>
                                    ))}
                                </div>
                            </div>
                        )}
                        
                        {activeTab === 'split' && (
                            <div className="glass card-shadow rounded-2xl mx-4">
                                <Splitter budgetItems={budgetItems} setBudgetItems={setBudgetItems} />
                            </div>
                        )}
                    </main>
                </div>
            );
        }

        // æ¸²æŸ“æ‡‰ç”¨ç¨‹å¼
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>
