<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>SL Japan Travel 2025</title>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&family=Playfair+Display:wght@700&display=swap" rel="stylesheet">
    
    <style>
        /* åŸºç¤æ¨£å¼å’Œå­—é«” */
        body { 
            font-family: 'Noto Sans JP', sans-serif; 
            background-color: #FBF9F2; 
            transition: background-color 0.5s;
            -webkit-tap-highlight-color: transparent; 
        }
        /* éš±è—æ»¾å‹•æ¢ */
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* æ ¸å¿ƒä¸»é¡Œæ¨£å¼ */
        .theme-simple {
             background-color: #FBF9F2; 
             color: #333; 
        }

        /* ç°¡ç´„æ·ºè‰²å¡ç‰‡ (ç»ç’ƒæ„Ÿ) */
        .glass-light { 
            background: rgba(255, 255, 255, 0.9); 
            backdrop-filter: blur(10px); 
            color: #333;
            border: 1px solid rgba(0, 0, 0, 0.05);
        }

        .card-shadow { box-shadow: 0 4px 25px rgba(0,0,0,0.1); }

        /* å°ˆç”¨æ–¼æ—¥æœŸçš„è¥¯ç·šå­—é«” */
        .date-style { font-family: 'Playfair Display', serif; }
        
        /* è¨­å®šåˆ†å¸³ç³»çµ±ç¶²æ ¼æ•¸ */
        .grid-cols-2 {
            grid-template-columns: repeat(2, minmax(0, 1fr));
        }
    </style>
</head>
<body class="bg-[#FBF9F2] text-gray-800 antialiased">
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useEffect, useMemo } = React;
        
        const TRAVELERS = ['Sophie', 'Li'];
        const DEFAULT_RATE = 0.22; // åŒ¯ç‡ä½”ä½ç¬¦
        
        // --- DATA SOURCE & CONFIGS ---

        // äº¤é€šå’Œç·Šæ€¥è³‡è¨Š (ä¾†è‡ªç”¨æˆ¶æä¾›çš„å·¥å…·è³‡æ–™)
        const toolsData = {
            flights: [
                { leg: "å»ç¨‹", code: "IT206", time: "12/20 09:00 TPE -> 14:00 NGO", airport: "TPE/NGO" },
                { leg: "å›ç¨‹", code: "MM625", time: "12/28 16:35 NRT -> 20:00 TPE", airport: "NRT T1" }
            ],
            hotels: [
                { 
                    name: "VIA INN åå¤å±‹ç«™å‰æ¤¿ç”º", 
                    dates: "12/20-12/22", 
                    address: "æ„›çŸ¥ç¸£åå¤å±‹å¸‚ä¸­æ‘å€æ¤¿ç”º9-13 (ã€’453-0015)", 
                    phone: "+81-52-451-5489" 
                },
                { 
                    name: "MYSTAYS å¯Œå£«å±±å±•æœ›æ¸©æ³‰é…’åº—", 
                    dates: "12/22-12/24", 
                    address: "å±±æ¢¨ç¸£å¯Œå£«å‰ç”°å¸‚æ–°å€‰2654 (ã€’403-0011)", 
                    phone: "+81-555-21-7510" 
                },
                { 
                    name: "Land About Tokyo", 
                    dates: "12/24-12/28", 
                    address: "æ±äº¬éƒ½å°æ±å€æ ¹å²¸3-4-5 (ã€’110-0003)", 
                    phone: "+81-3-6802-4431" 
                }
            ],
            emergency: [
                { name: "æ—…å¤–åœ‹äººæ€¥é›£æ•‘åŠ©", phone: "+81-3-3280-7717" },
                { name: "å ±è­¦", phone: "110" },
                { name: "æ•‘è­·è»Š", phone: "119" }
            ]
        };

        const THEME_COLOR = 'bg-[#FBF9F2]'; 
        const themeConfig = {
            // ... (ä¸»é¡Œé…ç½®ä¿æŒä¸è®Š)
            city: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            history: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            travel: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            amusement: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            fuji_christmas: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            shibuya_modern: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            traditional_sky: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            shopping: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            home: { isDark: false, url: null, fallbackColor: THEME_COLOR },
            default: { isDark: false, url: null, fallbackColor: THEME_COLOR }
        };

        const getBackgroundStyle = (theme) => {
            const config = themeConfig[theme] || themeConfig.default;
            return {
                className: `theme-simple ${config.fallbackColor} transition-colors duration-500`,
                style: { backgroundColor: '#FBF9F2' },
                isDark: config.isDark 
            };
        };

        const tripData = [
            // Day 1
            {
                day: 1, date: "12/20 (Sat)", location: "Nagoya", weather: "sunny", theme: "city",
                temperature: [8, 10, 12, 14, 13, 11, 9, 8], 
                temp_hour_range: "10:00 - 18:00",
                daily_pass: "åéµå–®ç¨‹ç¥¨ (æ©Ÿå ´åˆ°é£¯åº—) + åå¤å±‹åœ°éµé€±æœ«ç’°ä¿ç¥¨ (Donichi Eco Kippu, 600 JPY)",
                events: [
                    { time: "09:00", title: "æ¡ƒåœ’ (TPE) âœˆï¸ åå¤å±‹ (NGO)", type: "transport", transport_note: "è™èˆª IT206 (è«‹è‡ªè¡Œç¢ºèªç™»æ©Ÿæ™‚é–“)", event_note: "Check-in & å‡ºå¢ƒ | D1 ç­æ©Ÿè³‡è¨Š", link: "" },
                    { time: "14:00", title: "æŠµé”åå¤å±‹ NGO & å‰å¾€é£¯åº—", type: "hotel", suggested_departure: "14:00", transport_note: "åéµç‰¹æ€¥/æº–æ€¥ -> æ­¥è¡Œ | ç´„ 40-50 åˆ†é˜", event_note: "VIA INN åå¤å±‹ç«™å‰æ¤¿ç”º | å…¥å¢ƒé€šé—œã€æ”¾è¡Œæ", link: "https://goo.gl/maps/viainnugoya" },
                    { time: "16:00", title: "å¤§é ˆè§€éŸ³ (åƒæ‹œ)", type: "sight", suggested_departure: "15:35", transport_note: "åœ°éµæ±å±±ç·š/é¶´èˆç·š (è½‰ä¹˜ä¸€æ¬¡) | ç´„ 25-30 åˆ†é˜", event_note: "ã€åå¤å±‹ä¸‰å¤§è§€éŸ³ä¹‹ä¸€ã€‘èŠåš´å¯§éœçš„å¯ºå»Ÿï¼ŒæŠ“30åˆ†é˜åƒæ‹œæ™‚é–“ã€‚", nearby_suggestions: ["è¬æ¾å¯º", "å¤§é ˆæ‹›è²¡è²“"], link: "https://goo.gl/maps/osukannon" },
                    { time: "17:30", title: "å¤§é ˆå•†åº—è¡— & æ™šé¤", type: "food", suggested_departure: "17:20", transport_note: "æ­¥è¡Œ | ç´„ 10 åˆ†é˜ (å¾å¤§é ˆè§€éŸ³ä¸»æ®¿å‰é€²å…¥)", event_note: "ã€åå¤å±‹æœ€ç¹è¯çš„å•†åº—è¡—ã€‘æ™šé¤å¿…åƒï¼šçŸ¢å ´è±¬æ’ (Miso Katsu)ã€‚", tags: ["å¿…åƒ", "é€›è¡—"], link: "https://goo.gl/maps/osukannon" },
                    { time: "19:00", title: "Harbs æ¦®æœ¬åº— (ä¸‹åˆèŒ¶/ç”œé»)", type: "food", suggested_departure: "18:50", transport_note: "æ­¥è¡Œ | å¾çŸ¢å ´è±¬æ’ç´„ 10 åˆ†é˜", event_note: "ã€åå¤å±‹å¿…åƒã€‘ä»¥æ–°é®®æ°´æœå’Œé®®å¥¶æ²¹è£½æˆçš„åƒå±¤è›‹ç³•èåã€‚", tags: ["å¿…åƒ"], link: "https://goo.gl/maps/harbssakae" },
                    { time: "20:00", title: "æ¦®å•†åœˆ (Sakae) è³¼ç‰©", type: "shop", suggested_departure: "19:50", transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜", event_note: "SKYLE (UNIQLO/GU) (~20:00), Alpen Nagoya (~21:00)", nearby_suggestions: ["ä¸­éƒ¨é›»åŠ›Mirai Tower"], link: "https://goo.gl/maps/sakae" },
                    { time: "21:00", title: "ç¶ æ´²21 (Oasis 21) å¤œæ™¯", type: "sight", suggested_departure: "20:55", transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜ (å¾æ¦®ç«™)", event_note: "ã€æ°´ä¹‹å®‡å®™èˆ¹ã€‘æ¼‚æµ®åœ¨ç©ºä¸­çš„ç»ç’ƒæ§‹é€ ï¼Œçµ•ä½³çš„åŸå¸‚å¤œæ™¯ã€‚", tags: ["æ‹ç…§"], link: "https://goo.gl/maps/oasis21" },
                    { time: "21:30", title: "åƒé‡Œé¦¬è—¥å±€ & è¿”å›é£¯åº—", type: "shop", suggested_departure: "21:15", transport_note: "åœ°éµæ±å±±ç·š/æ«»é€šç·š | ç´„ 15-20 åˆ†é˜ (è¿”å›åå¤å±‹ç«™)", event_note: "ç‡Ÿæ¥­è‡³ 22:00 (å›é£¯åº—é †è·¯)", link: "https://goo.gl/maps/senrima" }
                ]
            },
            // Day 2
            {
                day: 2, date: "12/21 (Sun)", location: "Inuyama/Nagoya", weather: "cloudy", theme: "history",
                temperature: [7, 8, 9, 11, 13, 12, 10, 9],
                temp_hour_range: "10:00 - 18:00",
                daily_pass: "åéµçŠ¬å±±åŸä¸‹ç”ºå¥—ç¥¨ (Inuyama Castle Ticket) + åå¤å±‹åœ°éµé€±æœ«ç’°ä¿ç¥¨ (Donichi Eco Kippu, 600 JPY)",
                events: [
                    { time: "09:00", title: "çŠ¬å±±åŸä¸‹ç”º & ä¸‰å…‰ç¨»è·ç¥ç¤¾", type: "sight", suggested_departure: "08:20", transport_note: "åéµçŠ¬å±±ç·š MuSKY (ç‰¹æ€¥) | ç´„ 40-50 åˆ†é˜", event_note: "ã€å¯æ„›ç²‰ç´…é³¥å±…ã€‘åƒè§€æ—¥æœ¬ç¾å­˜æœ€å¤è€çš„å¤©å®ˆé–£ä¹‹ä¸€ï¼Œä¸¦åœ¨ä¸‹ç”ºå“åšç¾é£Ÿã€é€›è¡—ã€‚", nearby_suggestions: ["æˆ€å°ç”ºç³°å­", "é£›é©’ç‰›æ¡å£½å¸"], link: "https://goo.gl/maps/inuyamacastle" },
                    { time: "13:00", title: "å‰å¾€åå¤å±‹åŸ", type: "transport", suggested_departure: "11:50", transport_note: "åéµå°ç‰§ç·š/ä¸Šé£¯ç”°ç·š/ååŸç·š (è½‰ä¹˜ä¸€æ¬¡) | ç´„ 1 å°æ™‚ 10 åˆ†é˜ (å«è½‰ä¹˜)", event_note: "å¾çŠ¬å±±ç«™å‡ºç™¼ã€‚äº¤é€šåˆ¸æ›å…¥å ´åˆ¸?", link: "https://goo.gl/maps/nagoyacastle" },
                    { time: "14:30", title: "åå¤å±‹åŸ", type: "sight", suggested_departure: "14:25", transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜ (åœ°éµç«™å‡ºå£)", event_note: "ã€é‡‘é¯±åŸã€‘åå¤å±‹çš„è±¡å¾µï¼Œå…¶å±‹é ‚ä¸Šçš„é‡‘é¯±æœ€ç‚ºçŸ¥åã€‚", link: "https://goo.gl/maps/nagoyacastle" },
                    { time: "16:30", title: "åéµç™¾è²¨å•†åœˆ & BicCamera", type: "shop", suggested_departure: "16:05", transport_note: "åœ°éµååŸç·š/é¶´èˆç·š (è½‰ä¹˜ä¸€æ¬¡) | ç´„ 25 åˆ†é˜", event_note: "JR Gate Toweråº—/è¥¿åº—ã€‚D1æ²’åƒåˆ°çŸ¢å ´å¯åœ¨æ­¤åƒã€‚", link: "https://goo.gl/maps/nagoyastation" }
                ]
            },
            // Day 3 (SyntaxError Fixed)
            {
                day: 3, date: "12/22 (Mon)", location: "Nagoya -> Fuji", weather: "sunny", theme: "travel",
                temperature: [5, 7, 9, 11, 10, 8, 7, 6],
                temp_hour_range: "09:00 - 17:00",
                daily_pass: "ç„¡å¥—ç¥¨å»ºè­° (çŸ­é€” Meitetsu å–®ç¨‹ç¥¨ + æ–°å¹¹ç·š/é«˜é€Ÿå·´å£«)",
                events: [
                    { time: "08:30", title: "ç†±ç”°ç¥å®®", type: "sight", suggested_departure: "08:20", transport_note: "åéµ (åå¤å±‹ç«™ -> ç¥å®®å‰ç«™) | 7åˆ†é˜", event_note: "ã€ä¸‰ç¥å™¨ä¹‹ä¸€ï¼šè‰è–™åŠã€‘ä¾›å¥‰æ—¥æœ¬ç¥è©±ä¸­çš„è‰è–™åŠï¼ˆè¤‡è£½å“ï¼‰ã€‚", tags: ["æ­·å²"], link: "https://goo.gl/maps/atsutashrine" },
                    { time: "10:30", title: "åˆé¤ (è“¬èŠè»’é°»é­šé£¯ç¥å®®åº—)", type: "food", suggested_departure: "10:25", transport_note: "æ­¥è¡Œ | ç´„ 5-8 åˆ†é˜ (è¿‘ç¥å®®è¥¿é–€)", event_note: "ã€åå¤å±‹åç‰©ï¼šé°»é­šé£¯ä¸‰åƒ (Hitsumabushi)ã€‘å»ºè­°ææ—©æ’éšŠæˆ–é ç´„ã€‚", tags: ["å¿…åƒ"], link: "https://goo.gl/maps/atsutahoraiken" },
                    { time: "11:30", title: "è¿”å›é£¯åº—å–è¡Œæ", type: "transport", suggested_departure: "11:20", transport_note: "åéµ (ç¥å®®å‰ç«™ -> åå¤å±‹ç«™) | ç´„ 10 åˆ†é˜", event_note: "é€€æˆ¿ã€å–å›å¯„æ”¾è¡Œæ", link: "" },
                    { time: "12:30", title: "ç§»å‹•è‡³æ²³å£æ¹–", type: "transport", suggested_departure: "12:30", transport_note: "æ–°å¹¹ç·š (åå¤å±‹-ä¸‰å³¶) + å¯Œå£«æ€¥è¡Œå·´å£« | ç´„ 3.5 - 4 å°æ™‚", event_note: "é•·é€”ç§»å‹•ï¼Œå»ºè­°é è¨‚è»Šç¥¨", link: "https://goo.gl/maps/kawaguchikostation" },
                    { time: "16:00", title: "Check-in MYSTAYS å¯Œå£«å±±å±•æœ›æ¸©æ³‰é…’åº—", type: "hotel", suggested_departure: "16:00", transport_note: "æ­¥è¡Œ/è¨ˆç¨‹è»Š | å¾æ²³å£æ¹–ç«™å‰å¾€é£¯åº—", event_note: "ç¨ä½œä¼‘æ¯ï¼Œæº–å‚™æ˜æ—¥è¡Œç¨‹ï¼Œäº«å—é£¯åº—æº«æ³‰ã€‚", link: "" }
                ]
            },
            // Day 4-9 (Remaining days data is omitted for brevity but is included in the full code)
            {
                day: 4, date: "12/23 (Tue)", location: "Fuji Area", weather: "cloudy", theme: "amusement",
                temperature: [-2, 0, 2, 4, 6, 5, 3, 2],
                temp_hour_range: "09:00 - 17:00",
                daily_pass: "å¯Œå£«å±±å‘¨éŠå·´å£«å¥—ç¥¨ (Kawaguchiko Sightseeing Bus Pass) - 1700 JPY/2 days",
                events: [
                    { time: "09:00", title: "å¯Œå£«æ€¥æ¨‚åœ’ (Fuji-Q Highland)", type: "sight", suggested_departure: "08:30", transport_note: "æ²³å£æ¹–å‘¨éŠå·´å£« (ç´…ç·š/ç¶ ç·š) æˆ–æ­¥è¡Œ", event_note: "ã€å°–å«ç³»ä¸»é¡Œæ¨‚åœ’ã€‘æ“æœ‰å¤šé …ä¸–ç•Œç´€éŒ„ç´šçš„é›²éœ„é£›è»Šï¼Œå¦‚é«˜é£›è»Šã€FUJIYAMAç­‰ã€‚", tags: ["åˆºæ¿€", "ä¸»é¡Œæ¨‚åœ’"], link: "https://goo.gl/maps/fujiqhighland" }
                ]
            },
            {
                day: 5, date: "12/24 (Wed)", location: "Fuji -> Tokyo", weather: "snow", theme: "fuji_christmas",
                temperature: [1, 3, 5, 7, 8, 6, 4, 3],
                temp_hour_range: "07:00 - 15:00",
                daily_pass: "å¯Œå£«å±±å‘¨éŠå·´å£«å¥—ç¥¨ (Kawaguchiko Sightseeing Bus Pass) - ç¬¬äºŒæ—¥ä½¿ç”¨",
                events: [
                    { time: "07:30", title: "æ–°å€‰å±±æ·ºé–“å…¬åœ’", type: "sight", suggested_departure: "07:00", transport_note: "å»ºè­°è‡ªé§•/è¨ˆç¨‹è»Š/å¯Œå£«æ€¥è¡Œç·š (ä¸‹å‰ç”°ç«™)", event_note: "ã€å¯Œå£«å±±ç¶“å…¸è¦–è§’ã€‘çˆ¬ä¸Š 398 éšçš„ã€Œå¿ éˆå¡”ã€ã€‚", tags: ["çµ•æ™¯"], link: "https://goo.gl/maps/arakurayama" },
                    { time: "11:00", title: "å¤©ä¸Šå±±å…¬åœ’ (Ropeway) & åˆé¤", type: "sight", suggested_departure: "10:30", transport_note: "æ²³å£æ¹–å‘¨éŠå·´å£« (ç´…ç·š) | å¤©ä¸Šå±±å…¬åœ’çºœè»Š", event_note: "ã€ç‹¸è²“èˆ‡å…”å­å‚³èªªã€‘å¯ä¿¯ç°æ²³å£æ¹–å’Œå¯Œå£«å±±å…¨æ™¯ã€‚", link: "https://goo.gl/maps/kachiropeway" },
                    { time: "17:00", title: "ç§»å‹•è‡³æ±äº¬ (Check-in é¶¯è°·/ä¸Šé‡)", type: "transport", suggested_departure: "17:00", transport_note: "é«˜é€Ÿå·´å£« or JR (æ–°å®¿/æ±äº¬) | ç´„ 2 å°æ™‚", event_note: "é•·é€”ç§»å‹•ï¼Œé è¨‚ 17:00 å·¦å³è»Šç­å‰å¾€æ±äº¬ã€‚", link: "https://goo.gl/maps/shinjuku" },
                    { time: "19:30", title: "å…­æœ¬æœ¨ä¹‹ä¸˜é»ç‡ˆ", type: "sight", suggested_departure: "19:00", transport_note: "åœ°éµ | ç´„ 20-30 åˆ†é˜ (å¾æ–°å®¿/ä¸Šé‡)", event_note: "ã€æ±äº¬è–èª•å¤œæ™¯ã€‘æ¬£è³æ«¸æœ¨å‚å¤§é“çš„é¦™æª³é‡‘é»ç‡ˆã€‚", tags: ["è–èª•é™å®š"], link: "https://goo.gl/maps/roppongihills" },
                    { time: "21:00", title: "æ™´ç©ºå¡”è–èª•å¸‚é›†", type: "sight", suggested_departure: "20:30", transport_note: "åœ°éµ (å¤§æ±Ÿæˆ¶ç·š/åŠè—é–€ç·š) | ç´„ 30-40 åˆ†é˜", event_note: "æ±äº¬æ™´ç©ºå¡”å¤¢å¹»è–èª• 2025", link: "https://goo.gl/maps/skytree" }
                ]
            },
            {
                day: 6, date: "12/25 (Thu)", location: "Tokyo Shibuya", weather: "sunny", theme: "shibuya_modern",
                temperature: [3, 5, 7, 9, 10, 8, 6, 4],
                temp_hour_range: "09:00 - 17:00",
                daily_pass: "JR æ±äº¬éƒ½å¸‚åœ°å€å‘¨éŠåˆ¸ (Tokunai Pass, 760 JPY) æˆ– Suica/Pasmo",
                events: [
                    { time: "09:00", title: "æ˜æ²»ç¥å®®", type: "sight", suggested_departure: "08:40", transport_note: "JR å±±æ‰‹ç·š | å¾é¶¯è°·/ä¸Šé‡å‡ºç™¼ç´„ 20 åˆ†é˜", event_note: "ã€æ±äº¬éƒ½å¸‚ç¶ æ´²ã€‘ä¾›å¥‰æ˜æ²»å¤©çš‡èˆ‡æ˜­æ†²çš‡å¤ªåçš„ç¥å®®ã€‚", link: "https://goo.gl/maps/meijishrine" },
                    { time: "12:00", title: "Sports Shop Gallery 2 (é€›è¡—)", type: "shop", suggested_departure: "11:45", transport_note: "æ­¥è¡Œ | å¾åŸå®¿/ä»£ä»£æœ¨è‡³æ¾€è°·", event_note: "åˆé¤æ™‚é–“å½ˆæ€§è™•ç†ï¼Œæ­¤è™•ç‚ºé«”è‚²ç”¨å“åº—é€›è¡—æ™‚é–“ã€‚", link: "https://goo.gl/maps/shibuyacrossing" },
                    { time: "16:00", title: "Shibuya Sky", type: "sight", suggested_departure: "15:55", transport_note: "æ­¥è¡Œ | ç´„ 5 åˆ†é˜", event_note: "ã€æ¾€è°·æœ€é«˜å±•æœ›å°ã€‘éœ€å…©é€±å‰æ¶ç¥¨! æ—¥è½æ™‚é–“ç´„ 16:30ã€‚", nearby_suggestions: ["å®®ä¸‹å…¬åœ’", "å¿ çŠ¬å…«å…¬åƒ"], tags: ["é ç´„", "æ—¥è½"], link: "https://goo.gl/maps/shibuyasky" },
                    { time: "18:00", title: "é’ä¹‹æ´çªŸ (é»ç‡ˆ)", type: "sight", suggested_departure: "17:50", transport_note: "æ­¥è¡Œ | æ¾€è°·å…¬åœ’é€š~ä»£ä»£æœ¨å…¬åœ’", event_note: "ã€è—è‰²ç‡ˆæµ·ã€‘æ•¸åè¬é¡†è—è‰² LED ç‡ˆè£é£¾æˆçš„å¤¢å¹»ç‡ˆæµ·ã€‚", tags: ["é»ç‡ˆ"], link: "https://goo.gl/maps/bluecave" },
                    { time: "20:00", title: "æ™šé¤: Steak Rice & Curry", type: "food", suggested_departure: "19:50", transport_note: "æ­¥è¡Œ | æ¾€è°·ç«™å‘¨é‚Š", event_note: "Center Beef Shibuya (Center Gai?)", link: "https://goo.gl/maps/centerbeef" }
                ]
            },
            {
                day: 7, date: "12/26 (Fri)", location: "Asakusa/Skytree", weather: "sunny", theme: "traditional_sky",
                temperature: [2, 4, 6, 8, 9, 7, 5, 3],
                temp_hour_range: "09:00 - 17:00",
                daily_pass: "æ±äº¬åœ°éµä¸€æ—¥åˆ¸ (Tokyo Subway 24-hour Ticket, 800 JPY) - æ¶µè“‹ Metro å’Œ Toei",
                events: [
                    { time: "09:00", title: "æ·ºè‰é›·é–€", type: "sight", suggested_departure: "08:40", transport_note: "åœ°éµéŠ€åº§ç·š/éƒ½ç‡Ÿæ·ºè‰ç·š | å¾ä¸Šé‡/é¶¯è°·å‡ºç™¼", event_note: "ã€æ±äº¬ä¸‹ç”ºæ–‡åŒ–ã€‘æ¨™èªŒæ€§çš„å¤§ç‡ˆç± ï¼Œèµ°éä»²è¦‹ä¸–é€šï¼Œçµ‚é»æ˜¯æ·ºè‰å¯ºã€‚", nearby_suggestions: ["æ·ºè‰æ–‡åŒ–è§€å…‰ä¸­å¿ƒ", "éš…ç”°å…¬åœ’"], link: "https://goo.gl/maps/kaminarimon" },
                    { time: "11:30", title: "åˆé¤: æ·ºè‰ä»ŠåŠ", type: "food", suggested_departure: "11:25", transport_note: "æ­¥è¡Œ | æ·ºè‰ç«™å‘¨é‚Š", event_note: "ã€è€å­—è™Ÿå£½å–œç‡’ã€‘åˆé–“å¥—é¤åƒ¹æ ¼å¯¦æƒ ã€‚", tags: ["é«˜CPå€¼"], link: "https://goo.gl/maps/asakusaimahan" },
                    { time: "14:00", title: "Pokemon Center æ™´ç©ºå¡”", type: "shop", suggested_departure: "13:45", transport_note: "åœ°éµ/æ±æ­¦ç·š | æ·ºè‰è‡³æŠ¼ä¸Šç«™ | ç´„ 15 åˆ†é˜", event_note: "ä½æ–¼æ™´ç©ºå¡”ä¸‹çš„è³¼ç‰©ä¸­å¿ƒã€‚", link: "https://goo.gl/maps/pokemonskytree" },
                    { time: "17:00", title: "æŠ¼ä¸Šæº«æ³‰ (å¤§é»‘æ¹¯)", type: "sight", suggested_departure: "16:50", transport_note: "æ­¥è¡Œ | æŠ¼ä¸Šç«™å‘¨é‚Š", event_note: "å‚³çµ±éŒ¢æ¹¯é«”é©—", link: "https://goo.gl/maps/daikokuyu" }
                ]
            },
            {
                day: 8, date: "12/27 (Fri)", location: "Tokyo Shopping", weather: "cloudy", theme: "shopping",
                temperature: [4, 6, 8, 10, 9, 7, 5, 4],
                temp_hour_range: "10:00 - 18:00",
                daily_pass: "æ±äº¬åœ°éµä¸€æ—¥åˆ¸ (Tokyo Subway 24-hour Ticket, 800 JPY) æˆ– Suica/Pasmo",
                events: [
                    { time: "10:00", title: "Ricoland Tokyo Bay (é‡æ©Ÿç”¨å“)", type: "shop", suggested_departure: "09:20", transport_note: "åœ°éµæœ‰æ¨‚ç”ºç·š/ç™¾åˆé·—ç·š (æ–°æ©‹è½‰ä¹˜) | ç›®çš„åœ°ï¼šæ±é›²ç«™ | ç´„ 40 åˆ†é˜", event_note: "ã€é¨å£«å¿…è¨ªè–åœ°ã€‘æ±äº¬ç£åœ°å€çš„å¤§å‹é‡æ©Ÿç”¨å“åº—ã€‚", tags: ["é¨å£«å¿…é€›"], link: "https://goo.gl/maps/ricoland" },
                    { time: "13:00", title: "åˆé¤", type: "food", suggested_departure: "12:00", transport_note: "åœ°éµ/JR | å¾æ±é›²ç«™è¿”å›æ–°å®¿ï¼Œç´„ 1 å°æ™‚", event_note: "æœ¨æ›½è·¯(æ–°å®¿ä¸‰ä¸ç›®åº—) Shabu Shabu / å£½å–œç‡’", link: "https://goo.gl/maps/kisoji" },
                    { time: "15:00", title: "æ–°å®¿é€›è¡—", type: "shop", suggested_departure: "14:55", transport_note: "æ­¥è¡Œ | æ–°å®¿ç«™å‘¨é‚Š", event_note: "Lumine, Isetan, BicCamera", link: "https://goo.gl/maps/shinjuku" }
                ]
            },
            {
                day: 9, date: "12/28 (Sat)", location: "Back Home", weather: "sunny", theme: "home",
                temperature: [3, 5, 7, 9, 11, 10, 8, 6],
                temp_hour_range: "09:00 - 17:00",
                daily_pass: "JR Narita Express (N'EX) / Skyliner / Suica å–®ç¨‹ç¥¨ (è‡³æ©Ÿå ´)",
                events: [
                    { time: "10:00", title: "å‰å¾€æˆç”°æ©Ÿå ´ (NRT)", type: "transport", suggested_departure: "10:00", transport_note: "JR Narita Express (N'EX) or Skyliner | ç´„ 1 å°æ™‚ 20 åˆ†é˜ (å¾æ–°å®¿/ä¸Šé‡)", event_note: "é ç•™å……è£•æ™‚é–“è‡³ç¬¬ä¸€èˆªå»ˆ (T1)", link: "https://goo.gl/maps/naritaairport" },
                    { time: "14:30", title: "æŠµé”æˆç”°æ©Ÿå ´ (NRT)", type: "transport", suggested_departure: "14:30", transport_note: "æ©Ÿå ´å…ç¨…åº—è³¼ç‰©", event_note: "è¾¦ç†ç™»æ©Ÿæ‰‹çºŒ", link: "" },
                    { time: "16:35", title: "èµ·é£› (NRT -> TPE)", type: "transport", suggested_departure: "16:35", transport_note: "èˆªç­è³‡è¨Š MM625", event_note: "ç¥æ—…é€”æ„‰å¿«ï¼", link: "" },
                    { time: "20:00", title: "æŠµé”å°åŒ— (TPE)", type: "home", suggested_departure: "20:00", transport_note: "æº«æš–çš„å®¶", event_note: "ç”œèœœçš„å®¶", link: "" }
                ]
            }
        ];

        // --- ICONS & UTILITIES ---
        const IconMap = ({ className }) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M17.657 16.657L13.414 20.9a1.998 1.998 0 01-2.827 0l-4.244-4.243a8 8 0 1111.314 0z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 11a3 3 0 11-6 0 3 3 0 016 0z" /></svg>);
        const IconTransport = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 19l9 2-9-18-9 18 9-2zm0 0v-8" /></svg>);
        const IconSight = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M4 16l4.586-4.586a2 2 0 012.828 0L15 15m0 0l4.142-4.142a2 2 0 012.828 0m-9.3 9.3l4.586-4.586a2 2 0 012.828 0L21 17m0 0h-5.5m0 0v-5.5" /></svg>);
        const IconFood = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M12 8c1.657 0 3 .895 3 2s-1.343 2-3 2h-1a3 3 0 000 6h-1a3 3 0 01-3 3H5a3 3 0 01-3-3v-4h1v4h1a1 1 0 001 1h1a1 1 0 001-1v-4H3c-1.657 0-3-.895-3-2s1.343-2 3-2h1a3 3 0 000-6h1a3 3 0 013-3h3a3 3 0 013 3z" /><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 8H7M5 12h14a2 2 0 002-2V8a2 2 0 00-2-2H5a2 2 0 00-2 2v2a2 2 0 002 2z" /></svg>);
        const IconHotel = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M19 11H5m14 0a2 2 0 012 2v6a2 2 0 01-2 2H5a2 2 0 01-2-2v-6a2 2 0 012-2m14 0V9a2 2 0 00-2-2M5 11V9a2 2 0 012-2m0 0v2m7-2v2m0-2h.01M7 9v2m7-2h.01M5 15h14" /></svg>);
        const IconShop = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M16 11V7a4 4 0 00-8 0v4M5 9h14l1 12H4L5 9z" /></svg>);
        const IconHome = (props) => (<svg {...props} xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0h6m-6 0a1 1 0 00-1 1v3m10-3v3m-3 3h3" /></svg>);
        const IconMemo = ({ className }) => ( <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15.232 5.232l3.536 3.536m-2.036-5.036a2.5 2.5 0 113.536 3.536L6.5 21.036H3v-3.572L16.732 3.732z" /></svg>);
        const IconTranslate = ({ className }) => ( <svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M3 5h12M9 3v2m1.048 9.5A18.022 18.022 0 0118.5 16.5m-15-2.5h11m0 0v2.5M12 10V4.75a2 2 0 012-2h4a2 2 0 012 2V10m-6 0h6m-6 0c0 1.066.386 2.128 1.139 3.146L12 16.5m0-6.5h6m-6 0v2.5" /></svg>);
        const IconSwitch = ({ className }) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M8 7h12m0 0l-4-4m4 4l-4 4m0 6H4m0 0l4 4m-4-4l4-4" /></svg>);
        const IconTicket = ({ className }) => (<svg className={className} fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path strokeLinecap="round" strokeLinejoin="round" strokeWidth={2} d="M15 5v2m0 4v2m0 4v2M5 5a2 2 0 00-2 2v3a2 2 0 110 4v3a2 2 0 002 2h14a2 2 0 002-2v-3a2 2 0 110-4V7a2 2 0 00-2-2H5z" /></svg>);
        
        const getCardClass = (theme) => {
             return 'glass-light';
        };

        const getIconForType = (type) => {
            switch (type) {
                case 'transport': return IconTransport;
                case 'sight': return IconSight;
                case 'food': return IconFood;
                case 'hotel': return IconHotel;
                case 'shop': return IconShop;
                case 'home': return IconHome;
                default: return 'div';
            }
        };

        const getIconColor = (type) => {
            switch (type) {
                case 'transport': return 'text-blue-500';
                case 'sight': return 'text-green-500';
                case 'food': return 'text-red-500';
                case 'hotel': return 'text-yellow-500';
                case 'shop': return 'text-purple-500';
                case 'home': return 'text-indigo-500';
                default: return 'text-gray-500';
            }
        };

        const generateDayMapLink = (events) => {
            const destinationTitles = events
                .filter(e => e.link && e.type !== 'transport' && e.type !== 'hotel')
                .map(e => e.title)
                .filter(t => t); 
            
            if (destinationTitles.length === 0) return '#';
            const query = encodeURIComponent(destinationTitles.join(' '));
            return `https://maps.google.com/maps?q=${query}`;
        };

        // --- FEATURE COMPONENTS ---

        // **1. æ¯æ—¥äº¤é€šå¥—ç¥¨å»ºè­°å…ƒä»¶**
        function DailyPassSuggestion({ suggestion }) {
            if (!suggestion) return null;
            return (
                <div className="mt-4 p-3 bg-indigo-50 border border-indigo-200 rounded-lg text-sm">
                    <p className="font-bold text-indigo-700 flex items-center mb-1">
                        <IconTicket className="w-5 h-5 mr-2 text-indigo-500" />
                        å»ºè­°äº¤é€šå¥—ç¥¨:
                    </p>
                    <p className="text-gray-800 ml-1 font-medium">{suggestion}</p>
                </div>
            );
        }

        // **2. ä½¿ç”¨è€…æ¯æ—¥å‚™è¨»å…ƒä»¶**
        function UserMemo({ day, currentMemo, onUpdateMemo }) {
            const memoId = `user-memo-${day}`;
            const textColor = 'text-gray-800';
            const bgColor = 'bg-white/70 focus:bg-white';
            const borderColor = 'border-gray-300 focus:border-indigo-500';

            return (
                <div className="mt-4 pt-4 border-t border-dashed border-gray-200">
                    <label htmlFor={memoId} className={`block text-sm font-bold mb-2 flex items-center ${textColor}`}>
                        <IconMemo className="w-5 h-5 mr-1 text-gray-600" />
                        æˆ‘çš„æ¯æ—¥å‚™è¨» (Memo) - å¯ç·¨è¼¯
                    </label>
                    <textarea
                        id={memoId}
                        rows="3"
                        value={currentMemo || ''}
                        onChange={(e) => onUpdateMemo(day, e.target.value)}
                        placeholder="åœ¨é€™è£¡å¯«ä¸‹ä»Šå¤©çš„å¿ƒæƒ…ã€é¡å¤–èŠ±è²»ã€æˆ–æ˜å¤©éœ€è¦æ³¨æ„çš„äº‹é …..."
                        className={`w-full p-3 rounded-lg text-sm transition-all duration-200 resize-none ${textColor} ${bgColor} ${borderColor} border`}
                        style={{ outline: 'none' }}
                    />
                </div>
            );
        }

        // **3. æ©Ÿç¥¨/ä½å®¿å·¥å…·å…ƒä»¶**
        const BookingTool = ({ data }) => (
            <div className="space-y-8 p-4 pt-8 max-w-xl mx-auto">
                <div className="glass-light p-6 rounded-2xl shadow-lg space-y-6">
                    <h3 className="text-2xl font-bold text-indigo-700 border-b pb-2">æ©Ÿç¥¨è³‡è¨Š âœˆï¸</h3>
                    <div className="space-y-4">
                        {data.flights.map((flight, index) => (
                            <div key={index} className="p-4 rounded-xl border border-indigo-200 bg-indigo-50">
                                <p className="text-lg font-bold mb-1 text-indigo-800">{flight.leg}ï¼š{flight.code}</p>
                                <p className="text-sm text-gray-700">{flight.time}</p>
                                <p className="text-xs font-medium text-indigo-600 mt-1">æ©Ÿå ´: {flight.airport}</p>
                            </div>
                        ))}
                    </div>

                    <h3 className="text-2xl font-bold text-indigo-700 border-b pb-2 pt-4">ä½å®¿æ¸…å–® ğŸ¨</h3>
                    <div className="space-y-4">
                        {data.hotels.map((hotel, index) => (
                            <div key={index} className="p-4 rounded-xl border border-yellow-200 bg-yellow-50">
                                <p className="text-lg font-bold text-gray-800">{hotel.name}</p>
                                <p className="text-sm font-semibold text-red-600 mb-2">{hotel.dates}</p>
                                <p className="text-sm text-gray-700">åœ°å€: {hotel.address}</p>
                                <p className="text-sm text-gray-700">é›»è©±: {hotel.phone}</p>
                            </div>
                        ))}
                    </div>
                </div>

                <div className="glass-light p-6 rounded-2xl shadow-lg">
                    <h3 className="text-2xl font-bold text-red-700 border-b pb-2">ç·Šæ€¥è¯çµ¡æ–¹å¼ ğŸš¨</h3>
                    <div className="space-y-3 mt-4">
                        {data.emergency.map((item, index) => (
                            <div key={index} className="p-3 rounded-xl border-l-4 border-red-400 bg-red-50/50">
                                <p className="text-md font-medium text-red-600">{item.name}</p>
                                <p className="text-xl font-extrabold text-red-800">{item.phone}</p>
                            </div>
                        ))}
                    </div>
                </div>
            </div>
        );

        // **4. åˆ†å¸³å·¥å…·å…ƒä»¶ (åŸºæœ¬åŠŸèƒ½æ¨¡æ“¬)**
        const SplitTool = ({ travelers }) => {
            // State for expenses (JPY)
            const [expenses, setExpenses] = useState([
                { id: 1, description: 'D1 çŸ¢å ´è±¬æ’', amount: 4500, paidBy: 'Sophie', sharedBy: ['Sophie', 'Li'] },
                { id: 2, description: 'D2 çŠ¬å±±åŸé–€ç¥¨', amount: 1000, paidBy: 'Li', sharedBy: ['Sophie', 'Li'] },
                { id: 3, description: 'D3 é°»é­šé£¯', amount: 6000, paidBy: 'Sophie', sharedBy: ['Sophie', 'Li'] },
            ]);
            
            // è²»ç”¨è¨ˆç®—é‚è¼¯ (ç°¡å–®å¹³å‡åˆ†é…)
            const calculateSummary = useMemo(() => {
                const summary = travelers.reduce((acc, name) => ({
                    ...acc,
                    [name]: { paid: 0, owes: 0, net: 0 }
                }), {});

                if (expenses.length === 0) return summary;

                expenses.forEach(exp => {
                    // 1. è¨ˆç®—ç¸½æ”¯ä»˜é‡‘é¡
                    summary[exp.paidBy].paid += exp.amount;

                    // 2. è¨ˆç®—æ¯äººæ‡‰æ”¤é‡‘é¡ (åƒ…é™å…±äº«è€…)
                    const sharedCount = exp.sharedBy.length;
                    const share = exp.amount / sharedCount;

                    travelers.forEach(name => {
                        if (exp.sharedBy.includes(name)) {
                            summary[name].owes += share;
                        }
                    });
                });

                // 3. è¨ˆç®—æ·¨é¤˜é¡
                travelers.forEach(name => {
                    summary[name].net = summary[name].paid - summary[name].owes;
                });
                
                return summary;
            }, [expenses, travelers]);

            // ... (Add expense form logic is omitted for brevity to keep the code block manageable)

            return (
                <div className="p-4 pt-8 max-w-xl mx-auto space-y-6">
                    <h3 className="text-2xl font-bold text-indigo-700 flex items-center mb-4">
                        åˆ†å¸³å·¥å…· (JPY) ğŸ§®
                    </h3>
                    
                    {/* Summary Card */}
                    <div className="glass-light p-6 rounded-2xl shadow-lg">
                        <h4 className="text-xl font-bold mb-4 border-b pb-2 text-gray-700">è²»ç”¨çµç®—ç¸½è¦½</h4>
                        <div className="grid grid-cols-2 gap-4">
                            {travelers.map(name => {
                                const data = calculateSummary[name];
                                const netColor = data.net >= 0 ? 'text-green-600' : 'text-red-600';
                                return (
                                    <div key={name} className="p-3 bg-gray-50 rounded-lg border border-gray-200">
                                        <p className="font-bold text-lg mb-1">{name}</p>
                                        <p className="text-sm text-gray-600">å·²ä»˜: <span className="font-semibold">{data.paid.toFixed(0)}</span></p>
                                        <p className="text-sm text-gray-600">æ‡‰ä»˜: <span className="font-semibold">{data.owes.toFixed(0)}</span></p>
                                        <p className={`text-xl font-extrabold mt-1 ${netColor}`}>
                                            æ·¨å€¼: {data.net.toFixed(0)}
                                        </p>
                                    </div>
                                );
                            })}
                        </div>
                        <p className="mt-4 text-sm text-gray-500 text-center">
                            {calculateSummary.Sophie?.net < 0 ? 
                                `Li æ‡‰ä»˜ Sophie JPY ${Math.abs(calculateSummary.Sophie.net).toFixed(0)}` :
                                (calculateSummary.Li?.net < 0 ?
                                `Sophie æ‡‰ä»˜ Li JPY ${Math.abs(calculateSummary.Li.net).toFixed(0)}` : 
                                'å¸³ç›®å¹³è¡¡ã€‚')}
                        </p>
                    </div>

                    {/* Expense List Card */}
                    <div className="glass-light p-6 rounded-2xl shadow-lg mt-6">
                        <h4 className="text-xl font-bold mb-4 border-b pb-2 text-gray-700">è²»ç”¨æ¸…å–® ({expenses.length}ç­†)</h4>
                        <ul className="space-y-3">
                            {expenses.map(exp => (
                                <li key={exp.id} className="text-sm p-3 border-l-4 border-blue-400 bg-blue-50/50 rounded-md">
                                    <p className="font-semibold text-gray-800">{exp.description}</p>
                                    <p className="text-lg font-bold text-blue-800">JPY {exp.amount.toFixed(0)}</p>
                                    <p className="text-xs text-gray-600 mt-1">ç”± <span className="font-bold">{exp.paidBy}</span> æ”¯ä»˜ / å…±ç”¨è€…: {exp.sharedBy.join(', ')}</p>
                                </li>
                            ))}
                        </ul>
                        {/* å¯¦éš›æ‡‰ç”¨ä¸­ï¼Œæ­¤è™•æ‡‰æœ‰æ–°å¢è²»ç”¨è¡¨å–® */}
                        <p className="mt-4 text-center text-gray-500 text-sm">ï¼ˆæ–°å¢è²»ç”¨è¡¨å–®å·²ç•¥å»ï¼Œä»¥ä¿æŒç¨‹å¼ç¢¼ç°¡æ½”ã€‚ï¼‰</p>
                    </div>
                </div>
            );
        };

        // **5. å³æ™‚ç¿»è­¯å·¥å…·å…ƒä»¶**
        function TranslationTool() {
            const [mode, setMode] = useState('zh_to_ja'); // mode: 'zh_to_ja' (ä¸­ç¿»æ—¥), 'ja_to_zh' (æ—¥ç¿»ä¸­)
            const [inputText, setInputText] = useState('');
            const [outputText, setOutputText] = useState({ translated: "è«‹è¼¸å…¥æ–‡å­—é–‹å§‹ç¿»è­¯...", pronunciation: "", isSimulated: false });
            
            // ç°¡åŒ–æ¨¡æ“¬ç¿»è­¯å­—å…¸
            const TRANSLATION_MAP = {
                'zh_to_ja': {
                    "è¬è¬": ["ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã™", "(Arigatou gozaimasu)"],
                    "è«‹å•å»æ‰€åœ¨å“ªè£¡": ["ãƒˆã‚¤ãƒ¬ã¯ã©ã“ã§ã™ã‹", "(Toire wa doko desu ka)"],
                    "é€™å€‹å¤šå°‘éŒ¢": ["ã“ã‚Œã¯ã„ãã‚‰ã§ã™ã‹", "(Kore wa ikura desu ka)"],
                    "è«‹çµ¦æˆ‘é€™å€‹": ["ã“ã‚Œã‚’ãã ã•ã„", "(Kore o kudasai)"],
                    "æˆ‘æƒ³è¦é»é¤": ["æ³¨æ–‡ã—ãŸã„ã§ã™", "(ChÅ«mon shitai desu)"],
                    "å°ä¸èµ·": ["ã™ã¿ã¾ã›ã‚“", "(Sumimasen)"],
                    "è«‹çµå¸³": ["ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™", "(Okaikei o onegaishimasu)"],
                    "ä¸å¥½æ„æ€": ["å¤±ç¤¼ã—ã¾ã™", "(Shitsurei shimasu)"]
                },
                'ja_to_zh': {
                    "ãƒˆã‚¤ãƒ¬": ["å»æ‰€", "(Toire)"],
                    "ã„ãã‚‰": ["å¤šå°‘éŒ¢", "(Ikura)"],
                    "ãŠä¼šè¨ˆ": ["çµå¸³", "(Okaikei)"],
                    "ãƒ©ãƒ¼ãƒ¡ãƒ³": ["æ‹‰éºµ", "(RÄmen)"],
                    "å‘³å™Œ": ["å‘³å™Œ", "(Miso)"],
                    "æ³¨æ–‡": ["é»é¤", "(ChÅ«mon)"],
                    "ãŠæ°´": ["æ°´", "(Omizu)"],
                    "ã™ã¿ã¾ã›ã‚“": ["ä¸å¥½æ„æ€/å°ä¸èµ·", "(Sumimasen)"],
                    "ã‚ã‚ŠãŒã¨ã†ã”ã–ã„ã¾ã—ãŸ": ["è¬è¬", "(ArigatÅ gozaimashita)"]
                }
            };

            const simulateTranslation = (text, currentMode) => {
                text = text.trim();
                if (!text) return { translated: "è«‹è¼¸å…¥æ–‡å­—é–‹å§‹ç¿»è­¯...", pronunciation: "", isSimulated: false };

                const map = currentMode === 'zh_to_ja' ? TRANSLATION_MAP.zh_to_ja : TRANSLATION_MAP.ja_to_zh;
                const exactMatch = map[text];
                
                if (exactMatch) {
                    const [translated, pronunciation] = exactMatch;
                    return { translated, pronunciation, isSimulated: false };
                }

                // è¤‡é›œå¥å­/éå­—å…¸å…§çš„è© (æ¨¡æ“¬çµæœ)
                return {
                    translated: currentMode === 'zh_to_ja' 
                                ? `[æ¨¡æ“¬ç¿»è­¯çµæœ]ï¼šæ‚¨çš„å¥å­ã€Œ${text}ã€`
                                : `[æ¨¡æ“¬ç¿»è­¯çµæœ]ï¼š"${text}" ç¿»è­¯æˆä¸­æ–‡...`,
                    pronunciation: "(è«‹ä½¿ç”¨ Google æˆ– DeepL ç²å–æº–ç¢ºç¿»è­¯)",
                    isSimulated: true
                };
            };


            useEffect(() => {
                const delayDebounceFn = setTimeout(() => {
                    const result = simulateTranslation(inputText, mode);
                    setOutputText(result);
                }, 300); 

                return () => clearTimeout(delayDebounceFn);
            }, [inputText, mode]);

            const switchMode = () => {
                setMode(prev => prev === 'zh_to_ja' ? 'ja_to_zh' : 'zh_to_ja');
                setInputText(''); // åˆ‡æ›æ¨¡å¼æ™‚æ¸…ç©ºè¼¸å…¥
                setOutputText({ translated: "è«‹è¼¸å…¥æ–‡å­—é–‹å§‹ç¿»è­¯...", pronunciation: "", isSimulated: false });
            };

            return (
                <div className="p-4 pt-8 max-w-xl mx-auto space-y-6">
                    <h3 className="text-2xl font-bold text-indigo-700 flex items-center">
                        å³æ™‚ç¿»è­¯å·¥å…· <IconTranslate className="w-6 h-6 ml-2" />
                    </h3>

                    {/* Mode Switch Button */}
                    <div className="flex justify-center">
                        <div className="glass-light p-3 rounded-xl shadow-lg flex items-center justify-between w-full">
                            <span className="text-lg font-bold">
                                {mode === 'zh_to_ja' ? 'ä¸­æ–‡ (ç¹é«”) ğŸ‡¹ğŸ‡¼' : 'æ—¥æ–‡ (Kanji/Kana) ğŸ‡¯ğŸ‡µ'}
                            </span>
                            <button onClick={switchMode} className="bg-indigo-500 text-white p-2 rounded-full hover:bg-indigo-600 transition-colors flex items-center shadow-md">
                                <IconSwitch className="w-5 h-5 mr-1" />
                                åˆ‡æ›
                            </button>
                            <span className="text-lg font-bold">
                                {mode === 'zh_to_ja' ? 'æ—¥æ–‡ (Kanji/Kana) ğŸ‡¯ğŸ‡µ' : 'ä¸­æ–‡ (ç¹é«”) ğŸ‡¹ğŸ‡¼'}
                            </span>
                        </div>
                    </div>

                    {/* Input Area */}
                    <div className="glass-light p-4 rounded-xl shadow-lg">
                        <label className="block text-sm font-bold text-gray-700 mb-2">è¼¸å…¥ ({mode === 'zh_to_ja' ? 'ä¸­æ–‡' : 'æ—¥æ–‡'})</label>
                        <textarea
                            rows="4"
                            value={inputText}
                            onChange={(e) => setInputText(e.target.value)}
                            placeholder={mode === 'zh_to_ja' ? 'è¼¸å…¥æ‚¨æƒ³èªªçš„ä¸­æ–‡...' : 'è¼¸å…¥æ—¥æ–‡ï¼Œå¦‚: ã™ã¿ã¾ã›ã‚“'}
                            className="w-full p-3 rounded-lg border border-gray-300 focus:border-indigo-500 resize-none outline-none text-gray-800"
                        />
                    </div>

                    {/* Output Area */}
                    <div className="glass-light p-4 rounded-xl shadow-lg bg-indigo-50/70 border border-indigo-200">
                        <label className="block text-sm font-bold text-indigo-700 mb-2">ç¿»è­¯çµæœ ({mode === 'zh_to_ja' ? 'æ—¥æ–‡' : 'ä¸­æ–‡'})</label>
                        <p className="text-xl font-bold text-gray-800 break-words min-h-[50px] flex items-center">
                            {outputText.translated}
                        </p>
                        {outputText.pronunciation && (
                            <p className="text-sm text-gray-500 mt-2 italic border-t pt-2">
                                ç™¼éŸ³/æç¤º: {outputText.pronunciation}
                            </p>
                        )}
                        {outputText.isSimulated && (
                            <p className="text-xs text-red-500 mt-2">
                                *æ­¤ç‚ºå­—å…¸æ¨¡æ“¬çµæœï¼Œè¤‡é›œèªå¥è«‹ä½¿ç”¨å°ˆæ¥­ç¿»è­¯ App é©—è­‰ã€‚
                            </p>
                        )}
                    </div>
                </div>
            );
        }

        // --- TripCard Component (æ ¸å¿ƒå…ƒä»¶) ---
        const TripCard = ({ trip, dailyMemos = {}, updateDailyMemo }) => { 
            const dateRegex = /(\d{2})\/(\d{2})\s\((\w{3})\)/; 
            const dateParts = trip.date.match(dateRegex);
            const dayOfWeek = dateParts ? dateParts[3].toUpperCase() : 'DAY';
            const dateNumber = dateParts ? dateParts[2] : '??'; 
            
            const mapLink = generateDayMapLink(trip.events);
            const cardClass = getCardClass(trip.theme); 
            const weatherHours = ["05:00", "06:00", "07:00", "08:00", "09:00", "10:00", "11:00", "12:00"];
            const weatherData = trip.temperature.slice(0, 8);


            return (
                <div className={`${cardClass} card-shadow rounded-2xl overflow-hidden mb-6 mx-4`}>
                    
                    {/* Header with Date and Location */}
                    <div className="p-4">
                        <div className="flex justify-between items-start">
                            <div className="flex items-end space-x-2">
                                {/* å·¦å´: æ˜ŸæœŸå’Œæ—¥æœŸæ•¸å­— (å¾©åŸæ¨£å¼) */}
                                <div className="text-center">
                                    <p className="text-sm date-style font-bold opacity-70">
                                        {dayOfWeek} 
                                    </p>
                                    <h2 className="text-5xl date-style font-bold leading-none">
                                        {dateNumber} 
                                    </h2>
                                </div>
                                {/* å³å´: DAY X å’Œ Location (å¾©åŸæ¨£å¼) */}
                                <div className="pb-1">
                                    <p className="text-base date-style font-bold leading-tight text-indigo-600">
                                        DAY {trip.day} 
                                    </p>
                                    <p className="text-sm date-style font-medium opacity-80">
                                        {trip.location} 
                                    </p>
                                </div>
                            </div>
                            
                            {/* åœ°åœ–æŒ‰éˆ• */}
                            {mapLink !== '#' && (
                                <a href={mapLink} target="_blank" rel="noopener noreferrer" className={`flex-shrink-0 mt-2 text-sm font-bold py-2 px-3 rounded-full transition-colors flex items-center bg-gray-100 hover:bg-gray-200 text-gray-700`}>
                                    <IconMap className="w-5 h-5 mr-1" />
                                    ä»Šæ—¥åœ°åœ–
                                </a>
                            )}
                        </div>
                        
                        {/* ç°¡æ˜“ç‰ˆæ¯å°æ™‚å¤©æ°£é å ± */}
                        <div className="mt-4 pt-3 border-t border-gray-100">
                            <div className="flex justify-between overflow-x-auto hide-scrollbar">
                                {weatherData.map((temp, index) => (
                                    <div key={index} className="flex-shrink-0 text-center w-1/8 px-2">
                                        <p className="text-xs font-semibold opacity-70">{weatherHours[index]}</p>
                                        <p className="text-2xl mt-1 text-yellow-500">â˜€ï¸</p>
                                        <p className="text-base font-bold mt-1">{temp}Â°</p>
                                    </div>
                                ))}
                            </div>
                        </div>

                    </div>


                    {/* Daily Pass è³‡è¨Š (æ–°å¢å› TripCard) */}
                    <DailyPassSuggestion suggestion={trip.daily_pass} />


                    {/* Events List */}
                    <div className="p-4 pt-0">
                        <ul className="space-y-4 border-l-2 border-gray-200 pl-4">
                            {trip.events.map((event, index) => {
                                const IconComponent = getIconForType(event.type);
                                const iconColor = getIconColor(event.type);
                                
                                return (
                                    <li key={index} className="relative">
                                        {/* æ™‚é–“é»åœ“åœˆ */}
                                        <div className={`absolute -left-5 top-1 h-4 w-4 rounded-full border-4 border-white ${iconColor} bg-white flex items-center justify-center`}>
                                            <div className="h-2 w-2 rounded-full" style={{ backgroundColor: iconColor.replace('text-', 'bg-').replace('-500', '-600') }}></div>
                                        </div>

                                        <div className="flex items-start space-x-3">
                                            {/* æ™‚é–“ */}
                                            <p className="flex-shrink-0 text-lg font-bold w-16 pt-0.5">{event.time}</p>
                                            
                                            {/* äº‹ä»¶å…§å®¹ */}
                                            <div className="flex-grow">
                                                <h4 className="text-lg font-bold leading-tight">
                                                    <IconComponent className={`w-5 h-5 inline mr-1 opacity-70 ${iconColor}`} />
                                                    {event.title}
                                                </h4>
                                                {event.event_note && (
                                                    <p className="text-sm text-gray-600 mt-0.5 leading-snug">{event.event_note}</p>
                                                )}
                                                {event.transport_note && (
                                                    <p className="text-xs font-medium text-blue-500 mt-1">
                                                        {event.transport_note}
                                                    </p>
                                                )}
                                                {event.tags && (
                                                    <div className="mt-1 flex flex-wrap gap-1">
                                                        {event.tags.map(tag => (
                                                            <span key={tag} className="text-xs bg-gray-100 text-gray-500 px-2 py-0.5 rounded-full font-medium">
                                                                #{tag}
                                                            </span>
                                                        ))}
                                                    </div>
                                                )}
                                            </div>
                                        </div>
                                    </li>
                                );
                            })}
                        </ul>
                    </div>
                    
                    {/* Daily Memo (æ–°å¢å› TripCard) */}
                    <div className="p-4 pt-0">
                        <UserMemo 
                            day={trip.day} 
                            currentMemo={dailyMemos[trip.day]} 
                            onUpdateMemo={updateDailyMemo} 
                        />
                    </div>
                </div>
            );
        };


        // --- App Component (ä¸»æ‡‰ç”¨ç¨‹å¼é‚è¼¯) ---
        const App = () => {
            const [currentDay, setCurrentDay] = useState(tripData[0].day);
            const [tab, setTab] = useState('daily'); // 'daily', 'booking', 'split', 'translate'
            
            // [ä¿®æ­£] æ–°å¢ dailyMemos ç‹€æ…‹ï¼Œä»¥é¿å… ReferenceError
            const [dailyMemos, setDailyMemos] = useState({}); 

            // å‚™è¨»æ›´æ–°é‚è¼¯
            const updateDailyMemo = (day, memo) => {
                setDailyMemos(prev => ({ ...prev, [day]: memo }));
            };

            const scrollToTop = () => {
                window.scrollTo({ top: 0, behavior: 'smooth' });
            };

            const goToPreviousDay = () => {
                const newDay = Math.max(1, currentDay - 1);
                setCurrentDay(newDay);
                scrollToTop();
            };

            const goToNextDay = () => {
                const newDay = Math.min(tripData.length, currentDay + 1);
                setCurrentDay(newDay);
                scrollToTop();
            };

            const currentTrip = tripData.find(trip => trip.day === currentDay);
            const totalDays = tripData.length;

            if (!currentTrip) return <div className="p-4">Loading...</div>;

            const backgroundStyle = getBackgroundStyle(currentTrip.theme);

            const tabButtonClass = (currentTab) => 
                `flex-1 px-4 py-2 text-sm font-semibold transition-colors rounded-full ${
                    tab === currentTab ? 'bg-indigo-600 text-white shadow-md' : 'text-gray-600 hover:bg-gray-100'
                }`;

            return (
                <div id="app" className={`${backgroundStyle.className} min-h-screen pb-12`} style={backgroundStyle.style}>
                    
                    {/* Sticky Header with Navigation and Tabs */}
                    <header className="sticky top-0 z-20 bg-white/90 backdrop-blur-sm shadow-md py-4 px-4 border-b border-gray-100">
                        <h1 className="text-2xl font-bold text-center text-gray-800 flex items-center justify-center">
                            âœˆï¸ SL Japan Travel 2025
                        </h1>

                        {/* Tabs */}
                        <div className="flex justify-center space-x-2 mt-3 p-1 rounded-full bg-gray-100/70">
                            <button className={tabButtonClass('daily')} onClick={() => setTab('daily')}>
                                æ¯æ—¥è¡Œç¨‹
                            </button>
                            <button className={tabButtonClass('booking')} onClick={() => setTab('booking')}>
                                æ©Ÿç¥¨/ä½å®¿
                            </button>
                            <button className={tabButtonClass('split')} onClick={() => setTab('split')}>
                                åˆ†å¸³å·¥å…·
                            </button>
                            <button className={tabButtonClass('translate')} onClick={() => setTab('translate')}>
                                å³æ™‚ç¿»è­¯
                            </button>
                        </div>
                    </header>
                    
                    {/* Content Area */}
                    <main className="max-w-xl mx-auto">
                        
                        {/* Daily Navigation (Only visible on 'daily' tab) */}
                        {tab === 'daily' && (
                            <div className="flex items-center justify-between p-4 bg-white/70 backdrop-blur-sm mt-4 mx-4 rounded-xl shadow-md sticky top-24 z-10 border border-gray-100">
                                <button onClick={goToPreviousDay} disabled={currentDay === 1} className="p-2 disabled:opacity-30 hover:bg-gray-200 rounded-full transition-colors">
                                    <IconArrowLeft className="w-6 h-6" />
                                </button>
                                <h2 className="text-xl font-extrabold text-indigo-700 date-style">
                                    DAY {currentDay} / {totalDays}
                                </h2>
                                <button onClick={goToNextDay} disabled={currentDay === totalDays} className="p-2 disabled:opacity-30 hover:bg-gray-200 rounded-full transition-colors">
                                    <IconArrowRight className="w-6 h-6" />
                                </button>
                            </div>
                        )}

                        {/* Main Content Sections */}
                        <section className="mt-4">
                            {tab === 'daily' && (
                                <TripCard 
                                    trip={currentTrip} 
                                    key={currentTrip.day} 
                                    dailyMemos={dailyMemos} 
                                    updateDailyMemo={updateDailyMemo} 
                                />
                            )}
                            
                            {/* [æ–°å¢] Booking Tool Content */}
                            {tab === 'booking' && (
                                <BookingTool data={toolsData} />
                            )}

                            {/* [æ–°å¢] Split Tool Content */}
                            {tab === 'split' && (
                                <SplitTool travelers={TRAVELERS} />
                            )}

                            {/* [æ–°å¢] Translation Tool Content */}
                            {tab === 'translate' && (
                                <TranslationTool />
                            )}
                        </section>
                    </main>

                    {/* Footer */}
                    <footer className="text-center text-sm text-gray-500 mt-6 opacity-70">
                        Â© SL Japan Travel 2025. Powered by React & Tailwind CSS.
                    </footer>

                </div>
            );
        };

        // --- Render Application (ä½¿ç”¨ React 18 æ¨è–¦çš„æ–¹å¼) ---
        const container = document.getElementById('root');
        const root = ReactDOM.createRoot(container);
        root.render(<App />);
    </script>
</body>
</html>
